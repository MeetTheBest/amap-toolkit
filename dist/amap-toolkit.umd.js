(function(g,m){typeof exports=="object"&&typeof module!="undefined"?m(exports):typeof define=="function"&&define.amd?define(["exports"],m):(g=typeof globalThis!="undefined"?globalThis:g||self,m(g["amap-toolkit"]={}))})(this,function(g){"use strict";var ga=Object.defineProperty,ua=Object.defineProperties;var pa=Object.getOwnPropertyDescriptors;var nn=Object.getOwnPropertySymbols;var fa=Object.prototype.hasOwnProperty,da=Object.prototype.propertyIsEnumerable;var Ot=(g,m,P)=>m in g?ga(g,m,{enumerable:!0,configurable:!0,writable:!0,value:P}):g[m]=P,C=(g,m)=>{for(var P in m||(m={}))fa.call(m,P)&&Ot(g,P,m[P]);if(nn)for(var P of nn(m))da.call(m,P)&&Ot(g,P,m[P]);return g},St=(g,m)=>ua(g,pa(m));var a=(g,m,P)=>(Ot(g,typeof m!="symbol"?m+"":m,P),P);var j=(g,m,P)=>new Promise((nt,x)=>{var O=_=>{try{Y(P.next(_))}catch(H){x(H)}},S=_=>{try{Y(P.throw(_))}catch(H){x(H)}},Y=_=>_.done?nt(_.value):Promise.resolve(_.value).then(O,S);Y((P=P.apply(g,m)).next())});const m={"border-color":"#e1f5fe","font-size":"12px","border-radius":".25rem","background-color":"rgba(0,0,0,.4)","border-width":0,"text-align":"center",color:"#fff"},P=()=>Math.random().toString(16).substring(2),nt=(t,e=2)=>Number.isNaN(+t)?t:+t.toFixed(Math.max(e,0)),x=t=>Math.abs(t)>Number.MAX_SAFE_INTEGER,O=(t="",e={})=>new AMap.Text({text:t,style:C(C({},m),e),offset:[0,-10]}),S=(t,e)=>{const n=t.divideBy(2).add(e.divideBy(2));return{text:`${Math.round(t.distance(e))}ç±³`,textPos:n}};let Y=class{constructor(e){a(this,"map");a(this,"startPointToCursorText",null);a(this,"lastPointToCursorText",null);a(this,"startPosition",null);a(this,"lastPosition",null);a(this,"getClickPosition",e=>{const n=e.lnglat;this.startPosition?this.startPosition&&(this.lastPosition=n,this.createDistanceText()):this.startPosition=n});a(this,"onMouseMoveInDrawPolygon",e=>{if(!this.startPosition||!this.lastPosition)return;const n=e.lnglat;this.updateDistanceText(this.startPointToCursorText,S(this.startPosition,n)),this.updateDistanceText(this.lastPointToCursorText,S(this.lastPosition,n))});if(!e)throw new Error("map not found!");this.map=e}open(){this.start()}start(){this.map.on("click",this.getClickPosition),this.map.on("mousemove",this.onMouseMoveInDrawPolygon)}close(){this.stop()}stop(){this.map.off("click",this.getClickPosition),this.map.off("mousemove",this.onMouseMoveInDrawPolygon)}createDistanceText(){this.startPointToCursorText&&this.lastPointToCursorText||(this.startPointToCursorText=O(),this.startPointToCursorText.setMap(this.map),this.lastPointToCursorText=O(),this.lastPointToCursorText.setMap(this.map))}updateDistanceText(e,{text:n,textPos:o}){e.setText(n),e.setPosition(o)}removeDistanceText(){var e,n;(e=this.startPointToCursorText)==null||e.remove(),this.startPointToCursorText=null,(n=this.lastPointToCursorText)==null||n.remove(),this.lastPointToCursorText=null}reset(){return this.startPosition=null,this.lastPosition=null,this.removeDistanceText(),this}destroy(){return this.reset(),this.stop(),this}};var _=typeof global=="object"&&global&&global.Object===Object&&global;const H=_;var on=typeof self=="object"&&self&&self.Object===Object&&self,rn=H||on||Function("return this")();const R=rn;var sn=R.Symbol;const I=sn;var At=Object.prototype,an=At.hasOwnProperty,ln=At.toString,W=I?I.toStringTag:void 0;function hn(t){var e=an.call(t,W),n=t[W];try{t[W]=void 0;var o=!0}catch(r){}var i=ln.call(t);return o&&(e?t[W]=n:delete t[W]),i}var cn=Object.prototype,gn=cn.toString;function un(t){return gn.call(t)}var pn="[object Null]",fn="[object Undefined]",jt=I?I.toStringTag:void 0;function D(t){return t==null?t===void 0?fn:pn:jt&&jt in Object(t)?hn(t):un(t)}function B(t){return t!=null&&typeof t=="object"}var dn="[object Symbol]";function ct(t){return typeof t=="symbol"||B(t)&&D(t)==dn}function Dt(t,e){for(var n=-1,o=t==null?0:t.length,i=Array(o);++n<o;)i[n]=e(t[n],n,t);return i}var yn=Array.isArray;const N=yn;var mn=1/0,Bt=I?I.prototype:void 0,Nt=Bt?Bt.toString:void 0;function Ft(t){if(typeof t=="string")return t;if(N(t))return Dt(t,Ft)+"";if(ct(t))return Nt?Nt.call(t):"";var e=t+"";return e=="0"&&1/t==-mn?"-0":e}function q(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function Pn(t){return t}var vn="[object AsyncFunction]",Tn="[object Function]",bn="[object GeneratorFunction]",En="[object Proxy]";function Ut(t){if(!q(t))return!1;var e=D(t);return e==Tn||e==bn||e==vn||e==En}var Mn=R["__core-js_shared__"];const gt=Mn;var zt=function(){var t=/[^.]+$/.exec(gt&&gt.keys&&gt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function xn(t){return!!zt&&zt in t}var Cn=Function.prototype,wn=Cn.toString;function F(t){if(t!=null){try{return wn.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var Ln=/[\\^$.*+?()[\]{}|]/g,Rn=/^\[object .+?Constructor\]$/,In=Function.prototype,kn=Object.prototype,_n=In.toString,$n=kn.hasOwnProperty,On=RegExp("^"+_n.call($n).replace(Ln,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Sn(t){if(!q(t)||xn(t))return!1;var e=Ut(t)?On:Rn;return e.test(F(t))}function An(t,e){return t==null?void 0:t[e]}function U(t,e){var n=An(t,e);return Sn(n)?n:void 0}var jn=U(R,"WeakMap");const ut=jn;var Gt=Object.create,Dn=function(){function t(){}return function(e){if(!q(e))return{};if(Gt)return Gt(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();const Bn=Dn;function Nn(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Fn(t,e){var n=-1,o=t.length;for(e||(e=Array(o));++n<o;)e[n]=t[n];return e}var Un=800,zn=16,Gn=Date.now;function Yn(t){var e=0,n=0;return function(){var o=Gn(),i=zn-(o-n);if(n=o,i>0){if(++e>=Un)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function Hn(t){return function(){return t}}var Kn=function(){try{var t=U(Object,"defineProperty");return t({},"",{}),t}catch(e){}}();const ot=Kn;var Xn=ot?function(t,e){return ot(t,"toString",{configurable:!0,enumerable:!1,value:Hn(e),writable:!0})}:Pn,Vn=Yn(Xn);const Wn=Vn;function qn(t,e){for(var n=-1,o=t==null?0:t.length;++n<o&&e(t[n],n,t)!==!1;);return t}var Zn=9007199254740991,Jn=/^(?:0|[1-9]\d*)$/;function Qn(t,e){var n=typeof t;return e=e==null?Zn:e,!!e&&(n=="number"||n!="symbol"&&Jn.test(t))&&t>-1&&t%1==0&&t<e}function Yt(t,e,n){e=="__proto__"&&ot?ot(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Ht(t,e){return t===e||t!==t&&e!==e}var to=Object.prototype,eo=to.hasOwnProperty;function Kt(t,e,n){var o=t[e];(!(eo.call(t,e)&&Ht(o,n))||n===void 0&&!(e in t))&&Yt(t,e,n)}function Z(t,e,n,o){var i=!n;n||(n={});for(var r=-1,s=e.length;++r<s;){var l=e[r],h=o?o(n[l],t[l],l,n,t):void 0;h===void 0&&(h=t[l]),i?Yt(n,l,h):Kt(n,l,h)}return n}var Xt=Math.max;function no(t,e,n){return e=Xt(e===void 0?t.length-1:e,0),function(){for(var o=arguments,i=-1,r=Xt(o.length-e,0),s=Array(r);++i<r;)s[i]=o[e+i];i=-1;for(var l=Array(e+1);++i<e;)l[i]=o[i];return l[e]=n(s),Nn(t,this,l)}}var oo=9007199254740991;function Vt(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=oo}function Wt(t){return t!=null&&Vt(t.length)&&!Ut(t)}var io=Object.prototype;function pt(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||io;return t===n}function ro(t,e){for(var n=-1,o=Array(t);++n<t;)o[n]=e(n);return o}var so="[object Arguments]";function qt(t){return B(t)&&D(t)==so}var Zt=Object.prototype,ao=Zt.hasOwnProperty,lo=Zt.propertyIsEnumerable,ho=qt(function(){return arguments}())?qt:function(t){return B(t)&&ao.call(t,"callee")&&!lo.call(t,"callee")};const Jt=ho;function co(){return!1}var Qt=typeof g=="object"&&g&&!g.nodeType&&g,te=Qt&&typeof module=="object"&&module&&!module.nodeType&&module,go=te&&te.exports===Qt,ee=go?R.Buffer:void 0,uo=ee?ee.isBuffer:void 0,po=uo||co;const ne=po;var fo="[object Arguments]",yo="[object Array]",mo="[object Boolean]",Po="[object Date]",vo="[object Error]",To="[object Function]",bo="[object Map]",Eo="[object Number]",Mo="[object Object]",xo="[object RegExp]",Co="[object Set]",wo="[object String]",Lo="[object WeakMap]",Ro="[object ArrayBuffer]",Io="[object DataView]",ko="[object Float32Array]",_o="[object Float64Array]",$o="[object Int8Array]",Oo="[object Int16Array]",So="[object Int32Array]",Ao="[object Uint8Array]",jo="[object Uint8ClampedArray]",Do="[object Uint16Array]",Bo="[object Uint32Array]",y={};y[ko]=y[_o]=y[$o]=y[Oo]=y[So]=y[Ao]=y[jo]=y[Do]=y[Bo]=!0,y[fo]=y[yo]=y[Ro]=y[mo]=y[Io]=y[Po]=y[vo]=y[To]=y[bo]=y[Eo]=y[Mo]=y[xo]=y[Co]=y[wo]=y[Lo]=!1;function No(t){return B(t)&&Vt(t.length)&&!!y[D(t)]}function ft(t){return function(e){return t(e)}}var oe=typeof g=="object"&&g&&!g.nodeType&&g,J=oe&&typeof module=="object"&&module&&!module.nodeType&&module,Fo=J&&J.exports===oe,dt=Fo&&H.process,Uo=function(){try{var t=J&&J.require&&J.require("util").types;return t||dt&&dt.binding&&dt.binding("util")}catch(e){}}();const K=Uo;var ie=K&&K.isTypedArray,zo=ie?ft(ie):No;const Go=zo;var Yo=Object.prototype,Ho=Yo.hasOwnProperty;function re(t,e){var n=N(t),o=!n&&Jt(t),i=!n&&!o&&ne(t),r=!n&&!o&&!i&&Go(t),s=n||o||i||r,l=s?ro(t.length,String):[],h=l.length;for(var c in t)(e||Ho.call(t,c))&&!(s&&(c=="length"||i&&(c=="offset"||c=="parent")||r&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||Qn(c,h)))&&l.push(c);return l}function se(t,e){return function(n){return t(e(n))}}var Ko=se(Object.keys,Object);const Xo=Ko;var Vo=Object.prototype,Wo=Vo.hasOwnProperty;function qo(t){if(!pt(t))return Xo(t);var e=[];for(var n in Object(t))Wo.call(t,n)&&n!="constructor"&&e.push(n);return e}function yt(t){return Wt(t)?re(t):qo(t)}function Zo(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var Jo=Object.prototype,Qo=Jo.hasOwnProperty;function ti(t){if(!q(t))return Zo(t);var e=pt(t),n=[];for(var o in t)o=="constructor"&&(e||!Qo.call(t,o))||n.push(o);return n}function mt(t){return Wt(t)?re(t,!0):ti(t)}var ei=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ni=/^\w*$/;function oi(t,e){if(N(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||ct(t)?!0:ni.test(t)||!ei.test(t)||e!=null&&t in Object(e)}var ii=U(Object,"create");const Q=ii;function ri(){this.__data__=Q?Q(null):{},this.size=0}function si(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var ai="__lodash_hash_undefined__",li=Object.prototype,hi=li.hasOwnProperty;function ci(t){var e=this.__data__;if(Q){var n=e[t];return n===ai?void 0:n}return hi.call(e,t)?e[t]:void 0}var gi=Object.prototype,ui=gi.hasOwnProperty;function pi(t){var e=this.__data__;return Q?e[t]!==void 0:ui.call(e,t)}var fi="__lodash_hash_undefined__";function di(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Q&&e===void 0?fi:e,this}function z(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}z.prototype.clear=ri,z.prototype.delete=si,z.prototype.get=ci,z.prototype.has=pi,z.prototype.set=di;function yi(){this.__data__=[],this.size=0}function it(t,e){for(var n=t.length;n--;)if(Ht(t[n][0],e))return n;return-1}var mi=Array.prototype,Pi=mi.splice;function vi(t){var e=this.__data__,n=it(e,t);if(n<0)return!1;var o=e.length-1;return n==o?e.pop():Pi.call(e,n,1),--this.size,!0}function Ti(t){var e=this.__data__,n=it(e,t);return n<0?void 0:e[n][1]}function bi(t){return it(this.__data__,t)>-1}function Ei(t,e){var n=this.__data__,o=it(n,t);return o<0?(++this.size,n.push([t,e])):n[o][1]=e,this}function $(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}$.prototype.clear=yi,$.prototype.delete=vi,$.prototype.get=Ti,$.prototype.has=bi,$.prototype.set=Ei;var Mi=U(R,"Map");const tt=Mi;function xi(){this.size=0,this.__data__={hash:new z,map:new(tt||$),string:new z}}function Ci(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function rt(t,e){var n=t.__data__;return Ci(e)?n[typeof e=="string"?"string":"hash"]:n.map}function wi(t){var e=rt(this,t).delete(t);return this.size-=e?1:0,e}function Li(t){return rt(this,t).get(t)}function Ri(t){return rt(this,t).has(t)}function Ii(t,e){var n=rt(this,t),o=n.size;return n.set(t,e),this.size+=n.size==o?0:1,this}function A(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}A.prototype.clear=xi,A.prototype.delete=wi,A.prototype.get=Li,A.prototype.has=Ri,A.prototype.set=Ii;var ki="Expected a function";function Pt(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(ki);var n=function(){var o=arguments,i=e?e.apply(this,o):o[0],r=n.cache;if(r.has(i))return r.get(i);var s=t.apply(this,o);return n.cache=r.set(i,s)||r,s};return n.cache=new(Pt.Cache||A),n}Pt.Cache=A;var _i=500;function $i(t){var e=Pt(t,function(o){return n.size===_i&&n.clear(),o}),n=e.cache;return e}var Oi=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Si=/\\(\\)?/g,Ai=$i(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Oi,function(n,o,i,r){e.push(i?r.replace(Si,"$1"):o||n)}),e});const ji=Ai;function Di(t){return t==null?"":Ft(t)}function vt(t,e){return N(t)?t:oi(t,e)?[t]:ji(Di(t))}var Bi=1/0;function ae(t){if(typeof t=="string"||ct(t))return t;var e=t+"";return e=="0"&&1/t==-Bi?"-0":e}function le(t,e){e=vt(e,t);for(var n=0,o=e.length;t!=null&&n<o;)t=t[ae(e[n++])];return n&&n==o?t:void 0}function he(t,e,n){var o=t==null?void 0:le(t,e);return o===void 0?n:o}function Tt(t,e){for(var n=-1,o=e.length,i=t.length;++n<o;)t[i+n]=e[n];return t}var ce=I?I.isConcatSpreadable:void 0;function Ni(t){return N(t)||Jt(t)||!!(ce&&t&&t[ce])}function ge(t,e,n,o,i){var r=-1,s=t.length;for(n||(n=Ni),i||(i=[]);++r<s;){var l=t[r];e>0&&n(l)?e>1?ge(l,e-1,n,o,i):Tt(i,l):o||(i[i.length]=l)}return i}function Fi(t){var e=t==null?0:t.length;return e?ge(t,1):[]}function Ui(t){return Wn(no(t,void 0,Fi),t+"")}var zi=se(Object.getPrototypeOf,Object);const bt=zi;var Gi="[object Object]",Yi=Function.prototype,Hi=Object.prototype,ue=Yi.toString,Ki=Hi.hasOwnProperty,Xi=ue.call(Object);function Vi(t){if(!B(t)||D(t)!=Gi)return!1;var e=bt(t);if(e===null)return!0;var n=Ki.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&ue.call(n)==Xi}function Wi(t,e,n){var o=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var r=Array(i);++o<i;)r[o]=t[o+e];return r}function qi(){this.__data__=new $,this.size=0}function Zi(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function Ji(t){return this.__data__.get(t)}function Qi(t){return this.__data__.has(t)}var tr=200;function er(t,e){var n=this.__data__;if(n instanceof $){var o=n.__data__;if(!tt||o.length<tr-1)return o.push([t,e]),this.size=++n.size,this;n=this.__data__=new A(o)}return n.set(t,e),this.size=n.size,this}function X(t){var e=this.__data__=new $(t);this.size=e.size}X.prototype.clear=qi,X.prototype.delete=Zi,X.prototype.get=Ji,X.prototype.has=Qi,X.prototype.set=er;function nr(t,e){return t&&Z(e,yt(e),t)}function or(t,e){return t&&Z(e,mt(e),t)}var pe=typeof g=="object"&&g&&!g.nodeType&&g,fe=pe&&typeof module=="object"&&module&&!module.nodeType&&module,ir=fe&&fe.exports===pe,de=ir?R.Buffer:void 0,ye=de?de.allocUnsafe:void 0;function rr(t,e){if(e)return t.slice();var n=t.length,o=ye?ye(n):new t.constructor(n);return t.copy(o),o}function sr(t,e){for(var n=-1,o=t==null?0:t.length,i=0,r=[];++n<o;){var s=t[n];e(s,n,t)&&(r[i++]=s)}return r}function me(){return[]}var ar=Object.prototype,lr=ar.propertyIsEnumerable,Pe=Object.getOwnPropertySymbols,hr=Pe?function(t){return t==null?[]:(t=Object(t),sr(Pe(t),function(e){return lr.call(t,e)}))}:me;const Et=hr;function cr(t,e){return Z(t,Et(t),e)}var gr=Object.getOwnPropertySymbols,ur=gr?function(t){for(var e=[];t;)Tt(e,Et(t)),t=bt(t);return e}:me;const ve=ur;function pr(t,e){return Z(t,ve(t),e)}function Te(t,e,n){var o=e(t);return N(t)?o:Tt(o,n(t))}function fr(t){return Te(t,yt,Et)}function be(t){return Te(t,mt,ve)}var dr=U(R,"DataView");const Mt=dr;var yr=U(R,"Promise");const xt=yr;var mr=U(R,"Set");const Ct=mr;var Ee="[object Map]",Pr="[object Object]",Me="[object Promise]",xe="[object Set]",Ce="[object WeakMap]",we="[object DataView]",vr=F(Mt),Tr=F(tt),br=F(xt),Er=F(Ct),Mr=F(ut),G=D;(Mt&&G(new Mt(new ArrayBuffer(1)))!=we||tt&&G(new tt)!=Ee||xt&&G(xt.resolve())!=Me||Ct&&G(new Ct)!=xe||ut&&G(new ut)!=Ce)&&(G=function(t){var e=D(t),n=e==Pr?t.constructor:void 0,o=n?F(n):"";if(o)switch(o){case vr:return we;case Tr:return Ee;case br:return Me;case Er:return xe;case Mr:return Ce}return e});const wt=G;var xr=Object.prototype,Cr=xr.hasOwnProperty;function wr(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&Cr.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var Lr=R.Uint8Array;const Le=Lr;function Lt(t){var e=new t.constructor(t.byteLength);return new Le(e).set(new Le(t)),e}function Rr(t,e){var n=e?Lt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var Ir=/\w*$/;function kr(t){var e=new t.constructor(t.source,Ir.exec(t));return e.lastIndex=t.lastIndex,e}var Re=I?I.prototype:void 0,Ie=Re?Re.valueOf:void 0;function _r(t){return Ie?Object(Ie.call(t)):{}}function $r(t,e){var n=e?Lt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var Or="[object Boolean]",Sr="[object Date]",Ar="[object Map]",jr="[object Number]",Dr="[object RegExp]",Br="[object Set]",Nr="[object String]",Fr="[object Symbol]",Ur="[object ArrayBuffer]",zr="[object DataView]",Gr="[object Float32Array]",Yr="[object Float64Array]",Hr="[object Int8Array]",Kr="[object Int16Array]",Xr="[object Int32Array]",Vr="[object Uint8Array]",Wr="[object Uint8ClampedArray]",qr="[object Uint16Array]",Zr="[object Uint32Array]";function Jr(t,e,n){var o=t.constructor;switch(e){case Ur:return Lt(t);case Or:case Sr:return new o(+t);case zr:return Rr(t,n);case Gr:case Yr:case Hr:case Kr:case Xr:case Vr:case Wr:case qr:case Zr:return $r(t,n);case Ar:return new o;case jr:case Nr:return new o(t);case Dr:return kr(t);case Br:return new o;case Fr:return _r(t)}}function Qr(t){return typeof t.constructor=="function"&&!pt(t)?Bn(bt(t)):{}}var ts="[object Map]";function es(t){return B(t)&&wt(t)==ts}var ke=K&&K.isMap,ns=ke?ft(ke):es;const os=ns;var is="[object Set]";function rs(t){return B(t)&&wt(t)==is}var _e=K&&K.isSet,ss=_e?ft(_e):rs;const as=ss;var ls=1,hs=2,cs=4,$e="[object Arguments]",gs="[object Array]",us="[object Boolean]",ps="[object Date]",fs="[object Error]",Oe="[object Function]",ds="[object GeneratorFunction]",ys="[object Map]",ms="[object Number]",Se="[object Object]",Ps="[object RegExp]",vs="[object Set]",Ts="[object String]",bs="[object Symbol]",Es="[object WeakMap]",Ms="[object ArrayBuffer]",xs="[object DataView]",Cs="[object Float32Array]",ws="[object Float64Array]",Ls="[object Int8Array]",Rs="[object Int16Array]",Is="[object Int32Array]",ks="[object Uint8Array]",_s="[object Uint8ClampedArray]",$s="[object Uint16Array]",Os="[object Uint32Array]",d={};d[$e]=d[gs]=d[Ms]=d[xs]=d[us]=d[ps]=d[Cs]=d[ws]=d[Ls]=d[Rs]=d[Is]=d[ys]=d[ms]=d[Se]=d[Ps]=d[vs]=d[Ts]=d[bs]=d[ks]=d[_s]=d[$s]=d[Os]=!0,d[fs]=d[Oe]=d[Es]=!1;function st(t,e,n,o,i,r){var s,l=e&ls,h=e&hs,c=e&cs;if(n&&(s=i?n(t,o,i,r):n(t)),s!==void 0)return s;if(!q(t))return t;var u=N(t);if(u){if(s=wr(t),!l)return Fn(t,s)}else{var p=wt(t),b=p==Oe||p==ds;if(ne(t))return rr(t,l);if(p==Se||p==$e||b&&!i){if(s=h||b?{}:Qr(t),!l)return h?pr(t,or(s,t)):cr(t,nr(s,t))}else{if(!d[p])return i?t:{};s=Jr(t,p,l)}}r||(r=new X);var E=r.get(t);if(E)return E;r.set(t,s),as(t)?t.forEach(function(T){s.add(st(T,e,n,T,t,r))}):os(t)&&t.forEach(function(T,L){s.set(L,st(T,e,n,L,t,r))});var v=c?h?be:fr:h?mt:yt,M=u?void 0:v(t);return qn(M||t,function(T,L){M&&(L=T,T=t[L]),Kt(s,L,st(T,e,n,L,t,r))}),s}function Ss(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function As(t,e){return e.length<2?t:le(t,Wi(e,0,-1))}var js=R.isFinite;function w(t){return typeof t=="number"&&js(t)}function Ds(t,e){return e=vt(e,t),t=As(t,e),t==null||delete t[ae(Ss(e))]}function Bs(t){return Vi(t)?void 0:t}var Ns=1,Fs=2,Us=4,zs=Ui(function(t,e){var n={};if(t==null)return n;var o=!1;e=Dt(e,function(r){return r=vt(r,t),o||(o=r.length>1),r}),Z(t,be(t),n),o&&(n=st(n,Ns|Fs|Us,Bs));for(var i=e.length;i--;)Ds(n,e[i]);return n});const Gs=zs,Ae={radius:6,zIndex:0,strokeOpacity:0,fillOpacity:0};class Rt{constructor(e){a(this,"map");a(this,"options",C({},Ae));a(this,"circleMarkers",[]);this.map=e}setOptions(e){return this.options=C(C({},e),Gs(Ae,"radius")),this}createCircleMarkersByPaths(e){this.removeFromTheMap(),this.reset(),e.forEach(n=>{this.circleMarkers.push(this.createCircleMarker(n))}),this.addToMap()}createCircleMarker(e){return new AMap.CircleMarker(C({center:e},this.options))}addToMap(){this.map.add(this.circleMarkers)}removeFromTheMap(){this.map.remove(this.circleMarkers)}getPointInCircleMarkers(e){var n;return(n=this.circleMarkers.find(o=>this.isPointInCircle(e,o)))!=null?n:null}getInCircleMarkersPoint(e){const n=this.circleMarkers.find(i=>this.isPointInCircle(e,i));return this.circleMarkers.findIndex(i=>i===n)%2===0?null:n!=null?n:null}isPointInCircle(e,n){return n.contains(e)}reset(){this.circleMarkers=[]}destroy(){this.removeFromTheMap(),this.reset()}}const je={zIndex:1,strokeColor:"#00D3FC",strokeWeight:8,strokeOpacity:0};class De{constructor(e){a(this,"map");a(this,"linesPath",[]);a(this,"lines",[]);if(!e)throw new Error("map not found");this.map=e}getLinesByPaths(e){let n=0;const o=e.length;for(;n<o;){const i=n+1>=o?0:n+1;this.linesPath.push([e[n],e[i]]),n++}return this.linesPath}createLinesByPaths(e){this.reset(),this.getLinesByPaths(e)}createPolyLine(e){return new AMap.Polyline(C({path:e},je))}addToMap(){this.map.add(this.lines)}removeFromTheMap(){this.map.remove(this.lines)}getPointInPolyline(e){const n=this.map.getResolution(),o=je.strokeWeight*n;return this.linesPath.find(r=>AMap.GeometryUtil.isPointOnSegment(e,r[0],r[1],o))}reset(){this.linesPath=[],this.lines=[]}}class Be{constructor(e,n){a(this,"map");a(this,"circleMarkers",null);a(this,"midCircleMarkers",null);a(this,"lines",null);a(this,"polygonEditor",null);a(this,"polygonPaths",[]);a(this,"polygonTotalPaths",[]);a(this,"polygon",null);a(this,"startPointToCursorText",null);a(this,"lastPointToCursorText",null);a(this,"lineLengthText",null);a(this,"circleMarker",null);a(this,"midCircleMarker",null);a(this,"startPosition",null);a(this,"lastPosition",null);a(this,"editingMidTipMarkerListPath",null);a(this,"onPolygonEditorAdjust",({target:e})=>{this.polygonPaths=e.getPath(),this.circleMarkers.createCircleMarkersByPaths(this.polygonPaths),this.lines.createLinesByPaths(this.polygonPaths),Promise.resolve().then(()=>{this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.midCircleMarkers.createCircleMarkersByPaths(this.polygonTotalPaths)}),this.reset()});a(this,"onMouseDown",e=>{const n=e.lnglat;this.circleMarker=this.circleMarkers.getPointInCircleMarkers(n),this.midCircleMarker=this.midCircleMarkers.getInCircleMarkersPoint(n)});a(this,"onMovePolygonEditorPoint",e=>{if(this.midCircleMarker)return;if(!this.circleMarker){this.reset();return}const n=this.circleMarker.getCenter(),o=u=>`${u.lng}-${u.lat}`;let i=this.polygonPaths.findIndex(u=>o(u)===o(n));if(i===-1)return;const r=this.polygonPaths.length,s=i-1<=-1?r-1:i-1,l=i+1>=r?0:i+1,h=this.polygonPaths.at(s),c=this.polygonPaths.at(l);this.setPosition(h,c),this.onMouseMoveInDrawPolygon(e)});a(this,"onMovePolygonEditorMidPoint",e=>{if(this.circleMarker)return;if(!this.midCircleMarker){this.reset();return}const n=this.midCircleMarker.getCenter(),o=u=>`${u.lng}-${u.lat}`;let i=this.polygonTotalPaths.findIndex(u=>o(u)===o(n));if(i===-1)return;const r=this.polygonTotalPaths.length,s=i-1<=-1?r-1:i-1,l=i+1>=r?0:i+1,h=this.polygonTotalPaths.at(s),c=this.polygonTotalPaths.at(l);this.setPosition(h,c),this.onMouseMoveInDrawPolygon(e)});a(this,"onMouseUp",()=>{this.circleMarker=null,this.midCircleMarker=null,this.reset()});a(this,"onInPolygonEditorLine",e=>{if(this.circleMarker)return this.removeLineDistanceText();const n=e.lnglat,o=this.lines.getPointInPolyline(n);if(!o)return this.removeLineDistanceText();const[i,r]=o;this.lineLengthText||(this.lineLengthText=O(),this.lineLengthText.add(this.map)),this.updateDistanceText(this.lineLengthText,S(i,r))});a(this,"onMouseMoveInDrawPolygon",e=>{if(!this.startPosition||!this.lastPosition)return;const n=e.lnglat;this.updateDistanceText(this.startPointToCursorText,S(this.startPosition,n)),this.updateDistanceText(this.lastPointToCursorText,S(this.lastPosition,n))});if(!e)throw new Error("map not found!");this.map=e,n&&(this.polygonEditor=n),this.circleMarkers=new Rt(this.map),this.midCircleMarkers=new Rt(this.map),this.lines=new De(this.map)}getPolygonEditorTargetPaths(){var e,n,o;return this.polygonEditor?(o=(n=(e=this.polygonEditor)==null?void 0:e.getTarget)==null?void 0:n.call(e).getPath())!=null?o:[]:[]}setEditingMidTipMarkerListPath(e){return this.editingMidTipMarkerListPath=e,this}getEditingMidTipMarkerList(){var n,o;const{singleRingListHandle:e}=this.polygonEditor;if(this.editingMidTipMarkerListPath){if(typeof this.editingMidTipMarkerListPath=="function")return this.editingMidTipMarkerListPath(this.polygonEditor);if(typeof this.editingMidTipMarkerListPath=="string")return he(this.polygonEditor,this.editingMidTipMarkerListPath)}return(n=this.polygonEditor.editingMidTipMarkerList)!=null&&n.length?this.polygonEditor.editingMidTipMarkerList:e?(o=e==null?void 0:e.list)==null?void 0:o.editingMidTipMarkerList:[]}getPolygonEditorTargetTotalPaths(){const e=this.getPolygonEditorTargetPaths(),n=this.getEditingMidTipMarkerList();let o=0;const i=[],r=e.length;for(;o<r;){i.push(e[o]);const s=n[o];s&&i.push(s.getCenter()),o++}return i}open(e){this.start(e)}start(e){var i,r,s;if(!e&&!this.polygonEditor)throw new Error("polygonEditor not found");this.polygonEditor=e;const{controlPoint:n,midControlPoint:o}=this.polygonEditor;return this.polygonPaths=this.getPolygonEditorTargetPaths(),this.circleMarkers.setOptions(n).createCircleMarkersByPaths(this.polygonPaths),this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.midCircleMarkers.setOptions(o).createCircleMarkersByPaths(this.polygonTotalPaths),this.lines.createLinesByPaths(this.polygonPaths),(i=this.polygonEditor)==null||i.on("adjust",this.onPolygonEditorAdjust),(r=this.polygonEditor)==null||r.on("removenode",this.onPolygonEditorAdjust),(s=this.polygonEditor)==null||s.on("addnode",this.onPolygonEditorAdjust),this.map.on("mousedown",this.onMouseDown),this.map.on("touchstart",this.onMouseDown),this.map.on("mousemove",this.onMovePolygonEditorPoint),this.map.on("touchmove",this.onMovePolygonEditorPoint),this.map.on("mousemove",this.onMovePolygonEditorMidPoint),this.map.on("touchmove",this.onMovePolygonEditorMidPoint),this.map.on("mousemove",this.onInPolygonEditorLine),this.map.on("touchmove",this.onInPolygonEditorLine),this.map.on("mouseup",this.onMouseUp),this.map.on("touchend",this.onMouseUp),this}close(){this.stop()}stop(){var e,n,o;(e=this.polygonEditor)==null||e.off("adjust",this.onPolygonEditorAdjust),(n=this.polygonEditor)==null||n.off("removenode",this.onPolygonEditorAdjust),(o=this.polygonEditor)==null||o.off("addnode",this.onPolygonEditorAdjust),this.map.off("mousedown",this.onMouseDown),this.map.off("touchstart",this.onMouseDown),this.map.off("mousemove",this.onMovePolygonEditorPoint),this.map.off("touchmove",this.onMovePolygonEditorPoint),this.map.off("mousemove",this.onMovePolygonEditorMidPoint),this.map.off("touchmove",this.onMovePolygonEditorMidPoint),this.map.off("mousemove",this.onInPolygonEditorLine),this.map.off("touchmove",this.onInPolygonEditorLine),this.map.off("mouseup",this.onMouseUp),this.map.off("touchend",this.onMouseUp)}startLineRanging(e){if(!e)throw new Error("polygonEditor not found");this.polygon||(this.polygon=e,this.lines.createLinesByPaths(this.polygon.getPath()),this.map.on("mousemove",this.onInPolygonEditorLine))}stopLineRanging(){this.map.off("mousemove",this.onInPolygonEditorLine)}setPosition(e,n){this.startPosition=e,this.lastPosition=n,this.createDistanceText()}createDistanceText(){this.startPointToCursorText&&this.lastPointToCursorText||(this.startPointToCursorText=O(),this.lastPointToCursorText=O(),this.startPointToCursorText.setMap(this.map),this.lastPointToCursorText.setMap(this.map))}updateDistanceText(e,{text:n,textPos:o}){e.setText(n),e.setPosition(o)}removeLineDistanceText(){var e;(e=this.lineLengthText)==null||e.remove(),this.lineLengthText=null}removeDistanceText(){var e,n;(e=this.startPointToCursorText)==null||e.remove(),(n=this.lastPointToCursorText)==null||n.remove(),this.startPointToCursorText=null,this.lastPointToCursorText=null}reset(){return this.startPosition=null,this.lastPosition=null,this.removeDistanceText(),this.removeLineDistanceText(),this}destroy(){return this.reset(),this.stop(),this.circleMarkers.destroy(),this}destroyLineRanging(){return this.polygon=null,this.startPosition=null,this.lastPosition=null,this.removeLineDistanceText(),this.stopLineRanging(),this}}class Ne{constructor(e,n){a(this,"opts");a(this,"map");a(this,"lines",null);a(this,"polygon",null);a(this,"lineLengthText",null);a(this,"editingMidTipMarkerListPath",null);a(this,"onPolygonRanging",e=>{const n=e.lnglat,o=this.lines.getPointInPolyline(n);if(!o)return this.removeLineDistanceText();const[i,r]=o;this.lineLengthText||(this.lineLengthText=O(),this.lineLengthText.add(this.map)),this.updateDistanceText(this.lineLengthText,S(i,r))});a(this,"onRotateEndEnd",()=>j(this,null,function*(){yield Promise.resolve();const e=this.polygon;this.onDragEnd({target:e})}));a(this,"onDragEnd",e=>j(this,null,function*(){var o;const n=e.target;(o=this.lines)==null||o.reset(),yield Promise.resolve(),this.lines.createLinesByPaths(n.getPath())}));if(!e)throw new Error("map not found!");this.opts=n,this.map=e,this.lines=new De(this.map),this.immediateActive()}get immediate(){var e;return(e=this.opts)==null?void 0:e.immediate}get draggable(){var n;return((n=this.polygon)==null?void 0:n.getOptions()).draggable}get rotatable(){var e;return(e=this.polygon)==null?void 0:e.rotatable}immediateActive(){var n;const e=(n=this.opts)==null?void 0:n.target;this.immediate&&e.CLASS_NAME==="Overlay.Polygon"&&this.open(e)}open(e){this.start(e||this.polygon)}start(e){if(!e)return;this.polygon=e,this.lines.createLinesByPaths(this.polygon.getPath()),this.map.hasEvents("mousemove",this.onPolygonRanging)||this.map.hasEvents("touchmove",this.onPolygonRanging)||(this.map.on("mousemove",this.onPolygonRanging),this.map.on("touchmove",this.onPolygonRanging)),this.registryPolygonEvents()}registryPolygonEvents(){this.polygon&&(this.draggable&&this.polygon.on("dragend",this.onDragEnd),this.rotatable&&"likeRectangle"in this.polygon&&this.polygon.on("rotateEnd",this.onRotateEndEnd))}destroyPolygonEvents(){var e,n,o,i;this.polygon&&((n=(e=this.polygon).off)==null||n.call(e,"dragend",this.onDragEnd),(i=(o=this.polygon).off)==null||i.call(o,"rotateEnd",this.onRotateEndEnd))}close(){this.stop()}stop(){this.map.off("mousemove",this.onPolygonRanging)}updateDistanceText(e,{text:n,textPos:o}){e.setText(n),e.setPosition(o)}removeLineDistanceText(){var e;(e=this.lineLengthText)==null||e.remove(),this.lineLengthText=null}destroy(){return this.stop(),this.removeLineDistanceText(),this.destroyPolygonEvents(),this.polygon=null,this}}class It{constructor(){a(this,"events",{})}getEvents(e){return this.events[e]||(this.events[e]=[]),this.events[e]}emit(e,...n){this.getEvents(e).forEach(i=>i(...n))}on(e,n){!e||typeof e!="string"||this.getEvents(e).push(n)}once(e,n){if(!e||typeof e!="string")return;const o=i=>{n(i),this.off(e,o)};this.on(e,o)}off(e,n){if(!(!e||typeof e!="string")){if(!n)return this.clearEvents(e);this.events[e]=this.getEvents(e).filter(o=>o!==n)}}hasEvents(e,n){return!!this.getEvents(e).find(o=>o===n)}clearEvents(e){e?this.events[e]=[]:this.events={}}}class Fe extends It{constructor(n){super();a(this,"map");a(this,"circleMarkers",null);a(this,"polygonEditor",null);a(this,"polygonTotalPaths",[]);a(this,"circleMarker",null);a(this,"editingMidTipMarkerListPath",null);a(this,"onPolygonEditorAdjust",()=>{Promise.resolve().then(()=>{this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.circleMarkers.createCircleMarkersByPaths(this.polygonTotalPaths)})});a(this,"onMouseDown",n=>{const o=n.lnglat;this.circleMarker=this.circleMarkers.getPointInCircleMarkers(o),!(!this.circleMarker||!this.getEvents("mousedown").length)&&this.emit("mousedown",this.circleMarker)});a(this,"onMouseMove",n=>{!this.circleMarker||!this.getEvents("mousemove").length||this.emit("mousemove",this.circleMarker,n)});a(this,"onMouseUp",()=>{!this.getEvents("mouseup").length||!this.circleMarker||(this.emit("mouseup",this.circleMarker),this.circleMarker=null)});this.map=n.map,this.polygonEditor=n,this.circleMarkers=new Rt(this.map),this.open(this.polygonEditor)}getPolygonEditorTargetPaths(){var n;return this.polygonEditor?(n=this.polygonEditor.getTarget().getPath())!=null?n:[]:[]}setEditingMidTipMarkerListPath(n){return this.editingMidTipMarkerListPath=n,this}getEditingMidTipMarkerList(){var o,i;const{singleRingListHandle:n}=this.polygonEditor;if(this.editingMidTipMarkerListPath){if(typeof this.editingMidTipMarkerListPath=="function")return this.editingMidTipMarkerListPath(this.polygonEditor);if(typeof this.editingMidTipMarkerListPath=="string")return he(this.polygonEditor,this.editingMidTipMarkerListPath)}return(o=this.polygonEditor.editingMidTipMarkerList)!=null&&o.length?this.polygonEditor.editingMidTipMarkerList:n?(i=n==null?void 0:n.list)==null?void 0:i.editingMidTipMarkerList:[]}getPolygonEditorTargetTotalPaths(){const n=this.getPolygonEditorTargetPaths(),o=this.getEditingMidTipMarkerList();let i=0;const r=[],s=n.length;for(;i<s;){r.push(n[i]);const l=o[i];l&&r.push(l.getCenter()),i++}return r}open(n){this.start(n)}start(n){var i,r,s;if(!n&&!this.polygonEditor)throw new Error("polygonEditor not found");this.polygonEditor=n;const{midControlPoint:o}=this.polygonEditor;return this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.circleMarkers.setOptions(o).createCircleMarkersByPaths(this.polygonTotalPaths),(i=this.polygonEditor)==null||i.on("adjust",this.onPolygonEditorAdjust),(r=this.polygonEditor)==null||r.on("removenode",this.onPolygonEditorAdjust),(s=this.polygonEditor)==null||s.on("addnode",this.onPolygonEditorAdjust),this.map.on("mousedown",this.onMouseDown),this.map.on("mousemove",this.onMouseMove),this.map.on("mouseup",this.onMouseUp),this}close(){this.stop()}stop(){this.map.off("mousedown",this.onMouseDown),this.map.off("mousemove",this.onMouseMove),this.map.off("mouseup",this.onMouseUp)}destroy(){return this.close(),this.circleMarkers.destroy(),this}}var Ys=Object.defineProperty,Hs=(t,e,n)=>e in t?Ys(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,k=(t,e,n)=>(Hs(t,typeof e!="symbol"?e+"":e,n),n);function Ks(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var kt={exports:{}},V=typeof Reflect=="object"?Reflect:null,Ue=V&&typeof V.apply=="function"?V.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)},at;V&&typeof V.ownKeys=="function"?at=V.ownKeys:Object.getOwnPropertySymbols?at=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:at=function(t){return Object.getOwnPropertyNames(t)};function ma(t){}var ze=Number.isNaN||function(t){return t!==t};function f(){f.init.call(this)}kt.exports=f,kt.exports.once=qs,f.EventEmitter=f,f.prototype._events=void 0,f.prototype._eventsCount=0,f.prototype._maxListeners=void 0;var Ge=10;function lt(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(f,"defaultMaxListeners",{enumerable:!0,get:function(){return Ge},set:function(t){if(typeof t!="number"||t<0||ze(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Ge=t}}),f.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},f.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||ze(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Ye(t){return t._maxListeners===void 0?f.defaultMaxListeners:t._maxListeners}f.prototype.getMaxListeners=function(){return Ye(this)},f.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var o=t==="error",i=this._events;if(i!==void 0)o=o&&i.error===void 0;else if(!o)return!1;if(o){var r;if(e.length>0&&(r=e[0]),r instanceof Error)throw r;var s=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw s.context=r,s}var l=i[t];if(l===void 0)return!1;if(typeof l=="function")Ue(l,this,e);else for(var h=l.length,c=We(l,h),n=0;n<h;++n)Ue(c[n],this,e);return!0};function He(t,e,n,o){var i,r,s;if(lt(n),r=t._events,r===void 0?(r=t._events=Object.create(null),t._eventsCount=0):(r.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),r=t._events),s=r[e]),s===void 0)s=r[e]=n,++t._eventsCount;else if(typeof s=="function"?s=r[e]=o?[n,s]:[s,n]:o?s.unshift(n):s.push(n),i=Ye(t),i>0&&s.length>i&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=s.length}return t}f.prototype.addListener=function(t,e){return He(this,t,e,!1)},f.prototype.on=f.prototype.addListener,f.prototype.prependListener=function(t,e){return He(this,t,e,!0)};function Xs(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ke(t,e,n){var o={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=Xs.bind(o);return i.listener=n,o.wrapFn=i,i}f.prototype.once=function(t,e){return lt(e),this.on(t,Ke(this,t,e)),this},f.prototype.prependOnceListener=function(t,e){return lt(e),this.prependListener(t,Ke(this,t,e)),this},f.prototype.removeListener=function(t,e){var n,o,i,r,s;if(lt(e),o=this._events,o===void 0)return this;if(n=o[t],n===void 0)return this;if(n===e||n.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete o[t],o.removeListener&&this.emit("removeListener",t,n.listener||e));else if(typeof n!="function"){for(i=-1,r=n.length-1;r>=0;r--)if(n[r]===e||n[r].listener===e){s=n[r].listener,i=r;break}if(i<0)return this;i===0?n.shift():Vs(n,i),n.length===1&&(o[t]=n[0]),o.removeListener!==void 0&&this.emit("removeListener",t,s||e)}return this},f.prototype.off=f.prototype.removeListener,f.prototype.removeAllListeners=function(t){var e,n,o;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var i=Object.keys(n),r;for(o=0;o<i.length;++o)r=i[o],r!=="removeListener"&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=n[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(o=e.length-1;o>=0;o--)this.removeListener(t,e[o]);return this};function Xe(t,e,n){var o=t._events;if(o===void 0)return[];var i=o[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?Ws(i):We(i,i.length)}f.prototype.listeners=function(t){return Xe(this,t,!0)},f.prototype.rawListeners=function(t){return Xe(this,t,!1)},f.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Ve.call(t,e)},f.prototype.listenerCount=Ve;function Ve(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}f.prototype.eventNames=function(){return this._eventsCount>0?at(this._events):[]};function We(t,e){for(var n=new Array(e),o=0;o<e;++o)n[o]=t[o];return n}function Vs(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Ws(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function qs(t,e){return new Promise(function(n,o){function i(s){t.removeListener(e,r),o(s)}function r(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}qe(t,e,r,{once:!0}),e!=="error"&&Zs(t,i,{once:!0})})}function Zs(t,e,n){typeof t.on=="function"&&qe(t,"error",e,n)}function qe(t,e,n,o){if(typeof t.on=="function")o.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(r){o.once&&t.removeEventListener(e,i),n(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var Js=kt.exports;const Qs=Ks(Js),ta=()=>`ID_${Math.floor(Math.random()*100)}`,ea=(t,e=2)=>Number.isNaN(+t)?t:+(+t).toFixed(e),Ze="-26px";class na extends Qs{constructor(e,n={}){if(super(),k(this,"centerPos",{x:0,y:0}),k(this,"startPos",{x:0,y:0}),k(this,"originRotate",0),k(this,"target",null),k(this,"container"),k(this,"options"),k(this,"targetClassName",ta()),k(this,"onMouseDown",o=>{o.stopPropagation(),this.originRotate=0,this.startPos={x:o.x,y:o.y},this.calcCenterPos();const i=this.container.style.transform,r=/rotate\((.*)deg\)/g;i.replace(r,(l,h)=>(h=+h,this.originRotate+=h)),this.originRotate=(+this.originRotate||0)%360;const s={event:o,target:this.container,rotate:this.originRotate};this.emit("rotateStart",s),document.addEventListener("mousemove",this.onMouseMove,!1)}),k(this,"onMouseMove",o=>{const i=this.container.style.transform||"rotate(0deg)",r=ea((this.calcRotate(this.startPos,o)+this.originRotate)%360),s=/rotate\(.*deg\)/g,l=i.replace(s,()=>`rotate(${r}deg)`);this.container.style.transform=l;const h={event:o,target:this.container,rotate:r};this.emit("rotate",h)}),k(this,"onMouseUp",o=>{const i={event:o,target:this.container};this.emit("rotateEnd",i),document.removeEventListener("mousemove",this.onMouseMove)}),!e)throw new Error("not found container");this.container=e,this.options=n,this.originRotate=(this.options.rotate||0)%360,this.createTargetElement(),this.setInitStyle(),this.calcCenterPos(),this.registryEvents()}createTargetElement(){var e;const{top:n=Ze,able:o}=this.options;let i=`${n}`.replace("px","").trim();i.indexOf("%")===-1&&(i=Number.isNaN(+i)?Ze:`${i}px`);const r=`
        position: absolute;
        top: ${i};
        left: 50%;
        min-width: 14px;
        min-height: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        transform: translate(-50%, -50%);
        cursor: pointer;
      `,s=`
      <div class="${this.targetClassName}" style="${r}">
        <svg width="14" height="14" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M10.536 3.464A5 5 0 1 0 11 10l1.424 1.425a7 7 0 1 1-.475-9.374L13.659.34A.2.2 0 0 1 14 .483V5.5a.5.5 0 0 1-.5.5H8.483a.2.2 0 0 1-.142-.341l2.195-2.195z"
              fill="#eb5648"
              fillRule="nonzero"
            />
          </svg>
      </div>`,l=new DOMParser().parseFromString(s,"text/html"),h=l.body.firstChild;if(o instanceof Element){const c=l.body.querySelector("svg");h.replaceChild(o,c)}(e=this.container)==null||e.appendChild(h),this.target=document.querySelector(`.${this.targetClassName}`)}setInitStyle(){var e;if((e=this.container)!=null&&e.style.getPropertyValue("position")||(this.container.style.position="relative"),this.originRotate){const n=window.getComputedStyle(this.container,null);let o=this.container.style.transform||n.getPropertyValue("transform");o=o.replace(/rotate\((.*)deg\)/g,"").trim(),o=o==="none"?"":o,this.container.style.transform=`${o} rotate(${this.originRotate}deg)`}}calcCenterPos(){const{x:e,y:n,width:o,height:i}=this.container.getBoundingClientRect(),r=e+o/2,s=n+i/2;this.setCenterPos({x:r,y:s})}setCenterPos(e){this.centerPos.x=e.x,this.centerPos.y=e.y}destroy(){this.target=null,this.container=null,this.destroyEvents()}registryEvents(){this.target.addEventListener("mousedown",this.onMouseDown,!1),document.addEventListener("mouseup",this.onMouseUp)}destroyEvents(){return document.removeEventListener("mousedown",this.onMouseDown,!1),this}calcRotate(e,n){const{x:o,y:i}=this.centerPos,r={x:e.x-o,y:e.y-i},s={x:n.x-o,y:n.y-i},l=r.x*s.x+r.y*s.y,h=r.x*s.y-r.y*s.x;let c=Math.atan2(h,l);return c=(c+2*Math.PI)%(2*Math.PI),c*(180/Math.PI)}}const oa=(t,e)=>Math.sqrt(Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2)),_t=1e-8,$t=10;class ia extends It{constructor(n,o={}){super();a(this,"likeRectangleIns");a(this,"opts");a(this,"elementRotatorIns",null);a(this,"rotationPointIns",null);a(this,"midPoint");a(this,"initAngle");a(this,"offset");a(this,"rotationLine");a(this,"customRotationDOMId",`ID${P()}`);a(this,"moveableElementId",`ID${P()}`);a(this,"targetElementId",`ID${P()}`);a(this,"genMarkerContent",()=>{const o=`width:${.05}px; height:${.05}px;`,i=Object.entries({display:"inline-block",width:`${this.radius}px`,height:`${this.radius}px`,cursor:"move",background:"#fff",border:"2px solid #cc6666","border-radius":"50%","transform-origin":"50% 100%"}).reduce((s,[l,h])=>s+=`${l}:${h};`,"");return`
            <div
                style="position: relative; ${o}; background: red;"
                data-rotatable-ref="${this.moveableElementId}"
            >
                <div data-rotatable-ref=${this.customRotationDOMId} style="${i}"></div>
            </div>
        `});a(this,"setMarkerRotatable",()=>{const n=document.querySelector(`[data-rotatable-ref="${this.moveableElementId}"]`),o=document.querySelector(`[data-rotatable-ref="${this.customRotationDOMId}"]`);this.offset=this.calcInitOffset();const i={rotate:this.initAngle,top:-this.offset,able:o};this.elementRotatorIns=new na(n,i),this.registryEvent()});a(this,"onRotateStart",()=>{this.emit("rotateStart",this.likeRectangleIns)});a(this,"onRotate",n=>{const{event:o,rotate:i}=n;this.rotate(i-this.initAngle),this.emit("rotate",o)});a(this,"onRotateEnd",()=>{this.emit("rotateEnd",this.likeRectangleIns)});a(this,"rotate",n=>{const o=this.mapIns.lngLatToContainer(this.center),i=this.likeRectangleIns.leftTop,r=this.mapIns.lngLatToContainer(i),s=this.calcRotatePoint(r,o,n),l=new AMap.Pixel(s.x,s.y),h=this.mapIns.containerToLngLat(l),c=this.likeRectangleIns.rightTop,u=this.mapIns.lngLatToContainer(c),p=this.calcRotatePoint(u,o,n),b=new AMap.Pixel(p.x,p.y),E=this.mapIns.containerToLngLat(b),v=this.likeRectangleIns.rightBottom,M=this.mapIns.lngLatToContainer(v),T=this.calcRotatePoint(M,o,n),L=new AMap.Pixel(T.x,T.y),et=this.mapIns.containerToLngLat(L),ht=this.likeRectangleIns.leftBottom,la=this.mapIns.lngLatToContainer(ht),tn=this.calcRotatePoint(la,o,n),ha=new AMap.Pixel(tn.x,tn.y),en=this.mapIns.containerToLngLat(ha),ca=[[h.lng,h.lat],[E.lng,E.lat],[et.lng,et.lat],[en.lng,en.lat]];this.likeRectangleIns.setPath(ca)});a(this,"calcRotatePoint",(n,o,i)=>{const r=n.x,s=n.y,l=o.x,h=o.y,c=i*Math.PI/180,u=r-l,p=s-h,b=u*Math.cos(c)-p*Math.sin(c)+l,E=u*Math.sin(c)+p*Math.cos(c)+h;return{x:b,y:E}});a(this,"getDOMTransformRotate",n=>{var r;if(!n)return 0;let o=null;return(((r=n==null?void 0:n.style)==null?void 0:r.transform)||"").replace(/rotate\((.*)deg\)/g,(s,l)=>o=l),+o||0});a(this,"updateRotationAbleOffset",()=>{var s;const n=document.querySelector(`#${this.customRotationDOMId}`);let o=null,i=((s=n==null?void 0:n.style)==null?void 0:s.transform)||"";if(i.replace(/translateY\((.*)px\)/g,(l,h)=>o=h),!o)return;const r=`-${this.calcInitOffset()}`;i=i.replace(new RegExp(o,"g"),r),n.style.transform=i,this.offset=this.calcInitOffset()});a(this,"onDragStart",()=>j(this,null,function*(){this.reset()}));a(this,"onDragEnd",()=>j(this,null,function*(){this.open()}));if(!n)throw new Error("likeRectangleIns is required");this.likeRectangleIns=n,this.opts=o,this.open()}get mapIns(){return this.likeRectangleIns.likeRectangle.map}get center(){return this.likeRectangleIns.likeRectangle.center}get rotatable(){var n,o,i;return(i=(o=(n=this.likeRectangleIns)==null?void 0:n.likeRectangle)==null?void 0:o.opts)==null?void 0:i.rotatable}get draggable(){var o;return((o=this.likeRectangleIns)==null?void 0:o.getOptions()).draggable}get radius(){const{controllerPointRadius:n=$t}=this.opts;return Math.max(+`${n}`.replace("px","")||$t,$t)}open(){this.rotatable&&(this.calcMidPoint(),this.calcInitAngle(),this.setRotationLine(),this.registryLikeRectangleEvents(),this.createRotationPoint())}reset(){var n,o,i,r;(o=(n=this.elementRotatorIns)==null?void 0:n.destroy)==null||o.call(n),this.elementRotatorIns=null,(r=(i=this.rotationPointIns)==null?void 0:i.destroy)==null||r.call(i),this.rotationPointIns=null}close(){this.reset(),this.destroyLikeRectangleEvents(),this.destroyEvent()}registryLikeRectangleEvents(){const n=this.likeRectangleIns.hasEvents("dragstart",this.onDragStart);this.draggable&&!n&&(this.likeRectangleIns.on("dragstart",this.onDragStart),this.likeRectangleIns.on("dragend",this.onDragEnd))}destroyLikeRectangleEvents(){this.likeRectangleIns.off("dragstart",this.onDragStart),this.likeRectangleIns.off("dragend",this.onDragEnd)}createRotationPoint(){return j(this,null,function*(){var n,o;(o=(n=this.rotationPointIns)==null?void 0:n.destroy)==null||o.call(n),this.rotationPointIns=null,this.rotationPointIns=new AMap.Marker({map:this.mapIns,position:this.center,content:this.genMarkerContent()}),yield Promise.resolve(),this.setMarkerRotatable()})}registryEvent(){var n,o;this.elementRotatorIns&&(this.elementRotatorIns.on("rotateStart",this.onRotateStart),this.elementRotatorIns.on("rotate",this.onRotate),this.elementRotatorIns.on("rotateEnd",this.onRotateEnd),(o=(n=this.mapIns)==null?void 0:n.on)==null||o.call(n,"zoomchange",this.updateRotationAbleOffset))}destroyEvent(){var n,o;this.elementRotatorIns&&(this.elementRotatorIns.off("rotateStart",this.onRotateStart),this.elementRotatorIns.off("rotate",this.onRotate),this.elementRotatorIns.off("rotateEnd",this.onRotateEnd),(o=(n=this.mapIns)==null?void 0:n.off)==null||o.call(n,"zoomchange",this.updateRotationAbleOffset))}calcMidPoint(){var T,L,et;const n=(et=(L=(T=this.likeRectangleIns)==null?void 0:T.getPath)==null?void 0:L.call(T))==null?void 0:et.map(ht=>[ht.lng,ht.lat]);if(!n.length||!this.mapIns)throw new Error("likeRectangle or map is undefined");const o=n[0],i=this.mapIns.lngLatToContainer(o),r=n[1],s=this.mapIns.lngLatToContainer(r);let l=(i.y-s.y)/(i.x-s.x);l=Math.abs(l)<_t?0:l;const h=i.y-l*i.x,c=this.mapIns.lngLatToContainer(this.center),u=-1/l,p=c.y-u*c.x,b=!w(l)||x(l)||!w(u)||x(u)||!w(h)||x(h)||!w(p)||x(p);let E;l===0?E=(i.x+s.x)/2:b?E=i.x:E=(p-h)/(l-u);let v;l===0?v=i.y:b?v=(i.y+s.y)/2:v=l*E+h;const M=new AMap.Pixel(E,v);return this.midPoint=this.mapIns.containerToLngLat(M),this.midPoint}calcInitAngle(){if(!this.mapIns)return;const n=this.mapIns.lngLatToContainer(this.midPoint),o=this.mapIns.lngLatToContainer(this.center),i=Math.atan2(n.y-o.y,n.x-o.x);return this.initAngle=180/Math.PI*i+90,this.initAngle}calcInitOffset(){if(!this.mapIns)return 0;const n=this.mapIns.lngLatToContainer(this.midPoint),o=this.mapIns.lngLatToContainer(this.center);return oa(n,o)}setRotationLine(){}}class Je extends It{constructor(n){super();a(this,"opts");a(this,"map");a(this,"width");a(this,"height");a(this,"center");a(this,"leftTop");a(this,"rightTop");a(this,"leftBottom");a(this,"rightBottom");a(this,"likeRectangle");a(this,"rotatableIns");a(this,"likeRectangleDestroy");a(this,"likeRectangleRawSetOptions");this.validatorOpts(n),this.bindOptsToSelf(n),n.path||this.setPoints();const o=this.create();return this.registerRotatable(),this.enhanceMethods(),o}validatorOpts(n){if(!("map"in n)||!n.map)throw new Error("not found map instance")}bindOptsToSelf(n){this.opts=n,Object.entries(n).forEach(([o,i])=>{this[o]=i})}enhanceMethods(){this.likeRectangleDestroy=this.likeRectangle.destroy.bind(this.likeRectangle),this.likeRectangle.destroy=this.destroy.bind(this),this.likeRectangleRawSetOptions=this.likeRectangle.setOptions.bind(this.likeRectangle),this.likeRectangle.setOptions=this.likeRectangleSetOptions.bind(this)}likeRectangleSetOptions(n){var i,r;const{rotatable:o}=C(C({},this.opts),n||{});this.likeRectangleRawSetOptions(n),o?(this.opts.rotatable=!0,this.registerRotatable()):(this.opts.rotatable=!1,(r=(i=this.rotatableIns)==null?void 0:i.close)==null||r.call(i),this.rotatableIns=null)}destroy(){var n,o;(o=(n=this.rotatableIns)==null?void 0:n.close)==null||o.call(n),this.likeRectangleDestroy()}registerRotatable(){const{rotatable:n,rotationOptions:o}=this.opts;if(!n||this.rotatableIns)return;this.rotatableIns=new ia(this.likeRectangle,o);const i=this.likeRectangle;this.rotatableIns.on("rotateStart",r=>i.emit("rotateStart",r)),this.rotatableIns.on("rotate",r=>i.emit("rotate",r)),this.rotatableIns.on("rotateEnd",r=>i.emit("rotateEnd",r))}calcPoints(n){const[o,i]=n||this.center,r=new AMap.LngLat(o,i),s=nt(this.width/2),l=nt(this.height/2),h=r.offset(-s,l),c=r.offset(s,l),u=r.offset(-s,-l),p=r.offset(s,-l);return{leftTop:[h.lng,h.lat],rightTop:[c.lng,c.lat],leftBottom:[u.lng,u.lat],rightBottom:[p.lng,p.lat]}}setCenter(n){this.center=n}setPoints(){const{leftTop:n,rightTop:o,leftBottom:i,rightBottom:r}=this.calcPoints();this.leftTop=n,this.rightTop=o,this.leftBottom=i,this.rightBottom=r}create(){var o,i,r;const n=((o=this.opts)==null?void 0:o.path)||[this.leftTop,this.rightTop,this.rightBottom,this.leftBottom];if(n.length!==4)throw new Error("invalid path");if(this.likeRectangle=new AMap.Polygon,this.likeRectangle.setOptions(C({path:n},this.opts)),this.enhanceProperty(),this.registryEvent(),(i=this.opts)!=null&&i.path){const[s,l,h,c]=(r=this.opts)==null?void 0:r.path;this.updatePoints(s,l,h,c)}return this.likeRectangle}enhanceProperty(){this.likeRectangle.likeRectangle=this,this.likeRectangle.leftTop=this.leftTop,this.likeRectangle.rightTop=this.rightTop,this.likeRectangle.rightBottom=this.rightBottom,this.likeRectangle.leftBottom=this.leftBottom,this.likeRectangle.rotatable=this.opts.rotatable}registryEvent(){this.likeRectangle&&(this.onDragEnd=this.onDragEnd.bind(this),this.likeRectangle.on("dragend",this.onDragEnd))}onDragEnd(n){const i=n.target.getPath(),[r,s,l,h]=i;this.updatePoints(r,s,l,h)}updatePoints(n,o,i,r){this.likeRectangle.leftTop=this.leftTop=n,this.likeRectangle.rightTop=this.rightTop=o,this.likeRectangle.rightBottom=this.rightBottom=i,this.likeRectangle.leftBottom=this.leftBottom=r,this.setCenter(this.getCenter())}getCenter(){var o;return(o=this.map.getFitZoomAndCenterByOverlays([this.likeRectangle]))==null?void 0:o.pop()}}class ra{constructor(e,n,o){a(this,"point");a(this,"points");a(this,"center");a(this,"editor");a(this,"isEnabled",!1);this.editor=e,this.point=n,this.points=o,this.init(),this.clearClientEvent()}get len(){return this.points.length-1}get extData(){return this.point.getExtData()}get idx(){return this.extData.idx}get map(){return this.editor.map}enable(){this.isEnabled||(this.isEnabled=!0,this.setCursorPointer("move"),this.registryEvent())}disable(){this.isEnabled=!1,this.setCursorPointer("pointer"),this.destroyEvent()}setCursorPointer(e){var n;(n=this.point)==null||n.setOptions({cursor:e})}init(){this.center=this.point.getCenter(),this.onMouseOver=this.onMouseOver.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onDragStart=this.onDragStart.bind(this),this.onDragging=this.onDragging.bind(this),this.onDragEnd=this.onDragEnd.bind(this),this.defaultRegistryEvent()}clearClientEvent(){this.point.clearEvents("click")}defaultRegistryEvent(){const e=this.editor.isMobile;let n=e?"touchstart":"mouseover",o=e?"touchend":"mouseout";this.point.on(n,this.onMouseOver),this.point.on(o,this.onMouseOut)}registryEvent(){this.point.on("dragstart",this.onDragStart),this.point.on("dragging",this.onDragging),this.point.on("dragend",this.onDragEnd)}destroyEvent(){this.point.off("dragstart",this.onDragStart),this.point.off("dragging",this.onDragging),this.point.off("dragend",this.onDragEnd)}onMouseOver(){this.enable()}onMouseOut(){if(this.editor.isMobile){const e=setTimeout(()=>{clearTimeout(e),this.disable()},4)}else this.disable()}onDragStart(e){this.editor.onDragStart(e)}onDragging(e){const{pixel:n}=e;this.updateNextLeftPoint(n,e),this.updateNextRightPoint(n,e),this.editor.onDragging(e)}onDragEnd(e){const{target:n,pixel:o}=e;this.updateNextLeftPoint(o,e),this.updateNextRightPoint(o,e),this.center=n.getCenter(),this.editor.onDragEnd(e)}updateNextLeftPoint(e,n){const o=this.idx-1>=0?this.idx-1:this.len,i=this.points[o],r=this.map.lngLatToContainer(i.getCenter()),s=o-1>=0?o-1:this.len,l=this.points[s],h=this.map.lngLatToContainer(l.getCenter());let c=(h.y-r.y)/(h.x-r.x);c=Math.abs(c)<_t?0:c;const u=h.y-c*h.x,p=-1/c,b=e.y-p*e.x,E=Number.isNaN(c)||!w(c)||x(c)||Number.isNaN(p)||!w(p)||x(p)||Number.isNaN(u)||!w(u)||x(u)||Number.isNaN(b)||!w(b)||x(b);let v;c===0?v=e.x:E?v=r.x:v=(b-u)/(c-p);let M;c===0?M=r.y:E?M=e.y:M=c*v+u;const T=new AMap.Pixel(v,M);this.dispatch(i,T,n.originEvent)}updateNextRightPoint(e,n){const o=this.idx+1<=this.len?this.idx+1:0,i=this.points[o],r=this.map.lngLatToContainer(i.getCenter()),s=o+1<=this.len?o+1:0,l=this.points[s],h=this.map.lngLatToContainer(l.getCenter());let c=(h.y-r.y)/(h.x-r.x);c=Math.abs(c)<_t?0:c;const u=h.y-c*h.x,p=-1/c,b=e.y-p*e.x,E=Number.isNaN(c)||!w(c)||x(c)||Number.isNaN(p)||!w(p)||x(p)||Number.isNaN(u)||!w(u)||x(u)||Number.isNaN(b)||!w(b)||x(b);let v;c===0?v=e.x:E?v=r.x:v=(b-u)/(c-p);let M;c===0?M=r.y:E?M=e.y:M=c*v+u;const T=new AMap.Pixel(v,M);this.dispatch(i,T,n.originEvent)}dispatch(e,n,o){const r={lnglat:this.map.containerToLngLat(n),originEvent:o};e.emit("dragend",r)}}const sa={rotatingCloseEditor:!0,editingCloseRotator:!0,isMobile:!1};class Qe{constructor(e,n,o){a(this,"opts");a(this,"map");a(this,"likeRectangle");a(this,"polygonEditor");a(this,"polygonEditorOpen");a(this,"polygonEditorClose");a(this,"controlPoints");a(this,"inEditing",!1);a(this,"isRestart",!1);a(this,"onDragStart",e=>{var n,o;(o=(n=this.rotatableIns)==null?void 0:n.close)==null||o.call(n),this.onChange("dragstart",e)});a(this,"onDragging",e=>{this.updateLikeRectanglePath(),this.onChange("dragging",e)});a(this,"onDragEnd",e=>{var n,o;(o=(n=this.rotatableIns)==null?void 0:n.open)==null||o.call(n),this.onChange("dragend",e)});a(this,"onChange",(e,n)=>{var o,i;(i=(o=this.opts)==null?void 0:o.onChange)==null||i.call(o,e,n)});a(this,"onRotateStart",()=>j(this,null,function*(){this.inEditing&&this.polygonEditorClose()}));a(this,"onRotateEnd",()=>j(this,null,function*(){this.inEditing&&this.open()}));return this.map=e,this.likeRectangle=n,this.opts=C(C({},sa),o||{}),this.onChange=this.onChange.bind(this),this.createEditor()}get options(){return St(C({},this.opts),{midControlPoint:{radius:0}})}get rotatable(){var e,n,o;return(o=(n=(e=this.likeRectangle)==null?void 0:e.likeRectangle)==null?void 0:n.opts)==null?void 0:o.rotatable}get rotatingCloseEditor(){return this.opts.rotatingCloseEditor}get rotatableIns(){var e,n;return(n=(e=this.likeRectangle)==null?void 0:e.likeRectangle)==null?void 0:n.rotatableIns}get isMobile(){return this.opts.isMobile}open(){this.inEditing=!0,this.polygonEditorOpen(),this.registryLikeRectangleRotateEvents(),this.registryControlPoints()}close(){this.inEditing=!1,this.destroyLikeRectangleRotateEvents(),this.polygonEditorClose()}findControlPoint(e){return this.controlPoints.find(n=>{const o=n.point.getCenter(),i=`${o.lng}_${o.lat}`,r=e.getCenter(),s=`${r.lng}_${r.lat}`;return i===s})}createEditor(){const e=this.likeRectangle;return this.polygonEditor=new AMap.PolygonEditor(this.map,e,this.options),this.enhanceProperty(),this.polygonEditor}enhanceProperty(){this.polygonEditor.likeRectangleEditor=this,this.polygonEditorOpen=this.polygonEditor.open.bind(this.polygonEditor),this.polygonEditor.open=this.open.bind(this),this.polygonEditorClose=this.polygonEditor.close.bind(this.polygonEditor),this.polygonEditor.close=this.close.bind(this)}registryLikeRectangleRotateEvents(){this.rotatable&&this.rotatingCloseEditor&&(this.likeRectangle.on("rotateStart",this.onRotateStart),this.likeRectangle.on("rotateEnd",this.onRotateEnd))}destroyLikeRectangleRotateEvents(){this.rotatable&&this.rotatingCloseEditor&&(this.likeRectangle.off("rotateStart",this.onRotateStart),this.likeRectangle.off("rotateEnd",this.onRotateEnd))}registryControlPoints(){var n,o,i,r;const e=(r=(i=(o=(n=this.polygonEditor)==null?void 0:n.singleRingListHandle)==null?void 0:o.list)==null?void 0:i.editingVertexMarkerList)!=null?r:[];this.controlPoints=e.map((s,l)=>{const h=s.getExtData()||{};return s.setExtData(St(C({},h),{idx:l})),new ra(this,s,e)})}updateLikeRectanglePath(){const[e,n,o,i]=this.controlPoints,r=e.point.getCenter(),s=n.point.getCenter(),l=o.point.getCenter(),h=i.point.getCenter();this.likeRectangle.likeRectangle.updatePoints([r.lng,r.lat],[s.lng,s.lat],[l.lng,l.lat],[h.lng,h.lat])}}const aa={PolygonRangingInDrawing:Y,PolygonEditorRanging:Be,PolygonEditorEvent:Fe,PolygonRanging:Ne,LikeRectangle:Je,LikeRectangleEditor:Qe};g.LikeRectangle=Je,g.LikeRectangleEditor=Qe,g.PolygonEditorEvent=Fe,g.PolygonEditorRanging=Be,g.PolygonRanging=Ne,g.PolygonRangingInDrawing=Y,g.default=aa,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});

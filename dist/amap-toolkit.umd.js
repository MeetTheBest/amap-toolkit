(function(g,m){typeof exports=="object"&&typeof module!="undefined"?m(exports):typeof define=="function"&&define.amd?define(["exports"],m):(g=typeof globalThis!="undefined"?globalThis:g||self,m(g["amap-toolkit"]={}))})(this,function(g){"use strict";var _a=Object.defineProperty,ka=Object.defineProperties;var $a=Object.getOwnPropertyDescriptors;var rn=Object.getOwnPropertySymbols;var Oa=Object.prototype.hasOwnProperty,Sa=Object.prototype.propertyIsEnumerable;var St=(g,m,P)=>m in g?_a(g,m,{enumerable:!0,configurable:!0,writable:!0,value:P}):g[m]=P,L=(g,m)=>{for(var P in m||(m={}))Oa.call(m,P)&&St(g,P,m[P]);if(rn)for(var P of rn(m))Sa.call(m,P)&&St(g,P,m[P]);return g},At=(g,m)=>ka(g,$a(m));var a=(g,m,P)=>(St(g,typeof m!="symbol"?m+"":m,P),P);var j=(g,m,P)=>new Promise((ot,x)=>{var S=k=>{try{G(P.next(k))}catch(H){x(H)}},A=k=>{try{G(P.throw(k))}catch(H){x(H)}},G=k=>k.done?ot(k.value):Promise.resolve(k.value).then(S,A);G((P=P.apply(g,m)).next())});const m={"border-color":"#e1f5fe","font-size":"12px","border-radius":".25rem","background-color":"rgba(0,0,0,.4)","border-width":0,"text-align":"center",color:"#fff"},P=()=>Math.random().toString(16).substring(2),ot=(t,e=2)=>Number.isNaN(+t)?t:+t.toFixed(Math.max(e,0)),x=t=>Math.abs(t)>Number.MAX_SAFE_INTEGER,S=(t="",e={})=>new AMap.Text({text:t,style:L(L({},m),e),offset:[0,-10]}),A=(t,e)=>{const n=t.divideBy(2).add(e.divideBy(2));return{text:`${Math.round(t.distance(e))}ç±³`,textPos:n}};let G=class{constructor(e){a(this,"map");a(this,"startPointToCursorText",null);a(this,"lastPointToCursorText",null);a(this,"startPosition",null);a(this,"lastPosition",null);a(this,"getClickPosition",e=>{const n=e.lnglat;this.startPosition?this.startPosition&&(this.lastPosition=n,this.createDistanceText()):this.startPosition=n});a(this,"onMouseMoveInDrawPolygon",e=>{if(!this.startPosition||!this.lastPosition)return;const n=e.lnglat;this.updateDistanceText(this.startPointToCursorText,A(this.startPosition,n)),this.updateDistanceText(this.lastPointToCursorText,A(this.lastPosition,n))});if(!e)throw new Error("map not found!");this.map=e}open(){this.start()}start(){this.map.on("click",this.getClickPosition),this.map.on("mousemove",this.onMouseMoveInDrawPolygon)}close(){this.stop()}stop(){this.map.off("click",this.getClickPosition),this.map.off("mousemove",this.onMouseMoveInDrawPolygon)}createDistanceText(){this.startPointToCursorText&&this.lastPointToCursorText||(this.startPointToCursorText=S(),this.startPointToCursorText.setMap(this.map),this.lastPointToCursorText=S(),this.lastPointToCursorText.setMap(this.map))}updateDistanceText(e,{text:n,textPos:o}){e.setText(n),e.setPosition(o)}removeDistanceText(){var e,n;(e=this.startPointToCursorText)==null||e.remove(),this.startPointToCursorText=null,(n=this.lastPointToCursorText)==null||n.remove(),this.lastPointToCursorText=null}reset(){return this.startPosition=null,this.lastPosition=null,this.removeDistanceText(),this}destroy(){return this.reset(),this.stop(),this}};var k=typeof global=="object"&&global&&global.Object===Object&&global;const H=k;var sn=typeof self=="object"&&self&&self.Object===Object&&self,an=H||sn||Function("return this")();const R=an;var ln=R.Symbol;const _=ln;var jt=Object.prototype,hn=jt.hasOwnProperty,cn=jt.toString,q=_?_.toStringTag:void 0;function un(t){var e=hn.call(t,q),n=t[q];try{t[q]=void 0;var o=!0}catch(r){}var i=cn.call(t);return o&&(e?t[q]=n:delete t[q]),i}var gn=Object.prototype,pn=gn.toString;function fn(t){return pn.call(t)}var dn="[object Null]",yn="[object Undefined]",Dt=_?_.toStringTag:void 0;function D(t){return t==null?t===void 0?yn:dn:Dt&&Dt in Object(t)?un(t):fn(t)}function N(t){return t!=null&&typeof t=="object"}var mn="[object Symbol]";function gt(t){return typeof t=="symbol"||N(t)&&D(t)==mn}function Nt(t,e){for(var n=-1,o=t==null?0:t.length,i=Array(o);++n<o;)i[n]=e(t[n],n,t);return i}var Pn=Array.isArray;const B=Pn;var vn=1/0,Bt=_?_.prototype:void 0,Ft=Bt?Bt.toString:void 0;function Ut(t){if(typeof t=="string")return t;if(B(t))return Nt(t,Ut)+"";if(gt(t))return Ft?Ft.call(t):"";var e=t+"";return e=="0"&&1/t==-vn?"-0":e}function Z(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function Tn(t){return t}var bn="[object AsyncFunction]",Mn="[object Function]",En="[object GeneratorFunction]",xn="[object Proxy]";function Kt(t){if(!Z(t))return!1;var e=D(t);return e==Mn||e==En||e==bn||e==xn}var Ln=R["__core-js_shared__"];const pt=Ln;var zt=function(){var t=/[^.]+$/.exec(pt&&pt.keys&&pt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Cn(t){return!!zt&&zt in t}var wn=Function.prototype,Rn=wn.toString;function F(t){if(t!=null){try{return Rn.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var In=/[\\^$.*+?()[\]{}|]/g,_n=/^\[object .+?Constructor\]$/,kn=Function.prototype,$n=Object.prototype,On=kn.toString,Sn=$n.hasOwnProperty,An=RegExp("^"+On.call(Sn).replace(In,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function jn(t){if(!Z(t)||Cn(t))return!1;var e=Kt(t)?An:_n;return e.test(F(t))}function Dn(t,e){return t==null?void 0:t[e]}function U(t,e){var n=Dn(t,e);return jn(n)?n:void 0}var Nn=U(R,"WeakMap");const ft=Nn;var Gt=Object.create,Bn=function(){function t(){}return function(e){if(!Z(e))return{};if(Gt)return Gt(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();const Fn=Bn;function Un(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Kn(){}function zn(t,e){var n=-1,o=t.length;for(e||(e=Array(o));++n<o;)e[n]=t[n];return e}var Gn=800,Hn=16,Yn=Date.now;function Xn(t){var e=0,n=0;return function(){var o=Yn(),i=Hn-(o-n);if(n=o,i>0){if(++e>=Gn)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function Vn(t){return function(){return t}}var Wn=function(){try{var t=U(Object,"defineProperty");return t({},"",{}),t}catch(e){}}();const it=Wn;var qn=it?function(t,e){return it(t,"toString",{configurable:!0,enumerable:!1,value:Vn(e),writable:!0})}:Tn,Zn=Xn(qn);const Jn=Zn;function Qn(t,e){for(var n=-1,o=t==null?0:t.length;++n<o&&e(t[n],n,t)!==!1;);return t}function to(t,e,n,o){for(var i=t.length,r=n+(o?1:-1);o?r--:++r<i;)if(e(t[r],r,t))return r;return-1}function eo(t){return t!==t}function no(t,e,n){for(var o=n-1,i=t.length;++o<i;)if(t[o]===e)return o;return-1}function oo(t,e,n){return e===e?no(t,e,n):to(t,eo,n)}function io(t,e){var n=t==null?0:t.length;return!!n&&oo(t,e,0)>-1}var ro=9007199254740991,so=/^(?:0|[1-9]\d*)$/;function ao(t,e){var n=typeof t;return e=e==null?ro:e,!!e&&(n=="number"||n!="symbol"&&so.test(t))&&t>-1&&t%1==0&&t<e}function Ht(t,e,n){e=="__proto__"&&it?it(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Yt(t,e){return t===e||t!==t&&e!==e}var lo=Object.prototype,ho=lo.hasOwnProperty;function Xt(t,e,n){var o=t[e];(!(ho.call(t,e)&&Yt(o,n))||n===void 0&&!(e in t))&&Ht(t,e,n)}function J(t,e,n,o){var i=!n;n||(n={});for(var r=-1,s=e.length;++r<s;){var l=e[r],h=o?o(n[l],t[l],l,n,t):void 0;h===void 0&&(h=t[l]),i?Ht(n,l,h):Xt(n,l,h)}return n}var Vt=Math.max;function co(t,e,n){return e=Vt(e===void 0?t.length-1:e,0),function(){for(var o=arguments,i=-1,r=Vt(o.length-e,0),s=Array(r);++i<r;)s[i]=o[e+i];i=-1;for(var l=Array(e+1);++i<e;)l[i]=o[i];return l[e]=n(s),Un(t,this,l)}}var uo=9007199254740991;function Wt(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=uo}function qt(t){return t!=null&&Wt(t.length)&&!Kt(t)}var go=Object.prototype;function dt(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||go;return t===n}function po(t,e){for(var n=-1,o=Array(t);++n<t;)o[n]=e(n);return o}var fo="[object Arguments]";function Zt(t){return N(t)&&D(t)==fo}var Jt=Object.prototype,yo=Jt.hasOwnProperty,mo=Jt.propertyIsEnumerable,Po=Zt(function(){return arguments}())?Zt:function(t){return N(t)&&yo.call(t,"callee")&&!mo.call(t,"callee")};const Qt=Po;function vo(){return!1}var te=typeof g=="object"&&g&&!g.nodeType&&g,ee=te&&typeof module=="object"&&module&&!module.nodeType&&module,To=ee&&ee.exports===te,ne=To?R.Buffer:void 0,bo=ne?ne.isBuffer:void 0,Mo=bo||vo;const oe=Mo;var Eo="[object Arguments]",xo="[object Array]",Lo="[object Boolean]",Co="[object Date]",wo="[object Error]",Ro="[object Function]",Io="[object Map]",_o="[object Number]",ko="[object Object]",$o="[object RegExp]",Oo="[object Set]",So="[object String]",Ao="[object WeakMap]",jo="[object ArrayBuffer]",Do="[object DataView]",No="[object Float32Array]",Bo="[object Float64Array]",Fo="[object Int8Array]",Uo="[object Int16Array]",Ko="[object Int32Array]",zo="[object Uint8Array]",Go="[object Uint8ClampedArray]",Ho="[object Uint16Array]",Yo="[object Uint32Array]",y={};y[No]=y[Bo]=y[Fo]=y[Uo]=y[Ko]=y[zo]=y[Go]=y[Ho]=y[Yo]=!0,y[Eo]=y[xo]=y[jo]=y[Lo]=y[Do]=y[Co]=y[wo]=y[Ro]=y[Io]=y[_o]=y[ko]=y[$o]=y[Oo]=y[So]=y[Ao]=!1;function Xo(t){return N(t)&&Wt(t.length)&&!!y[D(t)]}function yt(t){return function(e){return t(e)}}var ie=typeof g=="object"&&g&&!g.nodeType&&g,Q=ie&&typeof module=="object"&&module&&!module.nodeType&&module,Vo=Q&&Q.exports===ie,mt=Vo&&H.process,Wo=function(){try{var t=Q&&Q.require&&Q.require("util").types;return t||mt&&mt.binding&&mt.binding("util")}catch(e){}}();const Y=Wo;var re=Y&&Y.isTypedArray,qo=re?yt(re):Xo;const Zo=qo;var Jo=Object.prototype,Qo=Jo.hasOwnProperty;function se(t,e){var n=B(t),o=!n&&Qt(t),i=!n&&!o&&oe(t),r=!n&&!o&&!i&&Zo(t),s=n||o||i||r,l=s?po(t.length,String):[],h=l.length;for(var c in t)(e||Qo.call(t,c))&&!(s&&(c=="length"||i&&(c=="offset"||c=="parent")||r&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||ao(c,h)))&&l.push(c);return l}function ae(t,e){return function(n){return t(e(n))}}var ti=ae(Object.keys,Object);const ei=ti;var ni=Object.prototype,oi=ni.hasOwnProperty;function ii(t){if(!dt(t))return ei(t);var e=[];for(var n in Object(t))oi.call(t,n)&&n!="constructor"&&e.push(n);return e}function Pt(t){return qt(t)?se(t):ii(t)}function ri(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var si=Object.prototype,ai=si.hasOwnProperty;function li(t){if(!Z(t))return ri(t);var e=dt(t),n=[];for(var o in t)o=="constructor"&&(e||!ai.call(t,o))||n.push(o);return n}function vt(t){return qt(t)?se(t,!0):li(t)}var hi=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ci=/^\w*$/;function ui(t,e){if(B(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||gt(t)?!0:ci.test(t)||!hi.test(t)||e!=null&&t in Object(e)}var gi=U(Object,"create");const tt=gi;function pi(){this.__data__=tt?tt(null):{},this.size=0}function fi(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var di="__lodash_hash_undefined__",yi=Object.prototype,mi=yi.hasOwnProperty;function Pi(t){var e=this.__data__;if(tt){var n=e[t];return n===di?void 0:n}return mi.call(e,t)?e[t]:void 0}var vi=Object.prototype,Ti=vi.hasOwnProperty;function bi(t){var e=this.__data__;return tt?e[t]!==void 0:Ti.call(e,t)}var Mi="__lodash_hash_undefined__";function Ei(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=tt&&e===void 0?Mi:e,this}function K(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}K.prototype.clear=pi,K.prototype.delete=fi,K.prototype.get=Pi,K.prototype.has=bi,K.prototype.set=Ei;function xi(){this.__data__=[],this.size=0}function rt(t,e){for(var n=t.length;n--;)if(Yt(t[n][0],e))return n;return-1}var Li=Array.prototype,Ci=Li.splice;function wi(t){var e=this.__data__,n=rt(e,t);if(n<0)return!1;var o=e.length-1;return n==o?e.pop():Ci.call(e,n,1),--this.size,!0}function Ri(t){var e=this.__data__,n=rt(e,t);return n<0?void 0:e[n][1]}function Ii(t){return rt(this.__data__,t)>-1}function _i(t,e){var n=this.__data__,o=rt(n,t);return o<0?(++this.size,n.push([t,e])):n[o][1]=e,this}function $(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}$.prototype.clear=xi,$.prototype.delete=wi,$.prototype.get=Ri,$.prototype.has=Ii,$.prototype.set=_i;var ki=U(R,"Map");const et=ki;function $i(){this.size=0,this.__data__={hash:new K,map:new(et||$),string:new K}}function Oi(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function st(t,e){var n=t.__data__;return Oi(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Si(t){var e=st(this,t).delete(t);return this.size-=e?1:0,e}function Ai(t){return st(this,t).get(t)}function ji(t){return st(this,t).has(t)}function Di(t,e){var n=st(this,t),o=n.size;return n.set(t,e),this.size+=n.size==o?0:1,this}function O(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}O.prototype.clear=$i,O.prototype.delete=Si,O.prototype.get=Ai,O.prototype.has=ji,O.prototype.set=Di;var Ni="Expected a function";function Tt(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(Ni);var n=function(){var o=arguments,i=e?e.apply(this,o):o[0],r=n.cache;if(r.has(i))return r.get(i);var s=t.apply(this,o);return n.cache=r.set(i,s)||r,s};return n.cache=new(Tt.Cache||O),n}Tt.Cache=O;var Bi=500;function Fi(t){var e=Tt(t,function(o){return n.size===Bi&&n.clear(),o}),n=e.cache;return e}var Ui=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ki=/\\(\\)?/g,zi=Fi(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Ui,function(n,o,i,r){e.push(i?r.replace(Ki,"$1"):o||n)}),e});const Gi=zi;function Hi(t){return t==null?"":Ut(t)}function bt(t,e){return B(t)?t:ui(t,e)?[t]:Gi(Hi(t))}var Yi=1/0;function le(t){if(typeof t=="string"||gt(t))return t;var e=t+"";return e=="0"&&1/t==-Yi?"-0":e}function he(t,e){e=bt(e,t);for(var n=0,o=e.length;t!=null&&n<o;)t=t[le(e[n++])];return n&&n==o?t:void 0}function ce(t,e,n){var o=t==null?void 0:he(t,e);return o===void 0?n:o}function Mt(t,e){for(var n=-1,o=e.length,i=t.length;++n<o;)t[i+n]=e[n];return t}var ue=_?_.isConcatSpreadable:void 0;function Xi(t){return B(t)||Qt(t)||!!(ue&&t&&t[ue])}function ge(t,e,n,o,i){var r=-1,s=t.length;for(n||(n=Xi),i||(i=[]);++r<s;){var l=t[r];e>0&&n(l)?e>1?ge(l,e-1,n,o,i):Mt(i,l):o||(i[i.length]=l)}return i}function Vi(t){var e=t==null?0:t.length;return e?ge(t,1):[]}function Wi(t){return Jn(co(t,void 0,Vi),t+"")}var qi=ae(Object.getPrototypeOf,Object);const Et=qi;var Zi="[object Object]",Ji=Function.prototype,Qi=Object.prototype,pe=Ji.toString,tr=Qi.hasOwnProperty,er=pe.call(Object);function nr(t){if(!N(t)||D(t)!=Zi)return!1;var e=Et(t);if(e===null)return!0;var n=tr.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&pe.call(n)==er}function or(t,e,n){var o=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var r=Array(i);++o<i;)r[o]=t[o+e];return r}function ir(){this.__data__=new $,this.size=0}function rr(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function sr(t){return this.__data__.get(t)}function ar(t){return this.__data__.has(t)}var lr=200;function hr(t,e){var n=this.__data__;if(n instanceof $){var o=n.__data__;if(!et||o.length<lr-1)return o.push([t,e]),this.size=++n.size,this;n=this.__data__=new O(o)}return n.set(t,e),this.size=n.size,this}function X(t){var e=this.__data__=new $(t);this.size=e.size}X.prototype.clear=ir,X.prototype.delete=rr,X.prototype.get=sr,X.prototype.has=ar,X.prototype.set=hr;function cr(t,e){return t&&J(e,Pt(e),t)}function ur(t,e){return t&&J(e,vt(e),t)}var fe=typeof g=="object"&&g&&!g.nodeType&&g,de=fe&&typeof module=="object"&&module&&!module.nodeType&&module,gr=de&&de.exports===fe,ye=gr?R.Buffer:void 0,me=ye?ye.allocUnsafe:void 0;function pr(t,e){if(e)return t.slice();var n=t.length,o=me?me(n):new t.constructor(n);return t.copy(o),o}function fr(t,e){for(var n=-1,o=t==null?0:t.length,i=0,r=[];++n<o;){var s=t[n];e(s,n,t)&&(r[i++]=s)}return r}function Pe(){return[]}var dr=Object.prototype,yr=dr.propertyIsEnumerable,ve=Object.getOwnPropertySymbols,mr=ve?function(t){return t==null?[]:(t=Object(t),fr(ve(t),function(e){return yr.call(t,e)}))}:Pe;const xt=mr;function Pr(t,e){return J(t,xt(t),e)}var vr=Object.getOwnPropertySymbols,Tr=vr?function(t){for(var e=[];t;)Mt(e,xt(t)),t=Et(t);return e}:Pe;const Te=Tr;function br(t,e){return J(t,Te(t),e)}function be(t,e,n){var o=e(t);return B(t)?o:Mt(o,n(t))}function Mr(t){return be(t,Pt,xt)}function Me(t){return be(t,vt,Te)}var Er=U(R,"DataView");const Lt=Er;var xr=U(R,"Promise");const Ct=xr;var Lr=U(R,"Set");const V=Lr;var Ee="[object Map]",Cr="[object Object]",xe="[object Promise]",Le="[object Set]",Ce="[object WeakMap]",we="[object DataView]",wr=F(Lt),Rr=F(et),Ir=F(Ct),_r=F(V),kr=F(ft),z=D;(Lt&&z(new Lt(new ArrayBuffer(1)))!=we||et&&z(new et)!=Ee||Ct&&z(Ct.resolve())!=xe||V&&z(new V)!=Le||ft&&z(new ft)!=Ce)&&(z=function(t){var e=D(t),n=e==Cr?t.constructor:void 0,o=n?F(n):"";if(o)switch(o){case wr:return we;case Rr:return Ee;case Ir:return xe;case _r:return Le;case kr:return Ce}return e});const wt=z;var $r=Object.prototype,Or=$r.hasOwnProperty;function Sr(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&Or.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var Ar=R.Uint8Array;const Re=Ar;function Rt(t){var e=new t.constructor(t.byteLength);return new Re(e).set(new Re(t)),e}function jr(t,e){var n=e?Rt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var Dr=/\w*$/;function Nr(t){var e=new t.constructor(t.source,Dr.exec(t));return e.lastIndex=t.lastIndex,e}var Ie=_?_.prototype:void 0,_e=Ie?Ie.valueOf:void 0;function Br(t){return _e?Object(_e.call(t)):{}}function Fr(t,e){var n=e?Rt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var Ur="[object Boolean]",Kr="[object Date]",zr="[object Map]",Gr="[object Number]",Hr="[object RegExp]",Yr="[object Set]",Xr="[object String]",Vr="[object Symbol]",Wr="[object ArrayBuffer]",qr="[object DataView]",Zr="[object Float32Array]",Jr="[object Float64Array]",Qr="[object Int8Array]",ts="[object Int16Array]",es="[object Int32Array]",ns="[object Uint8Array]",os="[object Uint8ClampedArray]",is="[object Uint16Array]",rs="[object Uint32Array]";function ss(t,e,n){var o=t.constructor;switch(e){case Wr:return Rt(t);case Ur:case Kr:return new o(+t);case qr:return jr(t,n);case Zr:case Jr:case Qr:case ts:case es:case ns:case os:case is:case rs:return Fr(t,n);case zr:return new o;case Gr:case Xr:return new o(t);case Hr:return Nr(t);case Yr:return new o;case Vr:return Br(t)}}function as(t){return typeof t.constructor=="function"&&!dt(t)?Fn(Et(t)):{}}var ls="[object Map]";function hs(t){return N(t)&&wt(t)==ls}var ke=Y&&Y.isMap,cs=ke?yt(ke):hs;const us=cs;var gs="[object Set]";function ps(t){return N(t)&&wt(t)==gs}var $e=Y&&Y.isSet,fs=$e?yt($e):ps;const ds=fs;var ys=1,ms=2,Ps=4,Oe="[object Arguments]",vs="[object Array]",Ts="[object Boolean]",bs="[object Date]",Ms="[object Error]",Se="[object Function]",Es="[object GeneratorFunction]",xs="[object Map]",Ls="[object Number]",Ae="[object Object]",Cs="[object RegExp]",ws="[object Set]",Rs="[object String]",Is="[object Symbol]",_s="[object WeakMap]",ks="[object ArrayBuffer]",$s="[object DataView]",Os="[object Float32Array]",Ss="[object Float64Array]",As="[object Int8Array]",js="[object Int16Array]",Ds="[object Int32Array]",Ns="[object Uint8Array]",Bs="[object Uint8ClampedArray]",Fs="[object Uint16Array]",Us="[object Uint32Array]",d={};d[Oe]=d[vs]=d[ks]=d[$s]=d[Ts]=d[bs]=d[Os]=d[Ss]=d[As]=d[js]=d[Ds]=d[xs]=d[Ls]=d[Ae]=d[Cs]=d[ws]=d[Rs]=d[Is]=d[Ns]=d[Bs]=d[Fs]=d[Us]=!0,d[Ms]=d[Se]=d[_s]=!1;function at(t,e,n,o,i,r){var s,l=e&ys,h=e&ms,c=e&Ps;if(n&&(s=i?n(t,o,i,r):n(t)),s!==void 0)return s;if(!Z(t))return t;var u=B(t);if(u){if(s=Sr(t),!l)return zn(t,s)}else{var p=wt(t),v=p==Se||p==Es;if(oe(t))return pr(t,l);if(p==Ae||p==Oe||v&&!i){if(s=h||v?{}:as(t),!l)return h?br(t,ur(s,t)):Pr(t,cr(s,t))}else{if(!d[p])return i?t:{};s=ss(t,p,l)}}r||(r=new X);var M=r.get(t);if(M)return M;r.set(t,s),ds(t)?t.forEach(function(b){s.add(at(b,e,n,b,t,r))}):us(t)&&t.forEach(function(b,w){s.set(w,at(b,e,n,w,t,r))});var T=c?h?Me:Mr:h?vt:Pt,E=u?void 0:T(t);return Qn(E||t,function(b,w){E&&(w=b,b=t[w]),Xt(s,w,at(b,e,n,w,t,r))}),s}var Ks="__lodash_hash_undefined__";function zs(t){return this.__data__.set(t,Ks),this}function Gs(t){return this.__data__.has(t)}function lt(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new O;++e<n;)this.add(t[e])}lt.prototype.add=lt.prototype.push=zs,lt.prototype.has=Gs;function Hs(t,e){return t.has(e)}function je(t){var e=-1,n=Array(t.size);return t.forEach(function(o){n[++e]=o}),n}function Ys(t,e,n){for(var o=-1,i=t==null?0:t.length;++o<i;)if(n(e,t[o]))return!0;return!1}function Xs(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function Vs(t,e){return e.length<2?t:he(t,or(e,0,-1))}var Ws=R.isFinite;function C(t){return typeof t=="number"&&Ws(t)}function qs(t,e){return e=bt(e,t),t=Vs(t,e),t==null||delete t[le(Xs(e))]}function Zs(t){return nr(t)?void 0:t}var Js=1,Qs=2,ta=4,ea=Wi(function(t,e){var n={};if(t==null)return n;var o=!1;e=Nt(e,function(r){return r=bt(r,t),o||(o=r.length>1),r}),J(t,Me(t),n),o&&(n=at(n,Js|Qs|ta,Zs));for(var i=e.length;i--;)qs(n,e[i]);return n});const na=ea;var oa=1/0,ia=V&&1/je(new V([,-0]))[1]==oa?function(t){return new V(t)}:Kn;const ra=ia;var sa=200;function aa(t,e,n){var o=-1,i=io,r=t.length,s=!0,l=[],h=l;if(n)s=!1,i=Ys;else if(r>=sa){var c=e?null:ra(t);if(c)return je(c);s=!1,i=Hs,h=new lt}else h=e?[]:l;t:for(;++o<r;){var u=t[o],p=e?e(u):u;if(u=n||u!==0?u:0,s&&p===p){for(var v=h.length;v--;)if(h[v]===p)continue t;e&&h.push(p),l.push(u)}else i(h,p,n)||(h!==l&&h.push(p),l.push(u))}return l}function la(t){return t&&t.length?aa(t):[]}const De={radius:6,zIndex:0,strokeOpacity:0,fillOpacity:0};class It{constructor(e){a(this,"map");a(this,"options",L({},De));a(this,"circleMarkers",[]);this.map=e}setOptions(e){return this.options=L(L({},e),na(De,"radius")),this}createCircleMarkersByPaths(e){this.removeFromTheMap(),this.reset(),e.forEach(n=>{this.circleMarkers.push(this.createCircleMarker(n))}),this.addToMap()}createCircleMarker(e){return new AMap.CircleMarker(L({center:e},this.options))}addToMap(){this.map.add(this.circleMarkers)}removeFromTheMap(){this.map.remove(this.circleMarkers)}getPointInCircleMarkers(e){var n;return(n=this.circleMarkers.find(o=>this.isPointInCircle(e,o)))!=null?n:null}getInCircleMarkersPoint(e){const n=this.circleMarkers.find(i=>this.isPointInCircle(e,i));return this.circleMarkers.findIndex(i=>i===n)%2===0?null:n!=null?n:null}isPointInCircle(e,n){return n.contains(e)}reset(){this.circleMarkers=[]}destroy(){this.removeFromTheMap(),this.reset()}}const Ne={zIndex:1,strokeColor:"#00D3FC",strokeWeight:8,strokeOpacity:0};class Be{constructor(e){a(this,"map");a(this,"linesPath",[]);a(this,"lines",[]);if(!e)throw new Error("map not found");this.map=e}getLinesByPaths(e){let n=0;const o=e.length;for(;n<o;){const i=n+1>=o?0:n+1;this.linesPath.push([e[n],e[i]]),n++}return this.linesPath}createLinesByPaths(e){this.reset(),this.getLinesByPaths(e)}createPolyLine(e){return new AMap.Polyline(L({path:e},Ne))}addToMap(){this.map.add(this.lines)}removeFromTheMap(){this.map.remove(this.lines)}getPointInPolyline(e){const n=this.map.getResolution(),o=Ne.strokeWeight*n;return this.linesPath.find(r=>AMap.GeometryUtil.isPointOnSegment(e,r[0],r[1],o))}reset(){this.linesPath=[],this.lines=[]}}class Fe{constructor(e,n){a(this,"map");a(this,"circleMarkers",null);a(this,"midCircleMarkers",null);a(this,"lines",null);a(this,"polygonEditor",null);a(this,"polygonPaths",[]);a(this,"polygonTotalPaths",[]);a(this,"polygon",null);a(this,"startPointToCursorText",null);a(this,"lastPointToCursorText",null);a(this,"lineLengthText",null);a(this,"circleMarker",null);a(this,"midCircleMarker",null);a(this,"startPosition",null);a(this,"lastPosition",null);a(this,"editingMidTipMarkerListPath",null);a(this,"onPolygonEditorAdjust",({target:e})=>{this.polygonPaths=e.getPath(),this.circleMarkers.createCircleMarkersByPaths(this.polygonPaths),this.lines.createLinesByPaths(this.polygonPaths),Promise.resolve().then(()=>{this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.midCircleMarkers.createCircleMarkersByPaths(this.polygonTotalPaths)}),this.reset()});a(this,"onMouseDown",e=>{const n=e.lnglat;this.circleMarker=this.circleMarkers.getPointInCircleMarkers(n),this.midCircleMarker=this.midCircleMarkers.getInCircleMarkersPoint(n)});a(this,"onMovePolygonEditorPoint",e=>{if(this.midCircleMarker)return;if(!this.circleMarker){this.reset();return}const n=this.circleMarker.getCenter(),o=u=>`${u.lng}-${u.lat}`;let i=this.polygonPaths.findIndex(u=>o(u)===o(n));if(i===-1)return;const r=this.polygonPaths.length,s=i-1<=-1?r-1:i-1,l=i+1>=r?0:i+1,h=this.polygonPaths.at(s),c=this.polygonPaths.at(l);this.setPosition(h,c),this.onMouseMoveInDrawPolygon(e)});a(this,"onMovePolygonEditorMidPoint",e=>{if(this.circleMarker)return;if(!this.midCircleMarker){this.reset();return}const n=this.midCircleMarker.getCenter(),o=u=>`${u.lng}-${u.lat}`;let i=this.polygonTotalPaths.findIndex(u=>o(u)===o(n));if(i===-1)return;const r=this.polygonTotalPaths.length,s=i-1<=-1?r-1:i-1,l=i+1>=r?0:i+1,h=this.polygonTotalPaths.at(s),c=this.polygonTotalPaths.at(l);this.setPosition(h,c),this.onMouseMoveInDrawPolygon(e)});a(this,"onMouseUp",()=>{this.circleMarker=null,this.midCircleMarker=null,this.reset()});a(this,"onInPolygonEditorLine",e=>{if(this.circleMarker)return this.removeLineDistanceText();const n=e.lnglat,o=this.lines.getPointInPolyline(n);if(!o)return this.removeLineDistanceText();const[i,r]=o;this.lineLengthText||(this.lineLengthText=S(),this.lineLengthText.add(this.map)),this.updateDistanceText(this.lineLengthText,A(i,r))});a(this,"onMouseMoveInDrawPolygon",e=>{if(!this.startPosition||!this.lastPosition)return;const n=e.lnglat;this.updateDistanceText(this.startPointToCursorText,A(this.startPosition,n)),this.updateDistanceText(this.lastPointToCursorText,A(this.lastPosition,n))});if(!e)throw new Error("map not found!");this.map=e,n&&(this.polygonEditor=n),this.circleMarkers=new It(this.map),this.midCircleMarkers=new It(this.map),this.lines=new Be(this.map)}getPolygonEditorTargetPaths(){var e,n,o;return this.polygonEditor?(o=(n=(e=this.polygonEditor)==null?void 0:e.getTarget)==null?void 0:n.call(e).getPath())!=null?o:[]:[]}setEditingMidTipMarkerListPath(e){return this.editingMidTipMarkerListPath=e,this}getEditingMidTipMarkerList(){var n,o;const{singleRingListHandle:e}=this.polygonEditor;if(this.editingMidTipMarkerListPath){if(typeof this.editingMidTipMarkerListPath=="function")return this.editingMidTipMarkerListPath(this.polygonEditor);if(typeof this.editingMidTipMarkerListPath=="string")return ce(this.polygonEditor,this.editingMidTipMarkerListPath)}return(n=this.polygonEditor.editingMidTipMarkerList)!=null&&n.length?this.polygonEditor.editingMidTipMarkerList:e?(o=e==null?void 0:e.list)==null?void 0:o.editingMidTipMarkerList:[]}getPolygonEditorTargetTotalPaths(){const e=this.getPolygonEditorTargetPaths(),n=this.getEditingMidTipMarkerList();let o=0;const i=[],r=e.length;for(;o<r;){i.push(e[o]);const s=n[o];s&&i.push(s.getCenter()),o++}return i}open(e){this.start(e)}start(e){var i,r,s;if(!e&&!this.polygonEditor)throw new Error("polygonEditor not found");this.polygonEditor=e;const{controlPoint:n,midControlPoint:o}=this.polygonEditor;return this.polygonPaths=this.getPolygonEditorTargetPaths(),this.circleMarkers.setOptions(n).createCircleMarkersByPaths(this.polygonPaths),this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.midCircleMarkers.setOptions(o).createCircleMarkersByPaths(this.polygonTotalPaths),this.lines.createLinesByPaths(this.polygonPaths),(i=this.polygonEditor)==null||i.on("adjust",this.onPolygonEditorAdjust),(r=this.polygonEditor)==null||r.on("removenode",this.onPolygonEditorAdjust),(s=this.polygonEditor)==null||s.on("addnode",this.onPolygonEditorAdjust),this.map.on("mousedown",this.onMouseDown),this.map.on("touchstart",this.onMouseDown),this.map.on("mousemove",this.onMovePolygonEditorPoint),this.map.on("touchmove",this.onMovePolygonEditorPoint),this.map.on("mousemove",this.onMovePolygonEditorMidPoint),this.map.on("touchmove",this.onMovePolygonEditorMidPoint),this.map.on("mousemove",this.onInPolygonEditorLine),this.map.on("touchmove",this.onInPolygonEditorLine),this.map.on("mouseup",this.onMouseUp),this.map.on("touchend",this.onMouseUp),this}close(){this.stop()}stop(){var e,n,o;(e=this.polygonEditor)==null||e.off("adjust",this.onPolygonEditorAdjust),(n=this.polygonEditor)==null||n.off("removenode",this.onPolygonEditorAdjust),(o=this.polygonEditor)==null||o.off("addnode",this.onPolygonEditorAdjust),this.map.off("mousedown",this.onMouseDown),this.map.off("touchstart",this.onMouseDown),this.map.off("mousemove",this.onMovePolygonEditorPoint),this.map.off("touchmove",this.onMovePolygonEditorPoint),this.map.off("mousemove",this.onMovePolygonEditorMidPoint),this.map.off("touchmove",this.onMovePolygonEditorMidPoint),this.map.off("mousemove",this.onInPolygonEditorLine),this.map.off("touchmove",this.onInPolygonEditorLine),this.map.off("mouseup",this.onMouseUp),this.map.off("touchend",this.onMouseUp)}startLineRanging(e){if(!e)throw new Error("polygonEditor not found");this.polygon||(this.polygon=e,this.lines.createLinesByPaths(this.polygon.getPath()),this.map.on("mousemove",this.onInPolygonEditorLine))}stopLineRanging(){this.map.off("mousemove",this.onInPolygonEditorLine)}setPosition(e,n){this.startPosition=e,this.lastPosition=n,this.createDistanceText()}createDistanceText(){this.startPointToCursorText&&this.lastPointToCursorText||(this.startPointToCursorText=S(),this.lastPointToCursorText=S(),this.startPointToCursorText.setMap(this.map),this.lastPointToCursorText.setMap(this.map))}updateDistanceText(e,{text:n,textPos:o}){e.setText(n),e.setPosition(o)}removeLineDistanceText(){var e;(e=this.lineLengthText)==null||e.remove(),this.lineLengthText=null}removeDistanceText(){var e,n;(e=this.startPointToCursorText)==null||e.remove(),(n=this.lastPointToCursorText)==null||n.remove(),this.startPointToCursorText=null,this.lastPointToCursorText=null}reset(){return this.startPosition=null,this.lastPosition=null,this.removeDistanceText(),this.removeLineDistanceText(),this}destroy(){return this.reset(),this.stop(),this.circleMarkers.destroy(),this}destroyLineRanging(){return this.polygon=null,this.startPosition=null,this.lastPosition=null,this.removeLineDistanceText(),this.stopLineRanging(),this}}class Ue{constructor(e,n){a(this,"opts");a(this,"map");a(this,"lines",null);a(this,"polygon",null);a(this,"lineLengthText",null);a(this,"editingMidTipMarkerListPath",null);a(this,"onPolygonRanging",e=>{const n=e.lnglat,o=this.lines.getPointInPolyline(n);if(!o)return this.removeLineDistanceText();const[i,r]=o;this.lineLengthText||(this.lineLengthText=S(),this.lineLengthText.add(this.map)),this.updateDistanceText(this.lineLengthText,A(i,r))});a(this,"onRotateEndEnd",()=>j(this,null,function*(){yield Promise.resolve();const e=this.polygon;this.onDragEnd({target:e})}));a(this,"onDragEnd",e=>j(this,null,function*(){var o;const n=e.target;(o=this.lines)==null||o.reset(),yield Promise.resolve(),this.lines.createLinesByPaths(n.getPath())}));if(!e)throw new Error("map not found!");this.opts=n,this.map=e,this.lines=new Be(this.map),this.immediateActive()}get immediate(){var e;return(e=this.opts)==null?void 0:e.immediate}get draggable(){var n;return((n=this.polygon)==null?void 0:n.getOptions()).draggable}get rotatable(){var e;return(e=this.polygon)==null?void 0:e.rotatable}immediateActive(){var n;const e=(n=this.opts)==null?void 0:n.target;this.immediate&&e.CLASS_NAME==="Overlay.Polygon"&&this.open(e)}open(e){this.start(e||this.polygon)}start(e){if(!e)return;this.polygon=e,this.lines.createLinesByPaths(this.polygon.getPath()),this.map.hasEvents("mousemove",this.onPolygonRanging)||this.map.hasEvents("touchmove",this.onPolygonRanging)||(this.map.on("mousemove",this.onPolygonRanging),this.map.on("touchmove",this.onPolygonRanging)),this.registryPolygonEvents()}registryPolygonEvents(){this.polygon&&(this.draggable&&this.polygon.on("dragend",this.onDragEnd),this.rotatable&&"likeRectangle"in this.polygon&&this.polygon.on("rotateEnd",this.onRotateEndEnd))}destroyPolygonEvents(){var e,n,o,i;this.polygon&&((n=(e=this.polygon).off)==null||n.call(e,"dragend",this.onDragEnd),(i=(o=this.polygon).off)==null||i.call(o,"rotateEnd",this.onRotateEndEnd))}close(){this.stop()}stop(){this.map.off("mousemove",this.onPolygonRanging)}updateDistanceText(e,{text:n,textPos:o}){e.setText(n),e.setPosition(o)}removeLineDistanceText(){var e;(e=this.lineLengthText)==null||e.remove(),this.lineLengthText=null}destroy(){return this.stop(),this.removeLineDistanceText(),this.destroyPolygonEvents(),this.polygon=null,this}}class _t{constructor(){a(this,"events",{})}getEvents(e){return this.events[e]||(this.events[e]=[]),this.events[e]}emit(e,...n){this.getEvents(e).forEach(i=>i(...n))}on(e,n){!e||typeof e!="string"||this.getEvents(e).push(n)}once(e,n){if(!e||typeof e!="string")return;const o=i=>{n(i),this.off(e,o)};this.on(e,o)}off(e,n){if(!(!e||typeof e!="string")){if(!n)return this.clearEvents(e);this.events[e]=this.getEvents(e).filter(o=>o!==n)}}hasEvents(e,n){return!!this.getEvents(e).find(o=>o===n)}clearEvents(e){e?this.events[e]=[]:this.events={}}}class Ke extends _t{constructor(n){super();a(this,"map");a(this,"circleMarkers",null);a(this,"polygonEditor",null);a(this,"polygonTotalPaths",[]);a(this,"circleMarker",null);a(this,"editingMidTipMarkerListPath",null);a(this,"onPolygonEditorAdjust",()=>{Promise.resolve().then(()=>{this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.circleMarkers.createCircleMarkersByPaths(this.polygonTotalPaths)})});a(this,"onMouseDown",n=>{const o=n.lnglat;this.circleMarker=this.circleMarkers.getPointInCircleMarkers(o),!(!this.circleMarker||!this.getEvents("mousedown").length)&&this.emit("mousedown",this.circleMarker)});a(this,"onMouseMove",n=>{!this.circleMarker||!this.getEvents("mousemove").length||this.emit("mousemove",this.circleMarker,n)});a(this,"onMouseUp",()=>{!this.getEvents("mouseup").length||!this.circleMarker||(this.emit("mouseup",this.circleMarker),this.circleMarker=null)});this.map=n.map,this.polygonEditor=n,this.circleMarkers=new It(this.map),this.open(this.polygonEditor)}getPolygonEditorTargetPaths(){var n;return this.polygonEditor?(n=this.polygonEditor.getTarget().getPath())!=null?n:[]:[]}setEditingMidTipMarkerListPath(n){return this.editingMidTipMarkerListPath=n,this}getEditingMidTipMarkerList(){var o,i;const{singleRingListHandle:n}=this.polygonEditor;if(this.editingMidTipMarkerListPath){if(typeof this.editingMidTipMarkerListPath=="function")return this.editingMidTipMarkerListPath(this.polygonEditor);if(typeof this.editingMidTipMarkerListPath=="string")return ce(this.polygonEditor,this.editingMidTipMarkerListPath)}return(o=this.polygonEditor.editingMidTipMarkerList)!=null&&o.length?this.polygonEditor.editingMidTipMarkerList:n?(i=n==null?void 0:n.list)==null?void 0:i.editingMidTipMarkerList:[]}getPolygonEditorTargetTotalPaths(){const n=this.getPolygonEditorTargetPaths(),o=this.getEditingMidTipMarkerList();let i=0;const r=[],s=n.length;for(;i<s;){r.push(n[i]);const l=o[i];l&&r.push(l.getCenter()),i++}return r}open(n){this.start(n)}start(n){var i,r,s;if(!n&&!this.polygonEditor)throw new Error("polygonEditor not found");this.polygonEditor=n;const{midControlPoint:o}=this.polygonEditor;return this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.circleMarkers.setOptions(o).createCircleMarkersByPaths(this.polygonTotalPaths),(i=this.polygonEditor)==null||i.on("adjust",this.onPolygonEditorAdjust),(r=this.polygonEditor)==null||r.on("removenode",this.onPolygonEditorAdjust),(s=this.polygonEditor)==null||s.on("addnode",this.onPolygonEditorAdjust),this.map.on("mousedown",this.onMouseDown),this.map.on("mousemove",this.onMouseMove),this.map.on("mouseup",this.onMouseUp),this}close(){this.stop()}stop(){this.map.off("mousedown",this.onMouseDown),this.map.off("mousemove",this.onMouseMove),this.map.off("mouseup",this.onMouseUp)}destroy(){return this.close(),this.circleMarkers.destroy(),this}}var ha=Object.defineProperty,ca=(t,e,n)=>e in t?ha(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,I=(t,e,n)=>(ca(t,typeof e!="symbol"?e+"":e,n),n);function ua(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var kt={exports:{}},W=typeof Reflect=="object"?Reflect:null,ze=W&&typeof W.apply=="function"?W.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)},ht;W&&typeof W.ownKeys=="function"?ht=W.ownKeys:Object.getOwnPropertySymbols?ht=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:ht=function(t){return Object.getOwnPropertyNames(t)};function ja(t){}var Ge=Number.isNaN||function(t){return t!==t};function f(){f.init.call(this)}kt.exports=f,kt.exports.once=da,f.EventEmitter=f,f.prototype._events=void 0,f.prototype._eventsCount=0,f.prototype._maxListeners=void 0;var He=10;function ct(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(f,"defaultMaxListeners",{enumerable:!0,get:function(){return He},set:function(t){if(typeof t!="number"||t<0||Ge(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");He=t}}),f.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},f.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Ge(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Ye(t){return t._maxListeners===void 0?f.defaultMaxListeners:t._maxListeners}f.prototype.getMaxListeners=function(){return Ye(this)},f.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var o=t==="error",i=this._events;if(i!==void 0)o=o&&i.error===void 0;else if(!o)return!1;if(o){var r;if(e.length>0&&(r=e[0]),r instanceof Error)throw r;var s=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw s.context=r,s}var l=i[t];if(l===void 0)return!1;if(typeof l=="function")ze(l,this,e);else for(var h=l.length,c=Ze(l,h),n=0;n<h;++n)ze(c[n],this,e);return!0};function Xe(t,e,n,o){var i,r,s;if(ct(n),r=t._events,r===void 0?(r=t._events=Object.create(null),t._eventsCount=0):(r.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),r=t._events),s=r[e]),s===void 0)s=r[e]=n,++t._eventsCount;else if(typeof s=="function"?s=r[e]=o?[n,s]:[s,n]:o?s.unshift(n):s.push(n),i=Ye(t),i>0&&s.length>i&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=s.length}return t}f.prototype.addListener=function(t,e){return Xe(this,t,e,!1)},f.prototype.on=f.prototype.addListener,f.prototype.prependListener=function(t,e){return Xe(this,t,e,!0)};function ga(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ve(t,e,n){var o={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=ga.bind(o);return i.listener=n,o.wrapFn=i,i}f.prototype.once=function(t,e){return ct(e),this.on(t,Ve(this,t,e)),this},f.prototype.prependOnceListener=function(t,e){return ct(e),this.prependListener(t,Ve(this,t,e)),this},f.prototype.removeListener=function(t,e){var n,o,i,r,s;if(ct(e),o=this._events,o===void 0)return this;if(n=o[t],n===void 0)return this;if(n===e||n.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete o[t],o.removeListener&&this.emit("removeListener",t,n.listener||e));else if(typeof n!="function"){for(i=-1,r=n.length-1;r>=0;r--)if(n[r]===e||n[r].listener===e){s=n[r].listener,i=r;break}if(i<0)return this;i===0?n.shift():pa(n,i),n.length===1&&(o[t]=n[0]),o.removeListener!==void 0&&this.emit("removeListener",t,s||e)}return this},f.prototype.off=f.prototype.removeListener,f.prototype.removeAllListeners=function(t){var e,n,o;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var i=Object.keys(n),r;for(o=0;o<i.length;++o)r=i[o],r!=="removeListener"&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=n[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(o=e.length-1;o>=0;o--)this.removeListener(t,e[o]);return this};function We(t,e,n){var o=t._events;if(o===void 0)return[];var i=o[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?fa(i):Ze(i,i.length)}f.prototype.listeners=function(t){return We(this,t,!0)},f.prototype.rawListeners=function(t){return We(this,t,!1)},f.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):qe.call(t,e)},f.prototype.listenerCount=qe;function qe(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}f.prototype.eventNames=function(){return this._eventsCount>0?ht(this._events):[]};function Ze(t,e){for(var n=new Array(e),o=0;o<e;++o)n[o]=t[o];return n}function pa(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function fa(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function da(t,e){return new Promise(function(n,o){function i(s){t.removeListener(e,r),o(s)}function r(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}Je(t,e,r,{once:!0}),e!=="error"&&ya(t,i,{once:!0})})}function ya(t,e,n){typeof t.on=="function"&&Je(t,"error",e,n)}function Je(t,e,n,o){if(typeof t.on=="function")o.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(r){o.once&&t.removeEventListener(e,i),n(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var ma=kt.exports;const Pa=ua(ma),va=(t="uid")=>`${t}_${Math.random().toString(16).substring(2)}`,Ta=(t,e=2)=>Number.isNaN(+t)?t:+(+t).toFixed(e),Qe="-26px";class ba extends Pa{constructor(e,n={}){if(super(),I(this,"centerPos",{x:0,y:0}),I(this,"startPos",{x:0,y:0}),I(this,"originRotate",0),I(this,"target",null),I(this,"container"),I(this,"options"),I(this,"targetClassName",va()),I(this,"isMobile",typeof window.orientation<"u"||"ontouchstart"in document.documentElement||/Mobi|Android|iPhone/i.test(navigator.userAgent)),I(this,"onMouseDown",o=>{o.stopPropagation(),this.originRotate=0,this.startPos=this.getClickPos(o),this.calcCenterPos();const i=this.container.style.transform,r=/rotate\((.*)deg\)/g;i.replace(r,(l,h)=>(h=+h,this.originRotate+=h)),this.originRotate=(+this.originRotate||0)%360;const s={event:o,target:this.container,rotate:this.originRotate};this.emit("rotateStart",s),this.isMobile?(document.addEventListener("touchmove",this.onMouseMove,!1),document.addEventListener("touchend",this.onMouseUp,!1)):(document.addEventListener("mousemove",this.onMouseMove,!1),document.addEventListener("mouseup",this.onMouseUp,!1))}),I(this,"onMouseMove",o=>{const i=this.container.style.transform||"rotate(0deg)",r=this.getClickPos(o),s=Ta((this.calcRotate(this.startPos,r)+this.originRotate)%360),l=/rotate\(.*deg\)/g,h=i.replace(l,()=>`rotate(${s}deg)`);this.container.style.transform=h;const c={event:o,target:this.container,rotate:s};this.emit("rotate",c)}),I(this,"onMouseUp",o=>{const i={event:o,target:this.container};this.emit("rotateEnd",i),this.isMobile?(document.removeEventListener("touchmove",this.onMouseMove,!1),document.removeEventListener("touchend",this.onMouseUp,!1)):(document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1))}),!e)throw new Error("not found container");this.container=e,this.options=n,this.originRotate=(this.options.rotate||0)%360,this.createTargetElement(),this.setInitStyle(),this.calcCenterPos(),this.registryEvents()}createTargetElement(){var e;const{top:n=Qe,able:o}=this.options;let i=`${n}`.replace("px","").trim();i.indexOf("%")===-1&&(i=Number.isNaN(+i)?Qe:`${i}px`);const r=`
        position: absolute;
        top: ${i};
        left: 50%;
        min-width: 14px;
        min-height: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        transform: translate(-50%, -50%);
        cursor: pointer;
      `,s=`
      <div class="${this.targetClassName}" style="${r}">
        <svg width="14" height="14" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M10.536 3.464A5 5 0 1 0 11 10l1.424 1.425a7 7 0 1 1-.475-9.374L13.659.34A.2.2 0 0 1 14 .483V5.5a.5.5 0 0 1-.5.5H8.483a.2.2 0 0 1-.142-.341l2.195-2.195z"
              fill="#eb5648"
              fillRule="nonzero"
            />
          </svg>
      </div>`,l=new DOMParser().parseFromString(s,"text/html"),h=l.body.firstChild;if(o instanceof Element){const c=l.body.querySelector("svg");h.replaceChild(o,c)}(e=this.container)==null||e.appendChild(h),this.target=document.querySelector(`.${this.targetClassName}`)}setInitStyle(){var e;if((e=this.container)!=null&&e.style.getPropertyValue("position")||(this.container.style.position="relative"),this.originRotate){const n=window.getComputedStyle(this.container,null);let o=this.container.style.transform||n.getPropertyValue("transform");o=o.replace(/rotate\((.*)deg\)/g,"").trim(),o=o==="none"?"":o,this.container.style.transform=`${o} rotate(${this.originRotate}deg)`}}calcCenterPos(){const{x:e,y:n,width:o,height:i}=this.container.getBoundingClientRect(),r=e+o/2,s=n+i/2;this.setCenterPos({x:r,y:s})}setCenterPos(e){this.centerPos.x=e.x,this.centerPos.y=e.y}destroy(){this.target=null,this.container=null,this.destroyEvents()}registryEvents(){this.isMobile?this.target.addEventListener("touchstart",this.onMouseDown,!1):this.target.addEventListener("mousedown",this.onMouseDown,!1)}destroyEvents(){return this.isMobile?(document.removeEventListener("touchstart",this.onMouseDown,!1),document.removeEventListener("touchmove",this.onMouseMove,!1),document.removeEventListener("touchend",this.onMouseUp,!1)):(document.removeEventListener("mousedown",this.onMouseDown,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1)),this}getClickPos(e){var n,o,i,r;const s=this.isMobile?(o=(n=e.touches)==null?void 0:n[0])==null?void 0:o.pageX:e.x,l=this.isMobile?(r=(i=e.touches)==null?void 0:i[0])==null?void 0:r.pageY:e.y;return{x:s,y:l}}calcRotate(e,n){const{x:o,y:i}=this.centerPos,r={x:e.x-o,y:e.y-i},s={x:n.x-o,y:n.y-i},l=r.x*s.x+r.y*s.y,h=r.x*s.y-r.y*s.x;let c=Math.atan2(h,l);return c=(c+2*Math.PI)%(2*Math.PI),c*(180/Math.PI)}}const Ma=(t,e)=>Math.sqrt(Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2)),$t=1e-8,Ot=10;class Ea extends _t{constructor(n,o={}){super();a(this,"likeRectangleIns");a(this,"opts");a(this,"elementRotatorIns",null);a(this,"rotationPointIns",null);a(this,"midPoint");a(this,"initAngle");a(this,"offset");a(this,"rotationLine");a(this,"customRotationDOMId",`ID${P()}`);a(this,"moveableElementId",`ID${P()}`);a(this,"targetElementId",`ID${P()}`);a(this,"genMarkerContent",()=>{const o=`width:${.05}px; height:${.05}px;`,i=Object.entries({display:"inline-block",width:`${this.radius}px`,height:`${this.radius}px`,cursor:"move",background:"#fff",border:"2px solid #cc6666","border-radius":"50%","transform-origin":"50% 100%"}).reduce((s,[l,h])=>s+=`${l}:${h};`,"");return`
            <div
                style="position: relative; ${o}; background: red;"
                data-rotatable-ref="${this.moveableElementId}"
            >
                <div data-rotatable-ref=${this.customRotationDOMId} style="${i}"></div>
            </div>
        `});a(this,"setMarkerRotatable",()=>{const n=document.querySelector(`[data-rotatable-ref="${this.moveableElementId}"]`),o=document.querySelector(`[data-rotatable-ref="${this.customRotationDOMId}"]`),i=this.calcInitOffset(),r={rotate:this.initAngle,top:-i,able:o};this.elementRotatorIns=new ba(n,r),this.registryEvent()});a(this,"onRotateStart",()=>{this.emit("rotateStart",this.likeRectangleIns)});a(this,"onRotate",n=>{const{event:o,rotate:i}=n;this.rotate(i-this.initAngle),this.emit("rotate",o)});a(this,"onRotateEnd",()=>{this.emit("rotateEnd",this.likeRectangleIns)});a(this,"rotate",n=>{const o=this.mapIns.lngLatToContainer(this.center),i=this.likeRectangleIns.leftTop,r=this.mapIns.lngLatToContainer(i),s=this.calcRotatePoint(r,o,n),l=new AMap.Pixel(s.x,s.y),h=this.mapIns.containerToLngLat(l),c=this.likeRectangleIns.rightTop,u=this.mapIns.lngLatToContainer(c),p=this.calcRotatePoint(u,o,n),v=new AMap.Pixel(p.x,p.y),M=this.mapIns.containerToLngLat(v),T=this.likeRectangleIns.rightBottom,E=this.mapIns.lngLatToContainer(T),b=this.calcRotatePoint(E,o,n),w=new AMap.Pixel(b.x,b.y),nt=this.mapIns.containerToLngLat(w),ut=this.likeRectangleIns.leftBottom,wa=this.mapIns.lngLatToContainer(ut),nn=this.calcRotatePoint(wa,o,n),Ra=new AMap.Pixel(nn.x,nn.y),on=this.mapIns.containerToLngLat(Ra),Ia=[[h.lng,h.lat],[M.lng,M.lat],[nt.lng,nt.lat],[on.lng,on.lat]];this.likeRectangleIns.setPath(Ia)});a(this,"calcRotatePoint",(n,o,i)=>{const r=n.x,s=n.y,l=o.x,h=o.y,c=i*Math.PI/180,u=r-l,p=s-h,v=u*Math.cos(c)-p*Math.sin(c)+l,M=u*Math.sin(c)+p*Math.cos(c)+h;return{x:v,y:M}});a(this,"getDOMTransformRotate",n=>{var r;if(!n)return 0;let o=null;return(((r=n==null?void 0:n.style)==null?void 0:r.transform)||"").replace(/rotate\((.*)deg\)/g,(s,l)=>o=l),+o||0});a(this,"updateRotationAbleOffset",()=>{const n=this.elementRotatorIns.target;n.style.top=`-${this.calcInitOffset()}`});a(this,"onDragStart",()=>j(this,null,function*(){this.reset()}));a(this,"onDragEnd",()=>j(this,null,function*(){this.open()}));if(!n)throw new Error("likeRectangleIns is required");this.likeRectangleIns=n,this.opts=o,this.open()}get mapIns(){return this.likeRectangleIns.likeRectangle.map}get center(){return this.likeRectangleIns.likeRectangle.center}get rotatable(){var n,o,i;return(i=(o=(n=this.likeRectangleIns)==null?void 0:n.likeRectangle)==null?void 0:o.opts)==null?void 0:i.rotatable}get draggable(){var o;return((o=this.likeRectangleIns)==null?void 0:o.getOptions()).draggable}get radius(){const{controllerPointRadius:n=Ot}=this.opts;return Math.max(+`${n}`.replace("px","")||Ot,Ot)}open(){this.rotatable&&(this.calcMidPoint(),this.calcInitAngle(),this.setRotationLine(),this.registryLikeRectangleEvents(),this.createRotationPoint())}reset(){var n,o,i,r;(o=(n=this.elementRotatorIns)==null?void 0:n.destroy)==null||o.call(n),this.elementRotatorIns=null,(r=(i=this.rotationPointIns)==null?void 0:i.destroy)==null||r.call(i),this.rotationPointIns=null}close(){this.reset(),this.destroyLikeRectangleEvents(),this.destroyEvent()}registryLikeRectangleEvents(){const n=this.likeRectangleIns.hasEvents("dragstart",this.onDragStart);this.draggable&&!n&&(this.likeRectangleIns.on("dragstart",this.onDragStart),this.likeRectangleIns.on("dragend",this.onDragEnd))}destroyLikeRectangleEvents(){this.likeRectangleIns.off("dragstart",this.onDragStart),this.likeRectangleIns.off("dragend",this.onDragEnd)}createRotationPoint(){return j(this,null,function*(){var n,o;(o=(n=this.rotationPointIns)==null?void 0:n.destroy)==null||o.call(n),this.rotationPointIns=null,this.rotationPointIns=new AMap.Marker({map:this.mapIns,position:this.center,content:this.genMarkerContent()}),yield Promise.resolve(),this.setMarkerRotatable()})}registryEvent(){var n,o;this.elementRotatorIns&&(this.elementRotatorIns.on("rotateStart",this.onRotateStart),this.elementRotatorIns.on("rotate",this.onRotate),this.elementRotatorIns.on("rotateEnd",this.onRotateEnd),(o=(n=this.mapIns)==null?void 0:n.on)==null||o.call(n,"zoomchange",this.updateRotationAbleOffset))}destroyEvent(){var n,o;this.elementRotatorIns&&(this.elementRotatorIns.off("rotateStart",this.onRotateStart),this.elementRotatorIns.off("rotate",this.onRotate),this.elementRotatorIns.off("rotateEnd",this.onRotateEnd),(o=(n=this.mapIns)==null?void 0:n.off)==null||o.call(n,"zoomchange",this.updateRotationAbleOffset))}calcMidPoint(){var b,w,nt;const n=(nt=(w=(b=this.likeRectangleIns)==null?void 0:b.getPath)==null?void 0:w.call(b))==null?void 0:nt.map(ut=>[ut.lng,ut.lat]);if(!n.length||!this.mapIns)throw new Error("likeRectangle or map is undefined");const o=n[0],i=this.mapIns.lngLatToContainer(o),r=n[1],s=this.mapIns.lngLatToContainer(r);let l=(i.y-s.y)/(i.x-s.x);l=Math.abs(l)<$t?0:l;const h=i.y-l*i.x,c=this.mapIns.lngLatToContainer(this.center),u=-1/l,p=c.y-u*c.x,v=!C(l)||x(l)||!C(u)||x(u)||!C(h)||x(h)||!C(p)||x(p);let M;l===0?M=(i.x+s.x)/2:v?M=i.x:M=(p-h)/(l-u);let T;l===0?T=i.y:v?T=(i.y+s.y)/2:T=l*M+h;const E=new AMap.Pixel(M,T);return this.midPoint=this.mapIns.containerToLngLat(E),this.midPoint}calcInitAngle(){if(!this.mapIns)return;const n=this.mapIns.lngLatToContainer(this.midPoint),o=this.mapIns.lngLatToContainer(this.center),i=Math.atan2(n.y-o.y,n.x-o.x);return this.initAngle=180/Math.PI*i+90,this.initAngle}calcInitOffset(){if(!this.mapIns)return 0;const n=this.mapIns.lngLatToContainer(this.midPoint),o=this.mapIns.lngLatToContainer(this.center);return Ma(n,o)}setRotationLine(){}}class tn extends _t{constructor(n){super();a(this,"opts");a(this,"map");a(this,"width");a(this,"height");a(this,"center");a(this,"leftTop");a(this,"rightTop");a(this,"leftBottom");a(this,"rightBottom");a(this,"likeRectangle");a(this,"rotatableIns");a(this,"likeRectangleDestroy");a(this,"likeRectangleRawSetOptions");this.validatorOpts(n),this.bindOptsToSelf(n),n.path||this.setPoints();const o=this.create();return this.registerRotatable(),this.enhanceMethods(),o}validatorOpts(n){if(!("map"in n)||!n.map)throw new Error("not found map instance")}bindOptsToSelf(n){this.opts=n,Object.entries(n).forEach(([o,i])=>{this[o]=i})}enhanceMethods(){this.likeRectangleDestroy=this.likeRectangle.destroy.bind(this.likeRectangle),this.likeRectangle.destroy=this.destroy.bind(this),this.likeRectangleRawSetOptions=this.likeRectangle.setOptions.bind(this.likeRectangle),this.likeRectangle.setOptions=this.likeRectangleSetOptions.bind(this)}likeRectangleSetOptions(n){var i,r;const{rotatable:o}=L(L({},this.opts),n||{});this.likeRectangleRawSetOptions(n),o?(this.opts.rotatable=!0,this.registerRotatable()):(this.opts.rotatable=!1,(r=(i=this.rotatableIns)==null?void 0:i.close)==null||r.call(i),this.rotatableIns=null)}destroy(){var n,o;(o=(n=this.rotatableIns)==null?void 0:n.close)==null||o.call(n),this.likeRectangleDestroy()}registerRotatable(){const{rotatable:n,rotationOptions:o}=this.opts;if(!n||this.rotatableIns)return;this.rotatableIns=new Ea(this.likeRectangle,o);const i=this.likeRectangle;this.rotatableIns.on("rotateStart",r=>i.emit("rotateStart",r)),this.rotatableIns.on("rotate",r=>i.emit("rotate",r)),this.rotatableIns.on("rotateEnd",r=>i.emit("rotateEnd",r))}calcPoints(n){const[o,i]=n||this.center,r=new AMap.LngLat(o,i),s=ot(this.width/2),l=ot(this.height/2),h=r.offset(-s,l),c=r.offset(s,l),u=r.offset(-s,-l),p=r.offset(s,-l);return{leftTop:[h.lng,h.lat],rightTop:[c.lng,c.lat],leftBottom:[u.lng,u.lat],rightBottom:[p.lng,p.lat]}}setCenter(n){this.center=n}setPoints(){const{leftTop:n,rightTop:o,leftBottom:i,rightBottom:r}=this.calcPoints();this.leftTop=n,this.rightTop=o,this.leftBottom=i,this.rightBottom=r}create(){var i,r,s;const n=((i=this.opts)==null?void 0:i.path)||[this.leftTop,this.rightTop,this.rightBottom,this.leftBottom];if(la(n.join(";").split(";")).length!==4)throw new Error("invalid path");if(this.likeRectangle=new AMap.Polygon,this.likeRectangle.setOptions(L({path:n},this.opts)),this.enhanceProperty(),this.registryEvent(),(r=this.opts)!=null&&r.path){const[l,h,c,u]=(s=this.opts)==null?void 0:s.path;this.updatePoints(l,h,c,u)}return this.likeRectangle}enhanceProperty(){this.likeRectangle.likeRectangle=this,this.likeRectangle.leftTop=this.leftTop,this.likeRectangle.rightTop=this.rightTop,this.likeRectangle.rightBottom=this.rightBottom,this.likeRectangle.leftBottom=this.leftBottom,this.likeRectangle.rotatable=this.opts.rotatable}registryEvent(){this.likeRectangle&&(this.onDragEnd=this.onDragEnd.bind(this),this.likeRectangle.on("dragend",this.onDragEnd))}onDragEnd(n){const i=n.target.getPath(),[r,s,l,h]=i;this.updatePoints(r,s,l,h)}updatePoints(n,o,i,r){this.likeRectangle.leftTop=this.leftTop=n,this.likeRectangle.rightTop=this.rightTop=o,this.likeRectangle.rightBottom=this.rightBottom=i,this.likeRectangle.leftBottom=this.leftBottom=r,this.setCenter(this.getCenter())}getCenter(){var o;return(o=this.map.getFitZoomAndCenterByOverlays([this.likeRectangle]))==null?void 0:o.pop()}}class xa{constructor(e,n,o){a(this,"point");a(this,"points");a(this,"center");a(this,"editor");a(this,"isEnabled",!1);a(this,"leftLineK1",null);a(this,"rightLineK1",null);this.editor=e,this.point=n,this.points=o,this.init(),this.clearClientEvent()}get len(){return this.points.length-1}get extData(){return this.point.getExtData()}get idx(){return this.extData.idx}get map(){return this.editor.map}enable(){this.isEnabled||(this.isEnabled=!0,this.setCursorPointer("move"),this.registryEvent())}disable(){this.isEnabled=!1,this.setCursorPointer("pointer"),this.destroyEvent()}setCursorPointer(e){var n;(n=this.point)==null||n.setOptions({cursor:e})}init(){this.center=this.point.getCenter(),this.onMouseOver=this.onMouseOver.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onDragStart=this.onDragStart.bind(this),this.onDragging=this.onDragging.bind(this),this.onDragEnd=this.onDragEnd.bind(this),this.defaultRegistryEvent()}clearClientEvent(){this.point.clearEvents("click")}defaultRegistryEvent(){const e=this.editor.isMobile;let n=e?"touchstart":"mouseover",o=e?"touchend":"mouseout";!this.point.hasEvents("mouseover",this.onMouseOver)&&this.point.on(n,this.onMouseOver),!this.point.hasEvents("mouseout",this.onMouseOut)&&this.point.on(o,this.onMouseOut)}registryEvent(){this.point.on("dragstart",this.onDragStart),this.point.on("dragging",this.onDragging),this.point.on("dragend",this.onDragEnd)}destroyEvent(){this.point.off("dragstart",this.onDragStart),this.point.off("dragging",this.onDragging),this.point.off("dragend",this.onDragEnd)}onMouseOver(){this.enable()}onMouseOut(){if(this.editor.isMobile){const e=setTimeout(()=>{clearTimeout(e),this.disable()},4)}else this.disable()}onDragStart(e){this.leftLineK1=null,this.rightLineK1=null,this.editor.onDragStart(e)}onDragging(e){const{pixel:n}=e;this.updateNextLeftPoint(n,e),this.updateNextRightPoint(n,e),this.editor.onDragging(e)}onDragEnd(e){const{target:n,pixel:o}=e;this.updateNextLeftPoint(o,e),this.updateNextRightPoint(o,e),this.center=n.getCenter(),this.editor.onDragEnd(e),this.leftLineK1=null,this.rightLineK1=null}updateNextLeftPoint(e,n){const o=this.idx-1>=0?this.idx-1:this.len,i=this.points[o],r=this.map.lngLatToContainer(i.getCenter()),s=o-1>=0?o-1:this.len,l=this.points[s],h=this.map.lngLatToContainer(l.getCenter());let c;this.leftLineK1==null?(c=(h.y-r.y)/(h.x-r.x),this.leftLineK1=c):c=this.leftLineK1,c=Math.abs(c)<$t?0:c;const u=h.y-c*h.x,p=-1/c,v=e.y-p*e.x,M=Number.isNaN(c)||!C(c)||x(c)||Number.isNaN(p)||!C(p)||x(p)||Number.isNaN(u)||!C(u)||x(u)||Number.isNaN(v)||!C(v)||x(v);let T,E;c===0?(T=e.x,E=r.y):M?(T=r.x,E=e.y):(T=(v-u)/(c-p),E=c*T+u);const b=new AMap.Pixel(T,E);this.dispatch(i,b,n.originEvent)}updateNextRightPoint(e,n){const o=this.idx+1<=this.len?this.idx+1:0,i=this.points[o],r=this.map.lngLatToContainer(i.getCenter()),s=o+1<=this.len?o+1:0,l=this.points[s],h=this.map.lngLatToContainer(l.getCenter());let c;this.rightLineK1==null?(c=(h.y-r.y)/(h.x-r.x),this.rightLineK1=c):c=this.rightLineK1,c=Math.abs(c)<$t?0:c;const u=h.y-c*h.x,p=-1/c,v=e.y-p*e.x,M=Number.isNaN(c)||!C(c)||x(c)||Number.isNaN(p)||!C(p)||x(p)||Number.isNaN(u)||!C(u)||x(u)||Number.isNaN(v)||!C(v)||x(v);let T,E;c===0?(T=e.x,E=r.y):M?(T=r.x,E=e.y):(T=(v-u)/(c-p),E=c*T+u);const b=new AMap.Pixel(T,E);this.dispatch(i,b,n.originEvent)}dispatch(e,n,o){const r={lnglat:this.map.containerToLngLat(n),originEvent:o};e.emit("dragend",r)}}const La={rotatingCloseEditor:!0,editingCloseRotator:!0,isMobile:!1};class en{constructor(e,n,o){a(this,"opts");a(this,"map");a(this,"likeRectangle");a(this,"polygonEditor");a(this,"polygonEditorOpen");a(this,"polygonEditorClose");a(this,"controlPoints");a(this,"inEditing",!1);a(this,"isRestart",!1);a(this,"onDragStart",e=>{var n,o;(o=(n=this.rotatableIns)==null?void 0:n.close)==null||o.call(n),this.onChange("dragstart",e)});a(this,"onDragging",e=>{this.updateLikeRectanglePath(),this.onChange("dragging",e)});a(this,"onDragEnd",e=>{var n,o;(o=(n=this.rotatableIns)==null?void 0:n.open)==null||o.call(n),this.onChange("dragend",e)});a(this,"onChange",(e,n)=>{var o,i;(i=(o=this.opts)==null?void 0:o.onChange)==null||i.call(o,e,n)});a(this,"onRotateStart",()=>j(this,null,function*(){this.inEditing&&this.polygonEditorClose()}));a(this,"onRotateEnd",()=>j(this,null,function*(){this.inEditing&&this.open()}));return this.map=e,this.likeRectangle=n,this.opts=L(L({},La),o||{}),this.onChange=this.onChange.bind(this),this.createEditor()}get options(){return At(L({},this.opts),{midControlPoint:{radius:0}})}get rotatable(){var e,n,o;return(o=(n=(e=this.likeRectangle)==null?void 0:e.likeRectangle)==null?void 0:n.opts)==null?void 0:o.rotatable}get rotatingCloseEditor(){return this.opts.rotatingCloseEditor}get rotatableIns(){var e,n;return(n=(e=this.likeRectangle)==null?void 0:e.likeRectangle)==null?void 0:n.rotatableIns}get isMobile(){return this.opts.isMobile}open(){this.inEditing=!0,this.polygonEditorOpen(),this.registryLikeRectangleRotateEvents(),this.registryControlPoints()}close(){this.inEditing=!1,this.destroyLikeRectangleRotateEvents(),this.polygonEditorClose()}findControlPoint(e){return this.controlPoints.find(n=>{const o=n.point.getCenter(),i=`${o.lng}_${o.lat}`,r=e.getCenter(),s=`${r.lng}_${r.lat}`;return i===s})}createEditor(){const e=this.likeRectangle;return this.polygonEditor=new AMap.PolygonEditor(this.map,e,this.options),this.enhanceProperty(),this.polygonEditor}enhanceProperty(){this.polygonEditor.likeRectangleEditor=this,this.polygonEditorOpen=this.polygonEditor.open.bind(this.polygonEditor),this.polygonEditor.open=this.open.bind(this),this.polygonEditorClose=this.polygonEditor.close.bind(this.polygonEditor),this.polygonEditor.close=this.close.bind(this)}registryLikeRectangleRotateEvents(){this.rotatable&&this.rotatingCloseEditor&&(this.likeRectangle.on("rotateStart",this.onRotateStart),this.likeRectangle.on("rotateEnd",this.onRotateEnd))}destroyLikeRectangleRotateEvents(){this.rotatable&&this.rotatingCloseEditor&&(this.likeRectangle.off("rotateStart",this.onRotateStart),this.likeRectangle.off("rotateEnd",this.onRotateEnd))}registryControlPoints(){var n,o,i,r;(this.controlPoints||[]).forEach(s=>{s.destroyEvent()});const e=(r=(i=(o=(n=this.polygonEditor)==null?void 0:n.singleRingListHandle)==null?void 0:o.list)==null?void 0:i.editingVertexMarkerList)!=null?r:[];this.controlPoints=e.map((s,l)=>{const h=s.getExtData()||{};return s.setExtData(At(L({},h),{idx:l})),new xa(this,s,e)})}updateLikeRectanglePath(){const[e,n,o,i]=this.controlPoints,r=e.point.getCenter(),s=n.point.getCenter(),l=o.point.getCenter(),h=i.point.getCenter();this.likeRectangle.likeRectangle.updatePoints([r.lng,r.lat],[s.lng,s.lat],[l.lng,l.lat],[h.lng,h.lat])}}const Ca={PolygonRangingInDrawing:G,PolygonEditorRanging:Fe,PolygonEditorEvent:Ke,PolygonRanging:Ue,LikeRectangle:tn,LikeRectangleEditor:en};g.LikeRectangle=tn,g.LikeRectangleEditor=en,g.PolygonEditorEvent=Ke,g.PolygonEditorRanging=Fe,g.PolygonRanging=Ue,g.PolygonRangingInDrawing=G,g.default=Ca,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});

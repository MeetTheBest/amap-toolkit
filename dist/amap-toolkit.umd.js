(function(u,m){typeof exports=="object"&&typeof module!="undefined"?m(exports):typeof define=="function"&&define.amd?define(["exports"],m):(u=typeof globalThis!="undefined"?globalThis:u||self,m(u["amap-toolkit"]={}))})(this,function(u){"use strict";var _a=Object.defineProperty,ka=Object.defineProperties;var $a=Object.getOwnPropertyDescriptors;var rn=Object.getOwnPropertySymbols;var Oa=Object.prototype.hasOwnProperty,Sa=Object.prototype.propertyIsEnumerable;var St=(u,m,P)=>m in u?_a(u,m,{enumerable:!0,configurable:!0,writable:!0,value:P}):u[m]=P,C=(u,m)=>{for(var P in m||(m={}))Oa.call(m,P)&&St(u,P,m[P]);if(rn)for(var P of rn(m))Sa.call(m,P)&&St(u,P,m[P]);return u},At=(u,m)=>ka(u,$a(m));var a=(u,m,P)=>(St(u,typeof m!="symbol"?m+"":m,P),P);var j=(u,m,P)=>new Promise((it,x)=>{var S=k=>{try{G(P.next(k))}catch(H){x(H)}},A=k=>{try{G(P.throw(k))}catch(H){x(H)}},G=k=>k.done?it(k.value):Promise.resolve(k.value).then(S,A);G((P=P.apply(u,m)).next())});const m={"border-color":"#e1f5fe","font-size":"12px","border-radius":".25rem","background-color":"rgba(0,0,0,.4)","border-width":0,"text-align":"center",color:"#fff"},P=()=>Math.random().toString(16).substring(2),it=(t,e=2)=>Number.isNaN(+t)?t:+t.toFixed(Math.max(e,0)),x=t=>Math.abs(t)>Number.MAX_SAFE_INTEGER,S=(t="",e={})=>new AMap.Text({text:t,style:C(C({},m),e),offset:[0,-10]}),A=(t,e)=>{const n=t.divideBy(2).add(e.divideBy(2));return{text:`${Math.round(t.distance(e))}ç±³`,textPos:n}};let G=class{constructor(e){a(this,"map");a(this,"startPointToCursorText",null);a(this,"lastPointToCursorText",null);a(this,"startPosition",null);a(this,"lastPosition",null);a(this,"getClickPosition",e=>{const n=e.lnglat;this.startPosition?this.startPosition&&(this.lastPosition=n,this.createDistanceText()):this.startPosition=n});a(this,"onMouseMoveInDrawPolygon",e=>{if(!this.startPosition||!this.lastPosition)return;const n=e.lnglat;this.updateDistanceText(this.startPointToCursorText,A(this.startPosition,n)),this.updateDistanceText(this.lastPointToCursorText,A(this.lastPosition,n))});if(!e)throw new Error("map not found!");this.map=e}open(){this.start()}start(){this.map.on("click",this.getClickPosition),this.map.on("mousemove",this.onMouseMoveInDrawPolygon)}close(){this.stop()}stop(){this.map.off("click",this.getClickPosition),this.map.off("mousemove",this.onMouseMoveInDrawPolygon)}createDistanceText(){this.startPointToCursorText&&this.lastPointToCursorText||(this.startPointToCursorText=S(),this.startPointToCursorText.setMap(this.map),this.lastPointToCursorText=S(),this.lastPointToCursorText.setMap(this.map))}updateDistanceText(e,{text:n,textPos:i}){e.setText(n),e.setPosition(i)}removeDistanceText(){var e,n;(e=this.startPointToCursorText)==null||e.remove(),this.startPointToCursorText=null,(n=this.lastPointToCursorText)==null||n.remove(),this.lastPointToCursorText=null}reset(){return this.startPosition=null,this.lastPosition=null,this.removeDistanceText(),this}destroy(){return this.reset(),this.stop(),this}};var k=typeof global=="object"&&global&&global.Object===Object&&global;const H=k;var sn=typeof self=="object"&&self&&self.Object===Object&&self,an=H||sn||Function("return this")();const R=an;var ln=R.Symbol;const I=ln;var jt=Object.prototype,hn=jt.hasOwnProperty,cn=jt.toString,V=I?I.toStringTag:void 0;function gn(t){var e=hn.call(t,V),n=t[V];try{t[V]=void 0;var i=!0}catch(r){}var o=cn.call(t);return i&&(e?t[V]=n:delete t[V]),o}var un=Object.prototype,pn=un.toString;function fn(t){return pn.call(t)}var dn="[object Null]",yn="[object Undefined]",Dt=I?I.toStringTag:void 0;function D(t){return t==null?t===void 0?yn:dn:Dt&&Dt in Object(t)?gn(t):fn(t)}function N(t){return t!=null&&typeof t=="object"}var mn="[object Symbol]";function ut(t){return typeof t=="symbol"||N(t)&&D(t)==mn}function Nt(t,e){for(var n=-1,i=t==null?0:t.length,o=Array(i);++n<i;)o[n]=e(t[n],n,t);return o}var Pn=Array.isArray;const B=Pn;var vn=1/0,Bt=I?I.prototype:void 0,Ft=Bt?Bt.toString:void 0;function Ut(t){if(typeof t=="string")return t;if(B(t))return Nt(t,Ut)+"";if(ut(t))return Ft?Ft.call(t):"";var e=t+"";return e=="0"&&1/t==-vn?"-0":e}function Z(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function Tn(t){return t}var bn="[object AsyncFunction]",En="[object Function]",Mn="[object GeneratorFunction]",xn="[object Proxy]";function Kt(t){if(!Z(t))return!1;var e=D(t);return e==En||e==Mn||e==bn||e==xn}var Cn=R["__core-js_shared__"];const pt=Cn;var zt=function(){var t=/[^.]+$/.exec(pt&&pt.keys&&pt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Ln(t){return!!zt&&zt in t}var wn=Function.prototype,Rn=wn.toString;function F(t){if(t!=null){try{return Rn.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var In=/[\\^$.*+?()[\]{}|]/g,_n=/^\[object .+?Constructor\]$/,kn=Function.prototype,$n=Object.prototype,On=kn.toString,Sn=$n.hasOwnProperty,An=RegExp("^"+On.call(Sn).replace(In,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function jn(t){if(!Z(t)||Ln(t))return!1;var e=Kt(t)?An:_n;return e.test(F(t))}function Dn(t,e){return t==null?void 0:t[e]}function U(t,e){var n=Dn(t,e);return jn(n)?n:void 0}var Nn=U(R,"WeakMap");const ft=Nn;var Gt=Object.create,Bn=function(){function t(){}return function(e){if(!Z(e))return{};if(Gt)return Gt(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();const Fn=Bn;function Un(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Kn(){}function zn(t,e){var n=-1,i=t.length;for(e||(e=Array(i));++n<i;)e[n]=t[n];return e}var Gn=800,Hn=16,Yn=Date.now;function Xn(t){var e=0,n=0;return function(){var i=Yn(),o=Hn-(i-n);if(n=i,o>0){if(++e>=Gn)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function Wn(t){return function(){return t}}var qn=function(){try{var t=U(Object,"defineProperty");return t({},"",{}),t}catch(e){}}();const ot=qn;var Vn=ot?function(t,e){return ot(t,"toString",{configurable:!0,enumerable:!1,value:Wn(e),writable:!0})}:Tn,Zn=Xn(Vn);const Jn=Zn;function Qn(t,e){for(var n=-1,i=t==null?0:t.length;++n<i&&e(t[n],n,t)!==!1;);return t}function ti(t,e,n,i){for(var o=t.length,r=n+(i?1:-1);i?r--:++r<o;)if(e(t[r],r,t))return r;return-1}function ei(t){return t!==t}function ni(t,e,n){for(var i=n-1,o=t.length;++i<o;)if(t[i]===e)return i;return-1}function ii(t,e,n){return e===e?ni(t,e,n):ti(t,ei,n)}function oi(t,e){var n=t==null?0:t.length;return!!n&&ii(t,e,0)>-1}var ri=9007199254740991,si=/^(?:0|[1-9]\d*)$/;function ai(t,e){var n=typeof t;return e=e==null?ri:e,!!e&&(n=="number"||n!="symbol"&&si.test(t))&&t>-1&&t%1==0&&t<e}function Ht(t,e,n){e=="__proto__"&&ot?ot(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Yt(t,e){return t===e||t!==t&&e!==e}var li=Object.prototype,hi=li.hasOwnProperty;function Xt(t,e,n){var i=t[e];(!(hi.call(t,e)&&Yt(i,n))||n===void 0&&!(e in t))&&Ht(t,e,n)}function J(t,e,n,i){var o=!n;n||(n={});for(var r=-1,s=e.length;++r<s;){var l=e[r],h=i?i(n[l],t[l],l,n,t):void 0;h===void 0&&(h=t[l]),o?Ht(n,l,h):Xt(n,l,h)}return n}var Wt=Math.max;function ci(t,e,n){return e=Wt(e===void 0?t.length-1:e,0),function(){for(var i=arguments,o=-1,r=Wt(i.length-e,0),s=Array(r);++o<r;)s[o]=i[e+o];o=-1;for(var l=Array(e+1);++o<e;)l[o]=i[o];return l[e]=n(s),Un(t,this,l)}}var gi=9007199254740991;function qt(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=gi}function Vt(t){return t!=null&&qt(t.length)&&!Kt(t)}var ui=Object.prototype;function dt(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||ui;return t===n}function pi(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i}var fi="[object Arguments]";function Zt(t){return N(t)&&D(t)==fi}var Jt=Object.prototype,di=Jt.hasOwnProperty,yi=Jt.propertyIsEnumerable,mi=Zt(function(){return arguments}())?Zt:function(t){return N(t)&&di.call(t,"callee")&&!yi.call(t,"callee")};const Qt=mi;function Pi(){return!1}var te=typeof u=="object"&&u&&!u.nodeType&&u,ee=te&&typeof module=="object"&&module&&!module.nodeType&&module,vi=ee&&ee.exports===te,ne=vi?R.Buffer:void 0,Ti=ne?ne.isBuffer:void 0,bi=Ti||Pi;const ie=bi;var Ei="[object Arguments]",Mi="[object Array]",xi="[object Boolean]",Ci="[object Date]",Li="[object Error]",wi="[object Function]",Ri="[object Map]",Ii="[object Number]",_i="[object Object]",ki="[object RegExp]",$i="[object Set]",Oi="[object String]",Si="[object WeakMap]",Ai="[object ArrayBuffer]",ji="[object DataView]",Di="[object Float32Array]",Ni="[object Float64Array]",Bi="[object Int8Array]",Fi="[object Int16Array]",Ui="[object Int32Array]",Ki="[object Uint8Array]",zi="[object Uint8ClampedArray]",Gi="[object Uint16Array]",Hi="[object Uint32Array]",y={};y[Di]=y[Ni]=y[Bi]=y[Fi]=y[Ui]=y[Ki]=y[zi]=y[Gi]=y[Hi]=!0,y[Ei]=y[Mi]=y[Ai]=y[xi]=y[ji]=y[Ci]=y[Li]=y[wi]=y[Ri]=y[Ii]=y[_i]=y[ki]=y[$i]=y[Oi]=y[Si]=!1;function Yi(t){return N(t)&&qt(t.length)&&!!y[D(t)]}function yt(t){return function(e){return t(e)}}var oe=typeof u=="object"&&u&&!u.nodeType&&u,Q=oe&&typeof module=="object"&&module&&!module.nodeType&&module,Xi=Q&&Q.exports===oe,mt=Xi&&H.process,Wi=function(){try{var t=Q&&Q.require&&Q.require("util").types;return t||mt&&mt.binding&&mt.binding("util")}catch(e){}}();const Y=Wi;var re=Y&&Y.isTypedArray,qi=re?yt(re):Yi;const Vi=qi;var Zi=Object.prototype,Ji=Zi.hasOwnProperty;function se(t,e){var n=B(t),i=!n&&Qt(t),o=!n&&!i&&ie(t),r=!n&&!i&&!o&&Vi(t),s=n||i||o||r,l=s?pi(t.length,String):[],h=l.length;for(var c in t)(e||Ji.call(t,c))&&!(s&&(c=="length"||o&&(c=="offset"||c=="parent")||r&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||ai(c,h)))&&l.push(c);return l}function ae(t,e){return function(n){return t(e(n))}}var Qi=ae(Object.keys,Object);const to=Qi;var eo=Object.prototype,no=eo.hasOwnProperty;function io(t){if(!dt(t))return to(t);var e=[];for(var n in Object(t))no.call(t,n)&&n!="constructor"&&e.push(n);return e}function Pt(t){return Vt(t)?se(t):io(t)}function oo(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var ro=Object.prototype,so=ro.hasOwnProperty;function ao(t){if(!Z(t))return oo(t);var e=dt(t),n=[];for(var i in t)i=="constructor"&&(e||!so.call(t,i))||n.push(i);return n}function vt(t){return Vt(t)?se(t,!0):ao(t)}var lo=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ho=/^\w*$/;function co(t,e){if(B(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||ut(t)?!0:ho.test(t)||!lo.test(t)||e!=null&&t in Object(e)}var go=U(Object,"create");const tt=go;function uo(){this.__data__=tt?tt(null):{},this.size=0}function po(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var fo="__lodash_hash_undefined__",yo=Object.prototype,mo=yo.hasOwnProperty;function Po(t){var e=this.__data__;if(tt){var n=e[t];return n===fo?void 0:n}return mo.call(e,t)?e[t]:void 0}var vo=Object.prototype,To=vo.hasOwnProperty;function bo(t){var e=this.__data__;return tt?e[t]!==void 0:To.call(e,t)}var Eo="__lodash_hash_undefined__";function Mo(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=tt&&e===void 0?Eo:e,this}function K(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}K.prototype.clear=uo,K.prototype.delete=po,K.prototype.get=Po,K.prototype.has=bo,K.prototype.set=Mo;function xo(){this.__data__=[],this.size=0}function rt(t,e){for(var n=t.length;n--;)if(Yt(t[n][0],e))return n;return-1}var Co=Array.prototype,Lo=Co.splice;function wo(t){var e=this.__data__,n=rt(e,t);if(n<0)return!1;var i=e.length-1;return n==i?e.pop():Lo.call(e,n,1),--this.size,!0}function Ro(t){var e=this.__data__,n=rt(e,t);return n<0?void 0:e[n][1]}function Io(t){return rt(this.__data__,t)>-1}function _o(t,e){var n=this.__data__,i=rt(n,t);return i<0?(++this.size,n.push([t,e])):n[i][1]=e,this}function $(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}$.prototype.clear=xo,$.prototype.delete=wo,$.prototype.get=Ro,$.prototype.has=Io,$.prototype.set=_o;var ko=U(R,"Map");const et=ko;function $o(){this.size=0,this.__data__={hash:new K,map:new(et||$),string:new K}}function Oo(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function st(t,e){var n=t.__data__;return Oo(e)?n[typeof e=="string"?"string":"hash"]:n.map}function So(t){var e=st(this,t).delete(t);return this.size-=e?1:0,e}function Ao(t){return st(this,t).get(t)}function jo(t){return st(this,t).has(t)}function Do(t,e){var n=st(this,t),i=n.size;return n.set(t,e),this.size+=n.size==i?0:1,this}function O(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}O.prototype.clear=$o,O.prototype.delete=So,O.prototype.get=Ao,O.prototype.has=jo,O.prototype.set=Do;var No="Expected a function";function Tt(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(No);var n=function(){var i=arguments,o=e?e.apply(this,i):i[0],r=n.cache;if(r.has(o))return r.get(o);var s=t.apply(this,i);return n.cache=r.set(o,s)||r,s};return n.cache=new(Tt.Cache||O),n}Tt.Cache=O;var Bo=500;function Fo(t){var e=Tt(t,function(i){return n.size===Bo&&n.clear(),i}),n=e.cache;return e}var Uo=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ko=/\\(\\)?/g,zo=Fo(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Uo,function(n,i,o,r){e.push(o?r.replace(Ko,"$1"):i||n)}),e});const Go=zo;function Ho(t){return t==null?"":Ut(t)}function bt(t,e){return B(t)?t:co(t,e)?[t]:Go(Ho(t))}var Yo=1/0;function le(t){if(typeof t=="string"||ut(t))return t;var e=t+"";return e=="0"&&1/t==-Yo?"-0":e}function he(t,e){e=bt(e,t);for(var n=0,i=e.length;t!=null&&n<i;)t=t[le(e[n++])];return n&&n==i?t:void 0}function ce(t,e,n){var i=t==null?void 0:he(t,e);return i===void 0?n:i}function Et(t,e){for(var n=-1,i=e.length,o=t.length;++n<i;)t[o+n]=e[n];return t}var ge=I?I.isConcatSpreadable:void 0;function Xo(t){return B(t)||Qt(t)||!!(ge&&t&&t[ge])}function ue(t,e,n,i,o){var r=-1,s=t.length;for(n||(n=Xo),o||(o=[]);++r<s;){var l=t[r];e>0&&n(l)?e>1?ue(l,e-1,n,i,o):Et(o,l):i||(o[o.length]=l)}return o}function Wo(t){var e=t==null?0:t.length;return e?ue(t,1):[]}function qo(t){return Jn(ci(t,void 0,Wo),t+"")}var Vo=ae(Object.getPrototypeOf,Object);const Mt=Vo;var Zo="[object Object]",Jo=Function.prototype,Qo=Object.prototype,pe=Jo.toString,tr=Qo.hasOwnProperty,er=pe.call(Object);function nr(t){if(!N(t)||D(t)!=Zo)return!1;var e=Mt(t);if(e===null)return!0;var n=tr.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&pe.call(n)==er}function ir(t,e,n){var i=-1,o=t.length;e<0&&(e=-e>o?0:o+e),n=n>o?o:n,n<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var r=Array(o);++i<o;)r[i]=t[i+e];return r}function or(){this.__data__=new $,this.size=0}function rr(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function sr(t){return this.__data__.get(t)}function ar(t){return this.__data__.has(t)}var lr=200;function hr(t,e){var n=this.__data__;if(n instanceof $){var i=n.__data__;if(!et||i.length<lr-1)return i.push([t,e]),this.size=++n.size,this;n=this.__data__=new O(i)}return n.set(t,e),this.size=n.size,this}function X(t){var e=this.__data__=new $(t);this.size=e.size}X.prototype.clear=or,X.prototype.delete=rr,X.prototype.get=sr,X.prototype.has=ar,X.prototype.set=hr;function cr(t,e){return t&&J(e,Pt(e),t)}function gr(t,e){return t&&J(e,vt(e),t)}var fe=typeof u=="object"&&u&&!u.nodeType&&u,de=fe&&typeof module=="object"&&module&&!module.nodeType&&module,ur=de&&de.exports===fe,ye=ur?R.Buffer:void 0,me=ye?ye.allocUnsafe:void 0;function pr(t,e){if(e)return t.slice();var n=t.length,i=me?me(n):new t.constructor(n);return t.copy(i),i}function fr(t,e){for(var n=-1,i=t==null?0:t.length,o=0,r=[];++n<i;){var s=t[n];e(s,n,t)&&(r[o++]=s)}return r}function Pe(){return[]}var dr=Object.prototype,yr=dr.propertyIsEnumerable,ve=Object.getOwnPropertySymbols,mr=ve?function(t){return t==null?[]:(t=Object(t),fr(ve(t),function(e){return yr.call(t,e)}))}:Pe;const xt=mr;function Pr(t,e){return J(t,xt(t),e)}var vr=Object.getOwnPropertySymbols,Tr=vr?function(t){for(var e=[];t;)Et(e,xt(t)),t=Mt(t);return e}:Pe;const Te=Tr;function br(t,e){return J(t,Te(t),e)}function be(t,e,n){var i=e(t);return B(t)?i:Et(i,n(t))}function Er(t){return be(t,Pt,xt)}function Ee(t){return be(t,vt,Te)}var Mr=U(R,"DataView");const Ct=Mr;var xr=U(R,"Promise");const Lt=xr;var Cr=U(R,"Set");const W=Cr;var Me="[object Map]",Lr="[object Object]",xe="[object Promise]",Ce="[object Set]",Le="[object WeakMap]",we="[object DataView]",wr=F(Ct),Rr=F(et),Ir=F(Lt),_r=F(W),kr=F(ft),z=D;(Ct&&z(new Ct(new ArrayBuffer(1)))!=we||et&&z(new et)!=Me||Lt&&z(Lt.resolve())!=xe||W&&z(new W)!=Ce||ft&&z(new ft)!=Le)&&(z=function(t){var e=D(t),n=e==Lr?t.constructor:void 0,i=n?F(n):"";if(i)switch(i){case wr:return we;case Rr:return Me;case Ir:return xe;case _r:return Ce;case kr:return Le}return e});const wt=z;var $r=Object.prototype,Or=$r.hasOwnProperty;function Sr(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&Or.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var Ar=R.Uint8Array;const Re=Ar;function Rt(t){var e=new t.constructor(t.byteLength);return new Re(e).set(new Re(t)),e}function jr(t,e){var n=e?Rt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var Dr=/\w*$/;function Nr(t){var e=new t.constructor(t.source,Dr.exec(t));return e.lastIndex=t.lastIndex,e}var Ie=I?I.prototype:void 0,_e=Ie?Ie.valueOf:void 0;function Br(t){return _e?Object(_e.call(t)):{}}function Fr(t,e){var n=e?Rt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var Ur="[object Boolean]",Kr="[object Date]",zr="[object Map]",Gr="[object Number]",Hr="[object RegExp]",Yr="[object Set]",Xr="[object String]",Wr="[object Symbol]",qr="[object ArrayBuffer]",Vr="[object DataView]",Zr="[object Float32Array]",Jr="[object Float64Array]",Qr="[object Int8Array]",ts="[object Int16Array]",es="[object Int32Array]",ns="[object Uint8Array]",is="[object Uint8ClampedArray]",os="[object Uint16Array]",rs="[object Uint32Array]";function ss(t,e,n){var i=t.constructor;switch(e){case qr:return Rt(t);case Ur:case Kr:return new i(+t);case Vr:return jr(t,n);case Zr:case Jr:case Qr:case ts:case es:case ns:case is:case os:case rs:return Fr(t,n);case zr:return new i;case Gr:case Xr:return new i(t);case Hr:return Nr(t);case Yr:return new i;case Wr:return Br(t)}}function as(t){return typeof t.constructor=="function"&&!dt(t)?Fn(Mt(t)):{}}var ls="[object Map]";function hs(t){return N(t)&&wt(t)==ls}var ke=Y&&Y.isMap,cs=ke?yt(ke):hs;const gs=cs;var us="[object Set]";function ps(t){return N(t)&&wt(t)==us}var $e=Y&&Y.isSet,fs=$e?yt($e):ps;const ds=fs;var ys=1,ms=2,Ps=4,Oe="[object Arguments]",vs="[object Array]",Ts="[object Boolean]",bs="[object Date]",Es="[object Error]",Se="[object Function]",Ms="[object GeneratorFunction]",xs="[object Map]",Cs="[object Number]",Ae="[object Object]",Ls="[object RegExp]",ws="[object Set]",Rs="[object String]",Is="[object Symbol]",_s="[object WeakMap]",ks="[object ArrayBuffer]",$s="[object DataView]",Os="[object Float32Array]",Ss="[object Float64Array]",As="[object Int8Array]",js="[object Int16Array]",Ds="[object Int32Array]",Ns="[object Uint8Array]",Bs="[object Uint8ClampedArray]",Fs="[object Uint16Array]",Us="[object Uint32Array]",d={};d[Oe]=d[vs]=d[ks]=d[$s]=d[Ts]=d[bs]=d[Os]=d[Ss]=d[As]=d[js]=d[Ds]=d[xs]=d[Cs]=d[Ae]=d[Ls]=d[ws]=d[Rs]=d[Is]=d[Ns]=d[Bs]=d[Fs]=d[Us]=!0,d[Es]=d[Se]=d[_s]=!1;function at(t,e,n,i,o,r){var s,l=e&ys,h=e&ms,c=e&Ps;if(n&&(s=o?n(t,i,o,r):n(t)),s!==void 0)return s;if(!Z(t))return t;var g=B(t);if(g){if(s=Sr(t),!l)return zn(t,s)}else{var p=wt(t),v=p==Se||p==Ms;if(ie(t))return pr(t,l);if(p==Ae||p==Oe||v&&!o){if(s=h||v?{}:as(t),!l)return h?br(t,gr(s,t)):Pr(t,cr(s,t))}else{if(!d[p])return o?t:{};s=ss(t,p,l)}}r||(r=new X);var E=r.get(t);if(E)return E;r.set(t,s),ds(t)?t.forEach(function(b){s.add(at(b,e,n,b,t,r))}):gs(t)&&t.forEach(function(b,w){s.set(w,at(b,e,n,w,t,r))});var T=c?h?Ee:Er:h?vt:Pt,M=g?void 0:T(t);return Qn(M||t,function(b,w){M&&(w=b,b=t[w]),Xt(s,w,at(b,e,n,w,t,r))}),s}var Ks="__lodash_hash_undefined__";function zs(t){return this.__data__.set(t,Ks),this}function Gs(t){return this.__data__.has(t)}function lt(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new O;++e<n;)this.add(t[e])}lt.prototype.add=lt.prototype.push=zs,lt.prototype.has=Gs;function Hs(t,e){return t.has(e)}function je(t){var e=-1,n=Array(t.size);return t.forEach(function(i){n[++e]=i}),n}function Ys(t,e,n){for(var i=-1,o=t==null?0:t.length;++i<o;)if(n(e,t[i]))return!0;return!1}function Xs(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function Ws(t,e){return e.length<2?t:he(t,ir(e,0,-1))}var qs=R.isFinite;function L(t){return typeof t=="number"&&qs(t)}function Vs(t,e){return e=bt(e,t),t=Ws(t,e),t==null||delete t[le(Xs(e))]}function Zs(t){return nr(t)?void 0:t}var Js=1,Qs=2,ta=4,ea=qo(function(t,e){var n={};if(t==null)return n;var i=!1;e=Nt(e,function(r){return r=bt(r,t),i||(i=r.length>1),r}),J(t,Ee(t),n),i&&(n=at(n,Js|Qs|ta,Zs));for(var o=e.length;o--;)Vs(n,e[o]);return n});const na=ea;var ia=1/0,oa=W&&1/je(new W([,-0]))[1]==ia?function(t){return new W(t)}:Kn;const ra=oa;var sa=200;function aa(t,e,n){var i=-1,o=oi,r=t.length,s=!0,l=[],h=l;if(n)s=!1,o=Ys;else if(r>=sa){var c=e?null:ra(t);if(c)return je(c);s=!1,o=Hs,h=new lt}else h=e?[]:l;t:for(;++i<r;){var g=t[i],p=e?e(g):g;if(g=n||g!==0?g:0,s&&p===p){for(var v=h.length;v--;)if(h[v]===p)continue t;e&&h.push(p),l.push(g)}else o(h,p,n)||(h!==l&&h.push(p),l.push(g))}return l}function la(t){return t&&t.length?aa(t):[]}const De={radius:6,zIndex:0,strokeOpacity:0,fillOpacity:0};class It{constructor(e){a(this,"map");a(this,"options",C({},De));a(this,"circleMarkers",[]);this.map=e}setOptions(e){return this.options=C(C({},e),na(De,"radius")),this}createCircleMarkersByPaths(e){this.removeFromTheMap(),this.reset(),e.forEach(n=>{this.circleMarkers.push(this.createCircleMarker(n))}),this.addToMap()}createCircleMarker(e){return new AMap.CircleMarker(C({center:e},this.options))}addToMap(){this.map.add(this.circleMarkers)}removeFromTheMap(){this.map.remove(this.circleMarkers)}getPointInCircleMarkers(e){var n;return(n=this.circleMarkers.find(i=>this.isPointInCircle(e,i)))!=null?n:null}getInCircleMarkersPoint(e){const n=this.circleMarkers.find(o=>this.isPointInCircle(e,o));return this.circleMarkers.findIndex(o=>o===n)%2===0?null:n!=null?n:null}isPointInCircle(e,n){return n.contains(e)}reset(){this.circleMarkers=[]}destroy(){this.removeFromTheMap(),this.reset()}}const Ne={zIndex:1,strokeColor:"#00D3FC",strokeWeight:8,strokeOpacity:0};class Be{constructor(e){a(this,"map");a(this,"linesPath",[]);a(this,"lines",[]);if(!e)throw new Error("map not found");this.map=e}getLinesByPaths(e){let n=0;const i=e.length;for(;n<i;){const o=n+1>=i?0:n+1;this.linesPath.push([e[n],e[o]]),n++}return this.linesPath}createLinesByPaths(e){this.reset(),this.getLinesByPaths(e)}createPolyLine(e){return new AMap.Polyline(C({path:e},Ne))}addToMap(){this.map.add(this.lines)}removeFromTheMap(){this.map.remove(this.lines)}getPointInPolyline(e){const n=this.map.getResolution(),i=Ne.strokeWeight*n;return this.linesPath.find(r=>AMap.GeometryUtil.isPointOnSegment(e,r[0],r[1],i))}reset(){this.linesPath=[],this.lines=[]}}class Fe{constructor(e,n){a(this,"map");a(this,"circleMarkers",null);a(this,"midCircleMarkers",null);a(this,"lines",null);a(this,"polygonEditor",null);a(this,"polygonPaths",[]);a(this,"polygonTotalPaths",[]);a(this,"polygon",null);a(this,"startPointToCursorText",null);a(this,"lastPointToCursorText",null);a(this,"lineLengthText",null);a(this,"circleMarker",null);a(this,"midCircleMarker",null);a(this,"startPosition",null);a(this,"lastPosition",null);a(this,"editingMidTipMarkerListPath",null);a(this,"onPolygonEditorAdjust",({target:e})=>{this.polygonPaths=e.getPath(),this.circleMarkers.createCircleMarkersByPaths(this.polygonPaths),this.lines.createLinesByPaths(this.polygonPaths),Promise.resolve().then(()=>{this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.midCircleMarkers.createCircleMarkersByPaths(this.polygonTotalPaths)}),this.reset()});a(this,"onMouseDown",e=>{const n=e.lnglat;this.circleMarker=this.circleMarkers.getPointInCircleMarkers(n),this.midCircleMarker=this.midCircleMarkers.getInCircleMarkersPoint(n)});a(this,"onMovePolygonEditorPoint",e=>{if(this.midCircleMarker)return;if(!this.circleMarker){this.reset();return}const n=this.circleMarker.getCenter(),i=g=>`${g.lng}-${g.lat}`;let o=this.polygonPaths.findIndex(g=>i(g)===i(n));if(o===-1)return;const r=this.polygonPaths.length,s=o-1<=-1?r-1:o-1,l=o+1>=r?0:o+1,h=this.polygonPaths.at(s),c=this.polygonPaths.at(l);this.setPosition(h,c),this.onMouseMoveInDrawPolygon(e)});a(this,"onMovePolygonEditorMidPoint",e=>{if(this.circleMarker)return;if(!this.midCircleMarker){this.reset();return}const n=this.midCircleMarker.getCenter(),i=g=>`${g.lng}-${g.lat}`;let o=this.polygonTotalPaths.findIndex(g=>i(g)===i(n));if(o===-1)return;const r=this.polygonTotalPaths.length,s=o-1<=-1?r-1:o-1,l=o+1>=r?0:o+1,h=this.polygonTotalPaths.at(s),c=this.polygonTotalPaths.at(l);this.setPosition(h,c),this.onMouseMoveInDrawPolygon(e)});a(this,"onMouseUp",()=>{this.circleMarker=null,this.midCircleMarker=null,this.reset()});a(this,"onInPolygonEditorLine",e=>{if(this.circleMarker)return this.removeLineDistanceText();const n=e.lnglat,i=this.lines.getPointInPolyline(n);if(!i)return this.removeLineDistanceText();const[o,r]=i;this.lineLengthText||(this.lineLengthText=S(),this.lineLengthText.add(this.map)),this.updateDistanceText(this.lineLengthText,A(o,r))});a(this,"onMouseMoveInDrawPolygon",e=>{if(!this.startPosition||!this.lastPosition)return;const n=e.lnglat;this.updateDistanceText(this.startPointToCursorText,A(this.startPosition,n)),this.updateDistanceText(this.lastPointToCursorText,A(this.lastPosition,n))});if(!e)throw new Error("map not found!");this.map=e,n&&(this.polygonEditor=n),this.circleMarkers=new It(this.map),this.midCircleMarkers=new It(this.map),this.lines=new Be(this.map)}getPolygonEditorTargetPaths(){var e,n,i;return this.polygonEditor?(i=(n=(e=this.polygonEditor)==null?void 0:e.getTarget)==null?void 0:n.call(e).getPath())!=null?i:[]:[]}setEditingMidTipMarkerListPath(e){return this.editingMidTipMarkerListPath=e,this}getEditingMidTipMarkerList(){var n,i;const{singleRingListHandle:e}=this.polygonEditor;if(this.editingMidTipMarkerListPath){if(typeof this.editingMidTipMarkerListPath=="function")return this.editingMidTipMarkerListPath(this.polygonEditor);if(typeof this.editingMidTipMarkerListPath=="string")return ce(this.polygonEditor,this.editingMidTipMarkerListPath)}return(n=this.polygonEditor.editingMidTipMarkerList)!=null&&n.length?this.polygonEditor.editingMidTipMarkerList:e?(i=e==null?void 0:e.list)==null?void 0:i.editingMidTipMarkerList:[]}getPolygonEditorTargetTotalPaths(){const e=this.getPolygonEditorTargetPaths(),n=this.getEditingMidTipMarkerList();let i=0;const o=[],r=e.length;for(;i<r;){o.push(e[i]);const s=n[i];s&&o.push(s.getCenter()),i++}return o}open(e){this.start(e)}start(e){var o,r,s;if(!e&&!this.polygonEditor)throw new Error("polygonEditor not found");this.polygonEditor=e;const{controlPoint:n,midControlPoint:i}=this.polygonEditor;return this.polygonPaths=this.getPolygonEditorTargetPaths(),this.circleMarkers.setOptions(n).createCircleMarkersByPaths(this.polygonPaths),this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.midCircleMarkers.setOptions(i).createCircleMarkersByPaths(this.polygonTotalPaths),this.lines.createLinesByPaths(this.polygonPaths),(o=this.polygonEditor)==null||o.on("adjust",this.onPolygonEditorAdjust),(r=this.polygonEditor)==null||r.on("removenode",this.onPolygonEditorAdjust),(s=this.polygonEditor)==null||s.on("addnode",this.onPolygonEditorAdjust),this.map.on("mousedown",this.onMouseDown),this.map.on("touchstart",this.onMouseDown),this.map.on("mousemove",this.onMovePolygonEditorPoint),this.map.on("touchmove",this.onMovePolygonEditorPoint),this.map.on("mousemove",this.onMovePolygonEditorMidPoint),this.map.on("touchmove",this.onMovePolygonEditorMidPoint),this.map.on("mousemove",this.onInPolygonEditorLine),this.map.on("touchmove",this.onInPolygonEditorLine),this.map.on("mouseup",this.onMouseUp),this.map.on("touchend",this.onMouseUp),this}close(){this.stop()}stop(){var e,n,i;(e=this.polygonEditor)==null||e.off("adjust",this.onPolygonEditorAdjust),(n=this.polygonEditor)==null||n.off("removenode",this.onPolygonEditorAdjust),(i=this.polygonEditor)==null||i.off("addnode",this.onPolygonEditorAdjust),this.map.off("mousedown",this.onMouseDown),this.map.off("touchstart",this.onMouseDown),this.map.off("mousemove",this.onMovePolygonEditorPoint),this.map.off("touchmove",this.onMovePolygonEditorPoint),this.map.off("mousemove",this.onMovePolygonEditorMidPoint),this.map.off("touchmove",this.onMovePolygonEditorMidPoint),this.map.off("mousemove",this.onInPolygonEditorLine),this.map.off("touchmove",this.onInPolygonEditorLine),this.map.off("mouseup",this.onMouseUp),this.map.off("touchend",this.onMouseUp)}startLineRanging(e){if(!e)throw new Error("polygonEditor not found");this.polygon||(this.polygon=e,this.lines.createLinesByPaths(this.polygon.getPath()),this.map.on("mousemove",this.onInPolygonEditorLine))}stopLineRanging(){this.map.off("mousemove",this.onInPolygonEditorLine)}setPosition(e,n){this.startPosition=e,this.lastPosition=n,this.createDistanceText()}createDistanceText(){this.startPointToCursorText&&this.lastPointToCursorText||(this.startPointToCursorText=S(),this.lastPointToCursorText=S(),this.startPointToCursorText.setMap(this.map),this.lastPointToCursorText.setMap(this.map))}updateDistanceText(e,{text:n,textPos:i}){e.setText(n),e.setPosition(i)}removeLineDistanceText(){var e;(e=this.lineLengthText)==null||e.remove(),this.lineLengthText=null}removeDistanceText(){var e,n;(e=this.startPointToCursorText)==null||e.remove(),(n=this.lastPointToCursorText)==null||n.remove(),this.startPointToCursorText=null,this.lastPointToCursorText=null}reset(){return this.startPosition=null,this.lastPosition=null,this.removeDistanceText(),this.removeLineDistanceText(),this}destroy(){return this.reset(),this.stop(),this.circleMarkers.destroy(),this}destroyLineRanging(){return this.polygon=null,this.startPosition=null,this.lastPosition=null,this.removeLineDistanceText(),this.stopLineRanging(),this}}class Ue{constructor(e,n){a(this,"opts");a(this,"map");a(this,"lines",null);a(this,"polygon",null);a(this,"lineLengthText",null);a(this,"editingMidTipMarkerListPath",null);a(this,"onPolygonRanging",e=>{const n=e.lnglat,i=this.lines.getPointInPolyline(n);if(!i)return this.removeLineDistanceText();const[o,r]=i;this.lineLengthText||(this.lineLengthText=S(),this.lineLengthText.add(this.map)),this.updateDistanceText(this.lineLengthText,A(o,r))});a(this,"onRotateEndEnd",()=>j(this,null,function*(){yield Promise.resolve();const e=this.polygon;this.onDragEnd({target:e})}));a(this,"onDragEnd",e=>j(this,null,function*(){var i;const n=e.target;(i=this.lines)==null||i.reset(),yield Promise.resolve(),this.lines.createLinesByPaths(n.getPath())}));if(!e)throw new Error("map not found!");this.opts=n,this.map=e,this.lines=new Be(this.map),this.immediateActive()}get immediate(){var e;return(e=this.opts)==null?void 0:e.immediate}get draggable(){var n;return((n=this.polygon)==null?void 0:n.getOptions()).draggable}get rotatable(){var e;return(e=this.polygon)==null?void 0:e.rotatable}immediateActive(){var n;const e=(n=this.opts)==null?void 0:n.target;this.immediate&&e.CLASS_NAME==="Overlay.Polygon"&&this.open(e)}open(e){this.start(e||this.polygon)}start(e){if(!e)return;this.polygon=e,this.lines.createLinesByPaths(this.polygon.getPath()),this.map.hasEvents("mousemove",this.onPolygonRanging)||this.map.hasEvents("touchmove",this.onPolygonRanging)||(this.map.on("mousemove",this.onPolygonRanging),this.map.on("touchmove",this.onPolygonRanging)),this.registryPolygonEvents()}registryPolygonEvents(){this.polygon&&(this.draggable&&this.polygon.on("dragend",this.onDragEnd),this.rotatable&&"likeRectangle"in this.polygon&&this.polygon.on("rotateEnd",this.onRotateEndEnd))}destroyPolygonEvents(){var e,n,i,o;this.polygon&&((n=(e=this.polygon).off)==null||n.call(e,"dragend",this.onDragEnd),(o=(i=this.polygon).off)==null||o.call(i,"rotateEnd",this.onRotateEndEnd))}close(){this.stop()}stop(){this.map.off("mousemove",this.onPolygonRanging)}updateDistanceText(e,{text:n,textPos:i}){e.setText(n),e.setPosition(i)}removeLineDistanceText(){var e;(e=this.lineLengthText)==null||e.remove(),this.lineLengthText=null}destroy(){return this.stop(),this.removeLineDistanceText(),this.destroyPolygonEvents(),this.polygon=null,this}}class _t{constructor(){a(this,"events",{})}getEvents(e){return this.events[e]||(this.events[e]=[]),this.events[e]}emit(e,...n){this.getEvents(e).forEach(o=>o(...n))}on(e,n){!e||typeof e!="string"||this.getEvents(e).push(n)}once(e,n){if(!e||typeof e!="string")return;const i=o=>{n(o),this.off(e,i)};this.on(e,i)}off(e,n){if(!(!e||typeof e!="string")){if(!n)return this.clearEvents(e);this.events[e]=this.getEvents(e).filter(i=>i!==n)}}hasEvents(e,n){return!!this.getEvents(e).find(i=>i===n)}clearEvents(e){e?this.events[e]=[]:this.events={}}}class Ke extends _t{constructor(n){super();a(this,"map");a(this,"circleMarkers",null);a(this,"polygonEditor",null);a(this,"polygonTotalPaths",[]);a(this,"circleMarker",null);a(this,"editingMidTipMarkerListPath",null);a(this,"onPolygonEditorAdjust",()=>{Promise.resolve().then(()=>{this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.circleMarkers.createCircleMarkersByPaths(this.polygonTotalPaths)})});a(this,"onMouseDown",n=>{const i=n.lnglat;this.circleMarker=this.circleMarkers.getPointInCircleMarkers(i),!(!this.circleMarker||!this.getEvents("mousedown").length)&&this.emit("mousedown",this.circleMarker)});a(this,"onMouseMove",n=>{!this.circleMarker||!this.getEvents("mousemove").length||this.emit("mousemove",this.circleMarker,n)});a(this,"onMouseUp",()=>{!this.getEvents("mouseup").length||!this.circleMarker||(this.emit("mouseup",this.circleMarker),this.circleMarker=null)});this.map=n.map,this.polygonEditor=n,this.circleMarkers=new It(this.map),this.open(this.polygonEditor)}getPolygonEditorTargetPaths(){var n;return this.polygonEditor?(n=this.polygonEditor.getTarget().getPath())!=null?n:[]:[]}setEditingMidTipMarkerListPath(n){return this.editingMidTipMarkerListPath=n,this}getEditingMidTipMarkerList(){var i,o;const{singleRingListHandle:n}=this.polygonEditor;if(this.editingMidTipMarkerListPath){if(typeof this.editingMidTipMarkerListPath=="function")return this.editingMidTipMarkerListPath(this.polygonEditor);if(typeof this.editingMidTipMarkerListPath=="string")return ce(this.polygonEditor,this.editingMidTipMarkerListPath)}return(i=this.polygonEditor.editingMidTipMarkerList)!=null&&i.length?this.polygonEditor.editingMidTipMarkerList:n?(o=n==null?void 0:n.list)==null?void 0:o.editingMidTipMarkerList:[]}getPolygonEditorTargetTotalPaths(){const n=this.getPolygonEditorTargetPaths(),i=this.getEditingMidTipMarkerList();let o=0;const r=[],s=n.length;for(;o<s;){r.push(n[o]);const l=i[o];l&&r.push(l.getCenter()),o++}return r}open(n){this.start(n)}start(n){var o,r,s;if(!n&&!this.polygonEditor)throw new Error("polygonEditor not found");this.polygonEditor=n;const{midControlPoint:i}=this.polygonEditor;return this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.circleMarkers.setOptions(i).createCircleMarkersByPaths(this.polygonTotalPaths),(o=this.polygonEditor)==null||o.on("adjust",this.onPolygonEditorAdjust),(r=this.polygonEditor)==null||r.on("removenode",this.onPolygonEditorAdjust),(s=this.polygonEditor)==null||s.on("addnode",this.onPolygonEditorAdjust),this.map.on("mousedown",this.onMouseDown),this.map.on("mousemove",this.onMouseMove),this.map.on("mouseup",this.onMouseUp),this}close(){this.stop()}stop(){this.map.off("mousedown",this.onMouseDown),this.map.off("mousemove",this.onMouseMove),this.map.off("mouseup",this.onMouseUp)}destroy(){return this.close(),this.circleMarkers.destroy(),this}}var ha=Object.defineProperty,ca=(t,e,n)=>e in t?ha(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,_=(t,e,n)=>(ca(t,typeof e!="symbol"?e+"":e,n),n);function ga(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var kt={exports:{}},q=typeof Reflect=="object"?Reflect:null,ze=q&&typeof q.apply=="function"?q.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)},ht;q&&typeof q.ownKeys=="function"?ht=q.ownKeys:Object.getOwnPropertySymbols?ht=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:ht=function(t){return Object.getOwnPropertyNames(t)};function ja(t){}var Ge=Number.isNaN||function(t){return t!==t};function f(){f.init.call(this)}kt.exports=f,kt.exports.once=da,f.EventEmitter=f,f.prototype._events=void 0,f.prototype._eventsCount=0,f.prototype._maxListeners=void 0;var He=10;function ct(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(f,"defaultMaxListeners",{enumerable:!0,get:function(){return He},set:function(t){if(typeof t!="number"||t<0||Ge(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");He=t}}),f.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},f.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Ge(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Ye(t){return t._maxListeners===void 0?f.defaultMaxListeners:t._maxListeners}f.prototype.getMaxListeners=function(){return Ye(this)},f.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var i=t==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var r;if(e.length>0&&(r=e[0]),r instanceof Error)throw r;var s=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw s.context=r,s}var l=o[t];if(l===void 0)return!1;if(typeof l=="function")ze(l,this,e);else for(var h=l.length,c=Ze(l,h),n=0;n<h;++n)ze(c[n],this,e);return!0};function Xe(t,e,n,i){var o,r,s;if(ct(n),r=t._events,r===void 0?(r=t._events=Object.create(null),t._eventsCount=0):(r.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),r=t._events),s=r[e]),s===void 0)s=r[e]=n,++t._eventsCount;else if(typeof s=="function"?s=r[e]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),o=Ye(t),o>0&&s.length>o&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=s.length}return t}f.prototype.addListener=function(t,e){return Xe(this,t,e,!1)},f.prototype.on=f.prototype.addListener,f.prototype.prependListener=function(t,e){return Xe(this,t,e,!0)};function ua(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function We(t,e,n){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},o=ua.bind(i);return o.listener=n,i.wrapFn=o,o}f.prototype.once=function(t,e){return ct(e),this.on(t,We(this,t,e)),this},f.prototype.prependOnceListener=function(t,e){return ct(e),this.prependListener(t,We(this,t,e)),this},f.prototype.removeListener=function(t,e){var n,i,o,r,s;if(ct(e),i=this._events,i===void 0)return this;if(n=i[t],n===void 0)return this;if(n===e||n.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if(typeof n!="function"){for(o=-1,r=n.length-1;r>=0;r--)if(n[r]===e||n[r].listener===e){s=n[r].listener,o=r;break}if(o<0)return this;o===0?n.shift():pa(n,o),n.length===1&&(i[t]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",t,s||e)}return this},f.prototype.off=f.prototype.removeListener,f.prototype.removeAllListeners=function(t){var e,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var o=Object.keys(n),r;for(i=0;i<o.length;++i)r=o[i],r!=="removeListener"&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=n[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this};function qe(t,e,n){var i=t._events;if(i===void 0)return[];var o=i[e];return o===void 0?[]:typeof o=="function"?n?[o.listener||o]:[o]:n?fa(o):Ze(o,o.length)}f.prototype.listeners=function(t){return qe(this,t,!0)},f.prototype.rawListeners=function(t){return qe(this,t,!1)},f.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Ve.call(t,e)},f.prototype.listenerCount=Ve;function Ve(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}f.prototype.eventNames=function(){return this._eventsCount>0?ht(this._events):[]};function Ze(t,e){for(var n=new Array(e),i=0;i<e;++i)n[i]=t[i];return n}function pa(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function fa(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function da(t,e){return new Promise(function(n,i){function o(s){t.removeListener(e,r),i(s)}function r(){typeof t.removeListener=="function"&&t.removeListener("error",o),n([].slice.call(arguments))}Je(t,e,r,{once:!0}),e!=="error"&&ya(t,o,{once:!0})})}function ya(t,e,n){typeof t.on=="function"&&Je(t,"error",e,n)}function Je(t,e,n,i){if(typeof t.on=="function")i.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function o(r){i.once&&t.removeEventListener(e,o),n(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var ma=kt.exports;const Pa=ga(ma),va=()=>`ID_${Math.floor(Math.random()*100)}`,Ta=(t,e=2)=>Number.isNaN(+t)?t:+(+t).toFixed(e),Qe="-26px";class ba extends Pa{constructor(e,n={}){if(super(),_(this,"centerPos",{x:0,y:0}),_(this,"startPos",{x:0,y:0}),_(this,"originRotate",0),_(this,"target",null),_(this,"container"),_(this,"options"),_(this,"targetClassName",va()),_(this,"onMouseDown",i=>{i.stopPropagation(),this.originRotate=0,this.startPos={x:i.x,y:i.y},this.calcCenterPos();const o=this.container.style.transform,r=/rotate\((.*)deg\)/g;o.replace(r,(l,h)=>(h=+h,this.originRotate+=h)),this.originRotate=(+this.originRotate||0)%360;const s={event:i,target:this.container,rotate:this.originRotate};this.emit("rotateStart",s),document.addEventListener("mousemove",this.onMouseMove,!1),document.addEventListener("mouseup",this.onMouseUp,!1)}),_(this,"onMouseMove",i=>{const o=this.container.style.transform||"rotate(0deg)",r=Ta((this.calcRotate(this.startPos,i)+this.originRotate)%360),s=/rotate\(.*deg\)/g,l=o.replace(s,()=>`rotate(${r}deg)`);this.container.style.transform=l;const h={event:i,target:this.container,rotate:r};this.emit("rotate",h)}),_(this,"onMouseUp",i=>{const o={event:i,target:this.container};this.emit("rotateEnd",o),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1)}),!e)throw new Error("not found container");this.container=e,this.options=n,this.originRotate=(this.options.rotate||0)%360,this.createTargetElement(),this.setInitStyle(),this.calcCenterPos(),this.registryEvents()}createTargetElement(){var e;const{top:n=Qe,able:i}=this.options;let o=`${n}`.replace("px","").trim();o.indexOf("%")===-1&&(o=Number.isNaN(+o)?Qe:`${o}px`);const r=`
        position: absolute;
        top: ${o};
        left: 50%;
        min-width: 14px;
        min-height: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        transform: translate(-50%, -50%);
        cursor: pointer;
      `,s=`
      <div class="${this.targetClassName}" style="${r}">
        <svg width="14" height="14" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M10.536 3.464A5 5 0 1 0 11 10l1.424 1.425a7 7 0 1 1-.475-9.374L13.659.34A.2.2 0 0 1 14 .483V5.5a.5.5 0 0 1-.5.5H8.483a.2.2 0 0 1-.142-.341l2.195-2.195z"
              fill="#eb5648"
              fillRule="nonzero"
            />
          </svg>
      </div>`,l=new DOMParser().parseFromString(s,"text/html"),h=l.body.firstChild;if(i instanceof Element){const c=l.body.querySelector("svg");h.replaceChild(i,c)}(e=this.container)==null||e.appendChild(h),this.target=document.querySelector(`.${this.targetClassName}`)}setInitStyle(){var e;if((e=this.container)!=null&&e.style.getPropertyValue("position")||(this.container.style.position="relative"),this.originRotate){const n=window.getComputedStyle(this.container,null);let i=this.container.style.transform||n.getPropertyValue("transform");i=i.replace(/rotate\((.*)deg\)/g,"").trim(),i=i==="none"?"":i,this.container.style.transform=`${i} rotate(${this.originRotate}deg)`}}calcCenterPos(){const{x:e,y:n,width:i,height:o}=this.container.getBoundingClientRect(),r=e+i/2,s=n+o/2;this.setCenterPos({x:r,y:s})}setCenterPos(e){this.centerPos.x=e.x,this.centerPos.y=e.y}destroy(){this.target=null,this.container=null,this.destroyEvents()}registryEvents(){this.target.addEventListener("mousedown",this.onMouseDown,!1)}destroyEvents(){return document.removeEventListener("mousedown",this.onMouseDown,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),this}calcRotate(e,n){const{x:i,y:o}=this.centerPos,r={x:e.x-i,y:e.y-o},s={x:n.x-i,y:n.y-o},l=r.x*s.x+r.y*s.y,h=r.x*s.y-r.y*s.x;let c=Math.atan2(h,l);return c=(c+2*Math.PI)%(2*Math.PI),c*(180/Math.PI)}}const Ea=(t,e)=>Math.sqrt(Math.pow(Math.abs(t.x-e.x),2)+Math.pow(Math.abs(t.y-e.y),2)),$t=1e-8,Ot=10;class Ma extends _t{constructor(n,i={}){super();a(this,"likeRectangleIns");a(this,"opts");a(this,"elementRotatorIns",null);a(this,"rotationPointIns",null);a(this,"midPoint");a(this,"initAngle");a(this,"offset");a(this,"rotationLine");a(this,"customRotationDOMId",`ID${P()}`);a(this,"moveableElementId",`ID${P()}`);a(this,"targetElementId",`ID${P()}`);a(this,"genMarkerContent",()=>{const i=`width:${.05}px; height:${.05}px;`,o=Object.entries({display:"inline-block",width:`${this.radius}px`,height:`${this.radius}px`,cursor:"move",background:"#fff",border:"2px solid #cc6666","border-radius":"50%","transform-origin":"50% 100%"}).reduce((s,[l,h])=>s+=`${l}:${h};`,"");return`
            <div
                style="position: relative; ${i}; background: red;"
                data-rotatable-ref="${this.moveableElementId}"
            >
                <div data-rotatable-ref=${this.customRotationDOMId} style="${o}"></div>
            </div>
        `});a(this,"setMarkerRotatable",()=>{const n=document.querySelector(`[data-rotatable-ref="${this.moveableElementId}"]`),i=document.querySelector(`[data-rotatable-ref="${this.customRotationDOMId}"]`),o=this.calcInitOffset(),r={rotate:this.initAngle,top:-o,able:i};this.elementRotatorIns=new ba(n,r),this.registryEvent()});a(this,"onRotateStart",()=>{this.emit("rotateStart",this.likeRectangleIns)});a(this,"onRotate",n=>{const{event:i,rotate:o}=n;this.rotate(o-this.initAngle),this.emit("rotate",i)});a(this,"onRotateEnd",()=>{this.emit("rotateEnd",this.likeRectangleIns)});a(this,"rotate",n=>{const i=this.mapIns.lngLatToContainer(this.center),o=this.likeRectangleIns.leftTop,r=this.mapIns.lngLatToContainer(o),s=this.calcRotatePoint(r,i,n),l=new AMap.Pixel(s.x,s.y),h=this.mapIns.containerToLngLat(l),c=this.likeRectangleIns.rightTop,g=this.mapIns.lngLatToContainer(c),p=this.calcRotatePoint(g,i,n),v=new AMap.Pixel(p.x,p.y),E=this.mapIns.containerToLngLat(v),T=this.likeRectangleIns.rightBottom,M=this.mapIns.lngLatToContainer(T),b=this.calcRotatePoint(M,i,n),w=new AMap.Pixel(b.x,b.y),nt=this.mapIns.containerToLngLat(w),gt=this.likeRectangleIns.leftBottom,wa=this.mapIns.lngLatToContainer(gt),nn=this.calcRotatePoint(wa,i,n),Ra=new AMap.Pixel(nn.x,nn.y),on=this.mapIns.containerToLngLat(Ra),Ia=[[h.lng,h.lat],[E.lng,E.lat],[nt.lng,nt.lat],[on.lng,on.lat]];this.likeRectangleIns.setPath(Ia)});a(this,"calcRotatePoint",(n,i,o)=>{const r=n.x,s=n.y,l=i.x,h=i.y,c=o*Math.PI/180,g=r-l,p=s-h,v=g*Math.cos(c)-p*Math.sin(c)+l,E=g*Math.sin(c)+p*Math.cos(c)+h;return{x:v,y:E}});a(this,"getDOMTransformRotate",n=>{var r;if(!n)return 0;let i=null;return(((r=n==null?void 0:n.style)==null?void 0:r.transform)||"").replace(/rotate\((.*)deg\)/g,(s,l)=>i=l),+i||0});a(this,"updateRotationAbleOffset",()=>{const n=this.elementRotatorIns.target;n.style.top=`-${this.calcInitOffset()}`});a(this,"onDragStart",()=>j(this,null,function*(){this.reset()}));a(this,"onDragEnd",()=>j(this,null,function*(){this.open()}));if(!n)throw new Error("likeRectangleIns is required");this.likeRectangleIns=n,this.opts=i,this.open()}get mapIns(){return this.likeRectangleIns.likeRectangle.map}get center(){return this.likeRectangleIns.likeRectangle.center}get rotatable(){var n,i,o;return(o=(i=(n=this.likeRectangleIns)==null?void 0:n.likeRectangle)==null?void 0:i.opts)==null?void 0:o.rotatable}get draggable(){var i;return((i=this.likeRectangleIns)==null?void 0:i.getOptions()).draggable}get radius(){const{controllerPointRadius:n=Ot}=this.opts;return Math.max(+`${n}`.replace("px","")||Ot,Ot)}open(){this.rotatable&&(this.calcMidPoint(),this.calcInitAngle(),this.setRotationLine(),this.registryLikeRectangleEvents(),this.createRotationPoint())}reset(){var n,i,o,r;(i=(n=this.elementRotatorIns)==null?void 0:n.destroy)==null||i.call(n),this.elementRotatorIns=null,(r=(o=this.rotationPointIns)==null?void 0:o.destroy)==null||r.call(o),this.rotationPointIns=null}close(){this.reset(),this.destroyLikeRectangleEvents(),this.destroyEvent()}registryLikeRectangleEvents(){const n=this.likeRectangleIns.hasEvents("dragstart",this.onDragStart);this.draggable&&!n&&(this.likeRectangleIns.on("dragstart",this.onDragStart),this.likeRectangleIns.on("dragend",this.onDragEnd))}destroyLikeRectangleEvents(){this.likeRectangleIns.off("dragstart",this.onDragStart),this.likeRectangleIns.off("dragend",this.onDragEnd)}createRotationPoint(){return j(this,null,function*(){var n,i;(i=(n=this.rotationPointIns)==null?void 0:n.destroy)==null||i.call(n),this.rotationPointIns=null,this.rotationPointIns=new AMap.Marker({map:this.mapIns,position:this.center,content:this.genMarkerContent()}),yield Promise.resolve(),this.setMarkerRotatable()})}registryEvent(){var n,i;this.elementRotatorIns&&(this.elementRotatorIns.on("rotateStart",this.onRotateStart),this.elementRotatorIns.on("rotate",this.onRotate),this.elementRotatorIns.on("rotateEnd",this.onRotateEnd),(i=(n=this.mapIns)==null?void 0:n.on)==null||i.call(n,"zoomchange",this.updateRotationAbleOffset))}destroyEvent(){var n,i;this.elementRotatorIns&&(this.elementRotatorIns.off("rotateStart",this.onRotateStart),this.elementRotatorIns.off("rotate",this.onRotate),this.elementRotatorIns.off("rotateEnd",this.onRotateEnd),(i=(n=this.mapIns)==null?void 0:n.off)==null||i.call(n,"zoomchange",this.updateRotationAbleOffset))}calcMidPoint(){var b,w,nt;const n=(nt=(w=(b=this.likeRectangleIns)==null?void 0:b.getPath)==null?void 0:w.call(b))==null?void 0:nt.map(gt=>[gt.lng,gt.lat]);if(!n.length||!this.mapIns)throw new Error("likeRectangle or map is undefined");const i=n[0],o=this.mapIns.lngLatToContainer(i),r=n[1],s=this.mapIns.lngLatToContainer(r);let l=(o.y-s.y)/(o.x-s.x);l=Math.abs(l)<$t?0:l;const h=o.y-l*o.x,c=this.mapIns.lngLatToContainer(this.center),g=-1/l,p=c.y-g*c.x,v=!L(l)||x(l)||!L(g)||x(g)||!L(h)||x(h)||!L(p)||x(p);let E;l===0?E=(o.x+s.x)/2:v?E=o.x:E=(p-h)/(l-g);let T;l===0?T=o.y:v?T=(o.y+s.y)/2:T=l*E+h;const M=new AMap.Pixel(E,T);return this.midPoint=this.mapIns.containerToLngLat(M),this.midPoint}calcInitAngle(){if(!this.mapIns)return;const n=this.mapIns.lngLatToContainer(this.midPoint),i=this.mapIns.lngLatToContainer(this.center),o=Math.atan2(n.y-i.y,n.x-i.x);return this.initAngle=180/Math.PI*o+90,this.initAngle}calcInitOffset(){if(!this.mapIns)return 0;const n=this.mapIns.lngLatToContainer(this.midPoint),i=this.mapIns.lngLatToContainer(this.center);return Ea(n,i)}setRotationLine(){}}class tn extends _t{constructor(n){super();a(this,"opts");a(this,"map");a(this,"width");a(this,"height");a(this,"center");a(this,"leftTop");a(this,"rightTop");a(this,"leftBottom");a(this,"rightBottom");a(this,"likeRectangle");a(this,"rotatableIns");a(this,"likeRectangleDestroy");a(this,"likeRectangleRawSetOptions");this.validatorOpts(n),this.bindOptsToSelf(n),n.path||this.setPoints();const i=this.create();return this.registerRotatable(),this.enhanceMethods(),i}validatorOpts(n){if(!("map"in n)||!n.map)throw new Error("not found map instance")}bindOptsToSelf(n){this.opts=n,Object.entries(n).forEach(([i,o])=>{this[i]=o})}enhanceMethods(){this.likeRectangleDestroy=this.likeRectangle.destroy.bind(this.likeRectangle),this.likeRectangle.destroy=this.destroy.bind(this),this.likeRectangleRawSetOptions=this.likeRectangle.setOptions.bind(this.likeRectangle),this.likeRectangle.setOptions=this.likeRectangleSetOptions.bind(this)}likeRectangleSetOptions(n){var o,r;const{rotatable:i}=C(C({},this.opts),n||{});this.likeRectangleRawSetOptions(n),i?(this.opts.rotatable=!0,this.registerRotatable()):(this.opts.rotatable=!1,(r=(o=this.rotatableIns)==null?void 0:o.close)==null||r.call(o),this.rotatableIns=null)}destroy(){var n,i;(i=(n=this.rotatableIns)==null?void 0:n.close)==null||i.call(n),this.likeRectangleDestroy()}registerRotatable(){const{rotatable:n,rotationOptions:i}=this.opts;if(!n||this.rotatableIns)return;this.rotatableIns=new Ma(this.likeRectangle,i);const o=this.likeRectangle;this.rotatableIns.on("rotateStart",r=>o.emit("rotateStart",r)),this.rotatableIns.on("rotate",r=>o.emit("rotate",r)),this.rotatableIns.on("rotateEnd",r=>o.emit("rotateEnd",r))}calcPoints(n){const[i,o]=n||this.center,r=new AMap.LngLat(i,o),s=it(this.width/2),l=it(this.height/2),h=r.offset(-s,l),c=r.offset(s,l),g=r.offset(-s,-l),p=r.offset(s,-l);return{leftTop:[h.lng,h.lat],rightTop:[c.lng,c.lat],leftBottom:[g.lng,g.lat],rightBottom:[p.lng,p.lat]}}setCenter(n){this.center=n}setPoints(){const{leftTop:n,rightTop:i,leftBottom:o,rightBottom:r}=this.calcPoints();this.leftTop=n,this.rightTop=i,this.leftBottom=o,this.rightBottom=r}create(){var o,r,s;const n=((o=this.opts)==null?void 0:o.path)||[this.leftTop,this.rightTop,this.rightBottom,this.leftBottom];if(la(n.join(";").split(";")).length!==4)throw new Error("invalid path");if(this.likeRectangle=new AMap.Polygon,this.likeRectangle.setOptions(C({path:n},this.opts)),this.enhanceProperty(),this.registryEvent(),(r=this.opts)!=null&&r.path){const[l,h,c,g]=(s=this.opts)==null?void 0:s.path;this.updatePoints(l,h,c,g)}return this.likeRectangle}enhanceProperty(){this.likeRectangle.likeRectangle=this,this.likeRectangle.leftTop=this.leftTop,this.likeRectangle.rightTop=this.rightTop,this.likeRectangle.rightBottom=this.rightBottom,this.likeRectangle.leftBottom=this.leftBottom,this.likeRectangle.rotatable=this.opts.rotatable}registryEvent(){this.likeRectangle&&(this.onDragEnd=this.onDragEnd.bind(this),this.likeRectangle.on("dragend",this.onDragEnd))}onDragEnd(n){const o=n.target.getPath(),[r,s,l,h]=o;this.updatePoints(r,s,l,h)}updatePoints(n,i,o,r){this.likeRectangle.leftTop=this.leftTop=n,this.likeRectangle.rightTop=this.rightTop=i,this.likeRectangle.rightBottom=this.rightBottom=o,this.likeRectangle.leftBottom=this.leftBottom=r,this.setCenter(this.getCenter())}getCenter(){var i;return(i=this.map.getFitZoomAndCenterByOverlays([this.likeRectangle]))==null?void 0:i.pop()}}class xa{constructor(e,n,i){a(this,"point");a(this,"points");a(this,"center");a(this,"editor");a(this,"isEnabled",!1);a(this,"leftLineK1",null);a(this,"rightLineK1",null);this.editor=e,this.point=n,this.points=i,this.init(),this.clearClientEvent()}get len(){return this.points.length-1}get extData(){return this.point.getExtData()}get idx(){return this.extData.idx}get map(){return this.editor.map}enable(){this.isEnabled||(this.isEnabled=!0,this.setCursorPointer("move"),this.registryEvent())}disable(){this.isEnabled=!1,this.setCursorPointer("pointer"),this.destroyEvent()}setCursorPointer(e){var n;(n=this.point)==null||n.setOptions({cursor:e})}init(){this.center=this.point.getCenter(),this.onMouseOver=this.onMouseOver.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onDragStart=this.onDragStart.bind(this),this.onDragging=this.onDragging.bind(this),this.onDragEnd=this.onDragEnd.bind(this),this.defaultRegistryEvent()}clearClientEvent(){this.point.clearEvents("click")}defaultRegistryEvent(){const e=this.editor.isMobile;let n=e?"touchstart":"mouseover",i=e?"touchend":"mouseout";!this.point.hasEvents("mouseover",this.onMouseOver)&&this.point.on(n,this.onMouseOver),!this.point.hasEvents("mouseout",this.onMouseOut)&&this.point.on(i,this.onMouseOut)}registryEvent(){this.point.on("dragstart",this.onDragStart),this.point.on("dragging",this.onDragging),this.point.on("dragend",this.onDragEnd)}destroyEvent(){this.point.off("dragstart",this.onDragStart),this.point.off("dragging",this.onDragging),this.point.off("dragend",this.onDragEnd)}onMouseOver(){this.enable()}onMouseOut(){if(this.editor.isMobile){const e=setTimeout(()=>{clearTimeout(e),this.disable()},4)}else this.disable()}onDragStart(e){this.leftLineK1=null,this.rightLineK1=null,this.editor.onDragStart(e)}onDragging(e){const{pixel:n}=e;this.updateNextLeftPoint(n,e),this.updateNextRightPoint(n,e),this.editor.onDragging(e)}onDragEnd(e){const{target:n,pixel:i}=e;this.updateNextLeftPoint(i,e),this.updateNextRightPoint(i,e),this.center=n.getCenter(),this.editor.onDragEnd(e),this.leftLineK1=null,this.rightLineK1=null}updateNextLeftPoint(e,n){const i=this.idx-1>=0?this.idx-1:this.len,o=this.points[i],r=this.map.lngLatToContainer(o.getCenter()),s=i-1>=0?i-1:this.len,l=this.points[s],h=this.map.lngLatToContainer(l.getCenter());let c;this.leftLineK1==null?(c=(h.y-r.y)/(h.x-r.x),this.leftLineK1=c):c=this.leftLineK1,c=Math.abs(c)<$t?0:c;const g=h.y-c*h.x,p=-1/c,v=e.y-p*e.x,E=Number.isNaN(c)||!L(c)||x(c)||Number.isNaN(p)||!L(p)||x(p)||Number.isNaN(g)||!L(g)||x(g)||Number.isNaN(v)||!L(v)||x(v);let T,M;c===0?(T=e.x,M=r.y):E?(T=r.x,M=e.y):(T=(v-g)/(c-p),M=c*T+g);const b=new AMap.Pixel(T,M);this.dispatch(o,b,n.originEvent)}updateNextRightPoint(e,n){const i=this.idx+1<=this.len?this.idx+1:0,o=this.points[i],r=this.map.lngLatToContainer(o.getCenter()),s=i+1<=this.len?i+1:0,l=this.points[s],h=this.map.lngLatToContainer(l.getCenter());let c;this.rightLineK1==null?(c=(h.y-r.y)/(h.x-r.x),this.rightLineK1=c):c=this.rightLineK1,c=Math.abs(c)<$t?0:c;const g=h.y-c*h.x,p=-1/c,v=e.y-p*e.x,E=Number.isNaN(c)||!L(c)||x(c)||Number.isNaN(p)||!L(p)||x(p)||Number.isNaN(g)||!L(g)||x(g)||Number.isNaN(v)||!L(v)||x(v);let T,M;c===0?(T=e.x,M=r.y):E?(T=r.x,M=e.y):(T=(v-g)/(c-p),M=c*T+g);const b=new AMap.Pixel(T,M);this.dispatch(o,b,n.originEvent)}dispatch(e,n,i){const r={lnglat:this.map.containerToLngLat(n),originEvent:i};e.emit("dragend",r)}}const Ca={rotatingCloseEditor:!0,editingCloseRotator:!0,isMobile:!1};class en{constructor(e,n,i){a(this,"opts");a(this,"map");a(this,"likeRectangle");a(this,"polygonEditor");a(this,"polygonEditorOpen");a(this,"polygonEditorClose");a(this,"controlPoints");a(this,"inEditing",!1);a(this,"isRestart",!1);a(this,"onDragStart",e=>{var n,i;(i=(n=this.rotatableIns)==null?void 0:n.close)==null||i.call(n),this.onChange("dragstart",e)});a(this,"onDragging",e=>{this.updateLikeRectanglePath(),this.onChange("dragging",e)});a(this,"onDragEnd",e=>{var n,i;(i=(n=this.rotatableIns)==null?void 0:n.open)==null||i.call(n),this.onChange("dragend",e)});a(this,"onChange",(e,n)=>{var i,o;(o=(i=this.opts)==null?void 0:i.onChange)==null||o.call(i,e,n)});a(this,"onRotateStart",()=>j(this,null,function*(){this.inEditing&&this.polygonEditorClose()}));a(this,"onRotateEnd",()=>j(this,null,function*(){this.inEditing&&this.open()}));return this.map=e,this.likeRectangle=n,this.opts=C(C({},Ca),i||{}),this.onChange=this.onChange.bind(this),this.createEditor()}get options(){return At(C({},this.opts),{midControlPoint:{radius:0}})}get rotatable(){var e,n,i;return(i=(n=(e=this.likeRectangle)==null?void 0:e.likeRectangle)==null?void 0:n.opts)==null?void 0:i.rotatable}get rotatingCloseEditor(){return this.opts.rotatingCloseEditor}get rotatableIns(){var e,n;return(n=(e=this.likeRectangle)==null?void 0:e.likeRectangle)==null?void 0:n.rotatableIns}get isMobile(){return this.opts.isMobile}open(){this.inEditing=!0,this.polygonEditorOpen(),this.registryLikeRectangleRotateEvents(),this.registryControlPoints()}close(){this.inEditing=!1,this.destroyLikeRectangleRotateEvents(),this.polygonEditorClose()}findControlPoint(e){return this.controlPoints.find(n=>{const i=n.point.getCenter(),o=`${i.lng}_${i.lat}`,r=e.getCenter(),s=`${r.lng}_${r.lat}`;return o===s})}createEditor(){const e=this.likeRectangle;return this.polygonEditor=new AMap.PolygonEditor(this.map,e,this.options),this.enhanceProperty(),this.polygonEditor}enhanceProperty(){this.polygonEditor.likeRectangleEditor=this,this.polygonEditorOpen=this.polygonEditor.open.bind(this.polygonEditor),this.polygonEditor.open=this.open.bind(this),this.polygonEditorClose=this.polygonEditor.close.bind(this.polygonEditor),this.polygonEditor.close=this.close.bind(this)}registryLikeRectangleRotateEvents(){this.rotatable&&this.rotatingCloseEditor&&(this.likeRectangle.on("rotateStart",this.onRotateStart),this.likeRectangle.on("rotateEnd",this.onRotateEnd))}destroyLikeRectangleRotateEvents(){this.rotatable&&this.rotatingCloseEditor&&(this.likeRectangle.off("rotateStart",this.onRotateStart),this.likeRectangle.off("rotateEnd",this.onRotateEnd))}registryControlPoints(){var n,i,o,r;(this.controlPoints||[]).forEach(s=>{s.destroyEvent()});const e=(r=(o=(i=(n=this.polygonEditor)==null?void 0:n.singleRingListHandle)==null?void 0:i.list)==null?void 0:o.editingVertexMarkerList)!=null?r:[];this.controlPoints=e.map((s,l)=>{const h=s.getExtData()||{};return s.setExtData(At(C({},h),{idx:l})),new xa(this,s,e)})}updateLikeRectanglePath(){const[e,n,i,o]=this.controlPoints,r=e.point.getCenter(),s=n.point.getCenter(),l=i.point.getCenter(),h=o.point.getCenter();this.likeRectangle.likeRectangle.updatePoints([r.lng,r.lat],[s.lng,s.lat],[l.lng,l.lat],[h.lng,h.lat])}}const La={PolygonRangingInDrawing:G,PolygonEditorRanging:Fe,PolygonEditorEvent:Ke,PolygonRanging:Ue,LikeRectangle:tn,LikeRectangleEditor:en};u.LikeRectangle=tn,u.LikeRectangleEditor=en,u.PolygonEditorEvent=Ke,u.PolygonEditorRanging=Fe,u.PolygonRanging=Ue,u.PolygonRangingInDrawing=G,u.default=La,Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
